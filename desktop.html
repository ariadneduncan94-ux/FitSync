<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1280, initial-scale=0.25, maximum-scale=2.0, user-scalable=yes">
  <title>LiftWise - Trainer Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; overflow: hidden; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #0a0a0a; color: #fff; }
    
    /* Layout */
    .app { display: flex; height: 100vh; overflow: hidden; }
    .sidebar { width: 240px; background: #111; border-right: 1px solid #222; display: flex; flex-direction: column; position: fixed; height: 100vh; z-index: 10; }
    .main { flex: 1; margin-left: 240px; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    
    /* Sidebar */
    .sidebar-header { padding: 24px 20px; border-bottom: 1px solid #222; }
    .logo { font-family: 'Poppins', sans-serif; font-size: 24px; font-weight: 700; }
    .logo-lift { color: #fff; }
    .logo-wise { background: linear-gradient(90deg, #4169E1, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    
    .sidebar-nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
    .nav-section { margin-bottom: 24px; }
    .nav-section-title { font-size: 10px; color: #666; letter-spacing: 1.5px; text-transform: uppercase; padding: 0 12px; margin-bottom: 8px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; cursor: pointer; color: #888; font-size: 14px; font-weight: 500; transition: all 0.2s; }
    .nav-item:hover { background: #1a1a1a; color: #fff; }
    .nav-item.active { background: linear-gradient(135deg, #4169E120 0%, #00ff8810 100%); color: #fff; border: 1px solid #4169E130; }
    .nav-item svg { width: 20px; height: 20px; fill: currentColor; }
    .nav-badge { margin-left: auto; background: #4169E1; color: #fff; font-size: 11px; padding: 2px 8px; border-radius: 10px; }
    
    .sidebar-footer { padding: 16px; border-top: 1px solid #222; }
    .user-info { display: flex; align-items: center; gap: 12px; padding: 8px; border-radius: 10px; cursor: pointer; }
    .user-info:hover { background: #1a1a1a; }
    .user-avatar { width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
    .user-name { font-weight: 600; font-size: 14px; }
    .user-role { font-size: 11px; color: #666; }
    
    /* Header */
    .header { padding: 12px 24px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; flex-shrink: 0; }
    .header-title { font-size: 18px; font-weight: 600; }
    .header-actions { display: flex; gap: 12px; }
    
    /* Content */
    .content { flex: 1; padding: 16px 24px; overflow-y: auto; }
    
    /* Page container */
    .page { display: none; height: 100%; }
    .page.active { display: flex; flex-direction: column; height: 100%; }
    
    /* Cards */
    .card { background: #111; border: 1px solid #222; border-radius: 16px; padding: 20px; }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
    .card-title { font-size: 14px; font-weight: 600; color: #888; letter-spacing: 1px; text-transform: uppercase; }
    
    /* Buttons */
    .btn { padding: 12px 20px; background: linear-gradient(135deg, #4169E1 0%, #00ff88 100%); border: none; border-radius: 10px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px rgba(65, 105, 225, 0.4); }
    .btn-secondary { background: #1a1a1a; border: 1px solid #333; }
    .btn-secondary:hover { border-color: #4169E1; }
    .btn-sm { padding: 8px 14px; font-size: 13px; }
    .btn svg { width: 16px; height: 16px; fill: currentColor; }
    
    /* Grid */
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
    
    /* ==================== RESPONSIVE STYLES ==================== */
    
    /* Mobile menu button - hidden (desktop always shows full layout) */
    .mobile-menu-btn {
      display: none;
    }
    
    /* ==================== COMMUNITIES STYLES ==================== */
    
    /* Community Cards */
    .community-card {
      background: #111;
      border: 1px solid #222;
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .community-card:hover {
      border-color: #764ba2;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(118, 75, 162, 0.15);
    }
    .community-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .community-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .community-badge {
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .community-badge.accountability { background: #ff6b6b20; color: #ff6b6b; }
    .community-badge.program { background: #4169E120; color: #4169E1; }
    .community-badge.challenge { background: #00ff8820; color: #00ff88; }
    .community-badge.general { background: #76767620; color: #888; }
    .community-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .community-desc {
      font-size: 13px;
      color: #888;
      line-height: 1.5;
      margin-bottom: 16px;
    }
    .community-stats-row {
      display: flex;
      gap: 16px;
      padding: 12px 0;
      border-top: 1px solid #222;
      border-bottom: 1px solid #222;
      margin-bottom: 12px;
    }
    .community-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .community-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .community-stat-label {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
    }
    .community-activity {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #888;
    }
    .community-activity-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Community Modal */
    .community-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .community-modal.open {
      display: flex;
    }
    .community-modal-content {
      background: #111;
      border-radius: 20px;
      width: 90%;
      max-width: 700px;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .community-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid #222;
    }
    .community-modal-title {
      font-size: 20px;
      font-weight: 600;
    }
    .community-modal-subtitle {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }
    .community-modal-close {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .community-modal-close:hover {
      background: #1a1a1a;
      color: #fff;
    }
    .community-modal-tabs {
      display: flex;
      gap: 4px;
      padding: 12px 24px;
      border-bottom: 1px solid #222;
      background: #0a0a0a;
    }
    .community-tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      color: #666;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .community-tab:hover {
      background: #1a1a1a;
      color: #fff;
    }
    .community-tab.active {
      background: #764ba2;
      color: #fff;
    }
    .community-tab-content {
      display: none;
      flex: 1;
      overflow-y: auto;
    }
    .community-tab-content.active {
      display: flex;
      flex-direction: column;
    }
    
    /* Chat */
    .community-chat-messages {
      flex: 1;
      padding: 20px 24px;
      overflow-y: auto;
      max-height: 400px;
    }
    .community-message {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    .community-message.announcement {
      background: linear-gradient(135deg, #764ba210 0%, #667eea10 100%);
      border: 1px solid #764ba230;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .community-message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, #4169E1, #00ff88);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
      flex-shrink: 0;
    }
    .community-message-body {
      flex: 1;
    }
    .community-message-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }
    .community-message-sender {
      font-size: 13px;
      font-weight: 600;
    }
    .community-message-time {
      font-size: 11px;
      color: #666;
    }
    .community-message-content {
      font-size: 14px;
      color: #ccc;
      line-height: 1.5;
    }
    .community-chat-input {
      display: flex;
      gap: 12px;
      padding: 16px 24px;
      border-top: 1px solid #222;
      background: #0a0a0a;
    }
    .community-chat-input input {
      flex: 1;
      padding: 12px 16px;
      background: #111;
      border: 1px solid #333;
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
    }
    .community-chat-input input:focus {
      outline: none;
      border-color: #764ba2;
    }
    
    /* Events */
    .community-events-list {
      padding: 0 24px 24px;
    }
    .community-event-card {
      display: flex;
      gap: 16px;
      padding: 16px;
      background: #1a1a1a;
      border: 1px solid #222;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .community-event-date {
      width: 56px;
      text-align: center;
      padding: 8px;
      background: linear-gradient(135deg, #764ba2, #667eea);
      border-radius: 10px;
    }
    .community-event-month {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .community-event-day {
      font-size: 24px;
      font-weight: 700;
    }
    .community-event-info {
      flex: 1;
    }
    .community-event-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .community-event-meta {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #888;
      margin-bottom: 4px;
    }
    .community-event-rsvp {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .community-event-going {
      font-size: 12px;
      color: #00ff88;
    }
    
    /* Members */
    .community-members-list {
      padding: 0 24px 24px;
    }
    .community-member {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #1a1a1a;
      border-radius: 10px;
      margin-bottom: 8px;
    }
    .community-member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #4169E1, #00ff88);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }
    .community-member-info {
      flex: 1;
    }
    .community-member-name {
      font-size: 14px;
      font-weight: 500;
    }
    .community-member-role {
      font-size: 11px;
      color: #666;
    }
    .community-member-role.admin {
      color: #764ba2;
    }
    .community-member-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #333;
    }
    .community-member-status.online {
      background: #00ff88;
    }
    
    /* Settings */
    .community-settings-section {
      padding: 0 24px;
      margin-bottom: 16px;
    }
    .community-settings-section:first-child {
      padding-top: 20px;
    }
    .community-settings-section textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    /* Member checkbox */
    .member-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .member-checkbox:hover {
      border-color: #764ba2;
    }
    .member-checkbox input:checked + span,
    .member-checkbox:has(input:checked) {
      border-color: #764ba2;
      background: #764ba210;
    }
</style>
</head>
<body>
<div class="app">
  <!-- Sidebar Overlay for Mobile -->
  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
  
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo"><span class="logo-lift">Lift</span><span class="logo-wise">Wise</span></div>
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Overview</div>
        <div class="nav-item active" onclick="showPage('dashboard')">
          <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
          Dashboard
        </div>
        <div class="nav-item" onclick="showPage('calendar')">
          <svg viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/></svg>
          Calendar
        </div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Clients</div>
        <div class="nav-item" onclick="showPage('clients')">
          <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
          All Clients
          <span class="nav-badge">12</span>
        </div>
        <div class="nav-item" onclick="showPage('communities')">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
          Communities
          <span class="nav-badge" style="background:#764ba2;">3</span>
        </div>
        <div class="nav-item" onclick="showPage('messages')">
          <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
          Messages
          <span class="nav-badge" style="background:#00ff88;">3</span>
        </div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Programming</div>
        <div class="nav-item" onclick="showPage('programs')">
          <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
          Programs
        </div>
        <div class="nav-item" onclick="showPage('studio')">
          <svg viewBox="0 0 24 24"><path d="M22 9V7h-2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2v-2h-2V9h2zm-4 10H4V5h14v14zM6 13h5v4H6zm6-6h4v3h-4zM6 7h5v5H6zm6 4h4v6h-4z"/></svg>
          Program Studio
        </div>
        <div class="nav-item" onclick="showPage('exercises')">
          <svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>
          Exercise Library
        </div>
        <div class="nav-item" onclick="showPage('nutrition')">
          <svg viewBox="0 0 24 24"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2v16.94h.06zM1 21.99h15.03V3.95l-5-2-10 2v18.04zm1.97-13.95l2.56-.51v2.96l-2.56.51V8.04zm0 4.48l2.56-.51v2.96l-2.56.51v-2.96zm0 4.48l2.56-.51v2.96l-2.56.51v-2.96z"/></svg>
          Nutrition
        </div>
        <div class="nav-item" onclick="showPage('ai-coach')">
          <svg viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="currentColor" stroke="none"/></svg>
          <span><span style="color:#fff;">Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span></span>
        </div>
      </div>
      
      <div class="nav-section">
        <div class="nav-section-title">Business</div>
        <div class="nav-item" onclick="showPage('revenue')">
          <svg viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
          Business
        </div>
        <div class="nav-item" onclick="showPage('settings')">
          <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
          Settings
        </div>
      </div>
    </nav>
    
    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">AT</div>
        <div>
          <div class="user-name">Alex Trainer</div>
          <div class="user-role">Pro Plan</div>
        </div>
      </div>
    </div>
  </aside>

<style>
    /* Calendar Styles */
    .calendar-container { display: flex; gap: 24px; height: calc(100vh - 140px); }
    .calendar-main { flex: 1; display: flex; flex-direction: column; }
    .calendar-sidebar { width: 320px; display: flex; flex-direction: column; gap: 16px; }
    
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .calendar-nav { display: flex; align-items: center; gap: 16px; }
    .calendar-nav-btn { width: 36px; height: 36px; border-radius: 8px; background: #1a1a1a; border: 1px solid #333; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .calendar-nav-btn:hover { border-color: #4169E1; }
    .calendar-month { font-size: 20px; font-weight: 600; min-width: 180px; text-align: center; }
    .calendar-views { display: flex; gap: 4px; background: #1a1a1a; padding: 4px; border-radius: 10px; }
    .calendar-view-btn { padding: 8px 16px; border: none; background: transparent; color: #888; font-size: 13px; font-weight: 500; cursor: pointer; border-radius: 8px; }
    .calendar-view-btn.active { background: #4169E1; color: #fff; }
    
    .calendar-grid { flex: 1; display: flex; flex-direction: column; background: #111; border: 1px solid #222; border-radius: 16px; overflow: hidden; }
    .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); background: #1a1a1a; border-bottom: 1px solid #222; }
    .calendar-weekday { padding: 12px; text-align: center; font-size: 12px; font-weight: 600; color: #666; text-transform: uppercase; letter-spacing: 1px; }
    .calendar-days { flex: 1; display: grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: 1fr; }
    .calendar-day { border-right: 1px solid #222; border-bottom: 1px solid #222; padding: 8px; min-height: 100px; cursor: pointer; transition: background 0.2s; }
    .calendar-day:hover { background: #1a1a1a; }
    .calendar-day:nth-child(7n) { border-right: none; }
    .calendar-day.other-month { opacity: 0.3; }
    .calendar-day.today { background: linear-gradient(135deg, #4169E110 0%, #00ff8808 100%); }
    .calendar-day-num { font-size: 14px; font-weight: 600; margin-bottom: 6px; }
    .calendar-day.today .calendar-day-num { color: #4169E1; }
    .calendar-event { font-size: 11px; padding: 4px 6px; border-radius: 4px; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
    .calendar-event.session { background: #4169E130; color: #4169E1; border-left: 2px solid #4169E1; }
    .calendar-event.workout { background: #00ff8820; color: #00ff88; border-left: 2px solid #00ff88; }
    .calendar-event.checkin { background: #ffcc0020; color: #ffcc00; border-left: 2px solid #ffcc00; }
    
    /* AI Command Panel */
    .ai-panel { background: #111; border: 1px solid #222; border-radius: 16px; padding: 20px; flex: 1; display: flex; flex-direction: column; }
    .ai-panel-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
    .ai-panel-icon { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; }
    .ai-panel-title { font-size: 16px; font-weight: 600; }
    .ai-panel-subtitle { font-size: 12px; color: #666; }
    .ai-input-area { flex: 1; display: flex; flex-direction: column; }
    .ai-textarea { flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 12px; padding: 16px; color: #fff; font-size: 14px; resize: none; font-family: inherit; min-height: 120px; }
    .ai-textarea:focus { outline: none; border-color: #4169E1; }
    .ai-textarea::placeholder { color: #555; }
    .ai-suggestions { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
    .ai-suggestion { padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 20px; font-size: 12px; color: #888; cursor: pointer; transition: all 0.2s; }
    .ai-suggestion:hover { border-color: #4169E1; color: #fff; }
    .ai-actions { display: flex; gap: 8px; margin-top: 12px; }
    
    /* Today's Schedule */
    .schedule-card { background: #111; border: 1px solid #222; border-radius: 16px; padding: 20px; max-height: 300px; overflow-y: auto; }
    .schedule-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid #222; }
    .schedule-item:last-child { border-bottom: none; }
    .schedule-time { font-size: 13px; font-weight: 600; color: #4169E1; min-width: 60px; }
    .schedule-info { flex: 1; }
    .schedule-title { font-size: 14px; font-weight: 500; }
    .schedule-meta { font-size: 12px; color: #666; margin-top: 2px; }
    .schedule-avatar { width: 32px; height: 32px; border-radius: 8px; background: #333; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
    
    /* Stats Cards */
    .stat-card { background: #111; border: 1px solid #222; border-radius: 16px; padding: 20px; }
    .stat-value { font-size: 32px; font-weight: 700; margin-bottom: 4px; }
    .stat-value.green { color: #00ff88; }
    .stat-value.blue { color: #4169E1; }
    .stat-label { font-size: 13px; color: #666; }
    .stat-change { font-size: 12px; margin-top: 8px; }
    .stat-change.up { color: #00ff88; }
    .stat-change.down { color: #ff6b6b; }
    
    /* Client List */
    .client-row { display: flex; align-items: center; gap: 16px; padding: 16px; background: #111; border: 1px solid #222; border-radius: 12px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
    .client-row:hover { border-color: #4169E1; transform: translateX(4px); }
    .client-avatar-lg { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; }
    .client-details { flex: 1; }
    .client-name-lg { font-size: 16px; font-weight: 600; }
    .client-meta-lg { font-size: 13px; color: #666; margin-top: 2px; }
    .client-stats { display: flex; gap: 24px; }
    .client-stat { text-align: center; }
    .client-stat-value { font-size: 18px; font-weight: 700; }
    .client-stat-label { font-size: 11px; color: #666; }
    
    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #111; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #444; }
    
    /* Exercise Library Styles */
    .exercise-card { background: #111; border: 1px solid #222; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; }
    .exercise-card:hover { border-color: #4169E1; transform: translateY(-2px); }
    .exercise-gif { width: 100%; height: 200px; background: #0a0a0a; border-radius: 8px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .exercise-gif img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
    .exercise-name { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
    .exercise-meta { display: flex; gap: 8px; margin-bottom: 8px; }
    .exercise-tag { font-size: 11px; padding: 4px 8px; border-radius: 12px; background: #333; color: #ccc; }
    .exercise-tag.bodypart { background: #4169E120; color: #4169E1; }
    .exercise-tag.equipment { background: #00ff8820; color: #00ff88; }
    .exercise-instructions { font-size: 13px; color: #888; line-height: 1.4; }
    
    /* Loading Animation */
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Exercise Modal */
    .exercise-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .exercise-modal-content { background: #111; border-radius: 16px; padding: 24px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative; }
    .exercise-modal-close { position: absolute; top: 16px; right: 16px; cursor: pointer; color: #666; }
    .exercise-modal-close:hover { color: #fff; }
    .exercise-modal-gif { width: 100%; height: 300px; background: #0a0a0a; border-radius: 12px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .exercise-modal-gif img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
    .exercise-modal-name { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
    .exercise-modal-meta { display: flex; gap: 12px; margin-bottom: 16px; }
    .exercise-modal-instructions { font-size: 14px; line-height: 1.6; color: #ccc; }
    
    /* Nutrition Styles */
    .nutrition-tab { padding: 10px 20px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #888; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .nutrition-tab:hover { border-color: #4169E1; color: #fff; }
    .nutrition-tab.active { background: #4169E1; border-color: #4169E1; color: #fff; }
    .nutrition-content { display: block; }
    .nutrition-input { width: 100%; padding: 10px 14px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; font-size: 14px; }
    .nutrition-input:focus { outline: none; border-color: #4169E1; }
    .input-group { margin-bottom: 14px; }
    .input-label { display: block; font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
    
    .macro-slider { width: 100%; height: 6px; -webkit-appearance: none; background: #333; border-radius: 3px; outline: none; }
    .macro-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #4169E1; border-radius: 50%; cursor: pointer; }
    
    .macro-results { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; background: #0a0a0a; border-radius: 12px; padding: 16px; margin-top: 16px; }
    .macro-result-item { text-align: center; }
    .macro-result-value { font-size: 24px; font-weight: 700; }
    .macro-result-value.protein { color: #4169E1; }
    .macro-result-value.carbs { color: #ffcc00; }
    .macro-result-value.fats { color: #ff6b6b; }
    .macro-result-label { font-size: 11px; color: #666; text-transform: uppercase; margin-top: 4px; }
    
    .daily-totals-bar { display: flex; gap: 24px; background: #0a0a0a; border-radius: 10px; padding: 12px 16px; margin-bottom: 16px; }
    .daily-total { display: flex; align-items: center; gap: 6px; }
    .daily-total-label { font-size: 12px; color: #666; }
    .daily-total-value { font-size: 14px; font-weight: 600; }
    .daily-total-value.protein { color: #4169E1; }
    .daily-total-value.carbs { color: #ffcc00; }
    .daily-total-value.fats { color: #ff6b6b; }
    .daily-total-target { font-size: 12px; color: #444; }
    
    .meal-slot { background: #1a1a1a; border: 1px solid #222; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .meal-slot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .meal-slot-name { font-weight: 600; font-size: 14px; }
    .meal-slot-macros { font-size: 12px; color: #666; }
    .meal-food-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; background: #111; border-radius: 8px; margin-bottom: 8px; }
    .meal-food-name { font-size: 13px; }
    .meal-food-macros { font-size: 11px; color: #888; }
    .meal-food-remove { color: #666; cursor: pointer; padding: 4px; }
    .meal-food-remove:hover { color: #ff6b6b; }
    
    .add-food-btn { width: 100%; padding: 10px; background: transparent; border: 1px dashed #333; border-radius: 8px; color: #666; font-size: 13px; cursor: pointer; transition: all 0.2s; }
    .add-food-btn:hover { border-color: #4169E1; color: #4169E1; }
    
    .plan-card { background: #111; border: 1px solid #222; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.2s; }
    .plan-card:hover { border-color: #4169E1; transform: translateY(-2px); }
    .plan-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .plan-avatar { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px; }
    .plan-client { font-weight: 600; font-size: 15px; }
    .plan-meta { font-size: 12px; color: #666; }
    .plan-macros { display: flex; justify-content: space-between; margin-bottom: 12px; }
    .plan-macro { text-align: center; }
    .plan-macro-value { font-size: 16px; font-weight: 600; }
    .plan-macro-value.protein { color: #4169E1; }
    .plan-macro-value.carbs { color: #ffcc00; }
    .plan-macro-value.fats { color: #ff6b6b; }
    .plan-macro-label { font-size: 10px; color: #666; }
    .plan-compliance { height: 4px; background: #222; border-radius: 2px; overflow: hidden; }
    .plan-compliance-bar { height: 100%; background: #00ff88; border-radius: 2px; }
    .plan-compliance-text { font-size: 11px; color: #666; margin-top: 8px; }
    
    .food-card { background: #1a1a1a; border: 1px solid #222; border-radius: 10px; padding: 12px; cursor: pointer; transition: all 0.2s; }
    .food-card:hover { border-color: #00ff88; }
    .food-card-name { font-size: 14px; font-weight: 500; margin-bottom: 6px; }
    .food-card-serving { font-size: 11px; color: #666; margin-bottom: 8px; }
    .food-card-macros { display: flex; gap: 8px; font-size: 11px; }
    .food-card-macro { padding: 2px 6px; background: #111; border-radius: 4px; }
    
    .ai-quick-btn { padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 16px; color: #888; font-size: 12px; cursor: pointer; transition: all 0.2s; }
    .ai-quick-btn:hover { border-color: #00ff88; color: #00ff88; }
    
    .preset-btn { padding: 8px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #ccc; font-size: 12px; cursor: pointer; transition: all 0.2s; }
    .preset-btn:hover { border-color: #00ff88; background: #00ff8810; }
    
    /* Program Studio Styles */
    .studio-panel { background: #111; border-right: 1px solid #222; display: flex; flex-direction: column; height: 100%; }
    .studio-panel:last-child { border-right: none; }
    .studio-panel-header { padding: 12px 16px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
    .studio-panel-title { font-size: 13px; font-weight: 600; color: #fff; }
    .studio-panel-count { font-size: 11px; color: #666; }
    
    .studio-exercises { width: 280px; flex-shrink: 0; }
    .studio-search { padding: 12px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 8px; background: #0a0a0a; }
    .studio-search input { flex: 1; background: transparent; border: none; color: #fff; font-size: 13px; outline: none; }
    .studio-search input::placeholder { color: #555; }
    .studio-filters { padding: 8px 12px; display: flex; gap: 8px; border-bottom: 1px solid #222; }
    .studio-filters select { flex: 1; padding: 6px 8px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 11px; cursor: pointer; }
    .studio-exercise-list { flex: 1; overflow-y: auto; padding: 8px; }
    
    .studio-exercise-item { padding: 10px 12px; background: #1a1a1a; border: 1px solid #222; border-radius: 8px; margin-bottom: 6px; cursor: grab; transition: all 0.2s; }
    .studio-exercise-item:hover { border-color: #4169E1; background: #1a1a2a; }
    .studio-exercise-item:active { cursor: grabbing; }
    .studio-exercise-item.dragging { opacity: 0.5; border-color: #4169E1; }
    .studio-exercise-name { font-size: 13px; font-weight: 500; margin-bottom: 4px; }
    .studio-exercise-meta { display: flex; gap: 6px; }
    .studio-exercise-tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: #333; color: #888; }
    .studio-exercise-tag.bodypart { background: #4169E120; color: #4169E1; }
    .studio-exercise-tag.equipment { background: #00ff8820; color: #00ff88; }
    
    .studio-builder { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    .program-title-input { background: transparent; border: none; color: #fff; font-size: 16px; font-weight: 600; width: 180px; outline: none; border-bottom: 1px solid transparent; }
    .program-title-input:focus { border-bottom-color: #4169E1; }
    .studio-select-sm { padding: 6px 10px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 12px; cursor: pointer; }
    .studio-actions { display: flex; gap: 6px; }
    
    .week-nav { display: flex; align-items: center; gap: 8px; padding: 10px 16px; border-bottom: 1px solid #222; background: #0a0a0a; flex-shrink: 0; }
    .week-nav-btn { width: 28px; height: 28px; border-radius: 6px; background: #1a1a1a; border: 1px solid #333; color: #888; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .week-nav-btn:hover { border-color: #4169E1; color: #fff; }
    .week-tabs { display: flex; gap: 4px; flex: 1; overflow-x: auto; }
    .week-tab { padding: 6px 14px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; color: #888; font-size: 12px; font-weight: 500; cursor: pointer; white-space: nowrap; transition: all 0.2s; }
    .week-tab:hover { border-color: #4169E1; color: #fff; }
    .week-tab.active { background: #4169E1; border-color: #4169E1; color: #fff; }
    .week-add-btn { padding: 6px 12px; background: transparent; border: 1px dashed #333; border-radius: 6px; color: #666; font-size: 12px; cursor: pointer; }
    .week-add-btn:hover { border-color: #00ff88; color: #00ff88; }
    
    .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); flex: 1; overflow: hidden; }
    .day-column { border-right: 1px solid #222; display: flex; flex-direction: column; min-width: 0; }
    .day-column:last-child { border-right: none; }
    .day-header { padding: 10px 8px; border-bottom: 1px solid #222; background: #0a0a0a; text-align: center; flex-shrink: 0; }
    .day-name { display: block; font-size: 11px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
    .day-focus { display: block; font-size: 12px; color: #4169E1; margin-top: 2px; outline: none; }
    .day-focus:focus { background: #1a1a1a; border-radius: 4px; padding: 2px 4px; }
    .day-exercises { flex: 1; padding: 8px; overflow-y: auto; min-height: 100px; }
    .day-exercises.drag-over { background: #4169E110; }
    .drop-zone-hint { font-size: 11px; color: #444; text-align: center; padding: 20px 8px; border: 1px dashed #333; border-radius: 6px; }
    
    .program-exercise { padding: 10px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; margin-bottom: 6px; cursor: grab; position: relative; }
    .program-exercise:hover { border-color: #4169E1; }
    .program-exercise-name { font-size: 12px; font-weight: 500; margin-bottom: 6px; line-height: 1.3; }
    .program-exercise-sets { display: flex; gap: 4px; flex-wrap: wrap; }
    .program-exercise-set { display: flex; align-items: center; gap: 2px; font-size: 10px; padding: 3px 6px; background: #333; border-radius: 4px; color: #ccc; cursor: pointer; transition: all 0.2s; }
    .program-exercise-set:hover { background: #4169E1; color: #fff; }
    .program-exercise-set input { width: 28px; background: transparent; border: none; color: inherit; font-size: 10px; text-align: center; padding: 0; }
    .program-exercise-set input:focus { outline: none; }
    .program-exercise-set-label { font-size: 9px; color: #888; }
    .program-exercise-add-set { font-size: 10px; padding: 3px 6px; background: transparent; border: 1px dashed #444; border-radius: 4px; color: #666; cursor: pointer; }
    .program-exercise-add-set:hover { border-color: #00ff88; color: #00ff88; }
    .program-exercise-remove { position: absolute; top: 4px; right: 4px; width: 16px; height: 16px; border-radius: 50%; background: #333; color: #666; font-size: 10px; cursor: pointer; display: none; align-items: center; justify-content: center; }
    .program-exercise:hover .program-exercise-remove { display: flex; }
    .program-exercise-remove:hover { background: #ff6b6b; color: #fff; }
    
    .studio-ai { width: 300px; flex-shrink: 0; display: flex; flex-direction: column; }
    .studio-panel-body { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
    .studio-exercises .studio-panel-body { overflow: hidden; }
    .studio-ai .studio-panel-body { display: flex; flex-direction: column; flex: 1; }
    .studio-ai .ai-studio-chat { flex: 1; overflow-y: auto; padding: 12px; }
    
    /* Panel Collapse/Expand */
    .panel-toggle-btn { width: 24px; height: 24px; border-radius: 4px; background: transparent; border: 1px solid #333; color: #666; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .panel-toggle-btn:hover { border-color: #4169E1; color: #fff; }
    .studio-panel-collapsed { width: 40px; background: #111; border-right: 1px solid #222; display: flex; flex-direction: column; align-items: center; padding: 12px 0; gap: 8px; }
    .panel-expand-btn { width: 32px; height: 32px; border-radius: 6px; background: #1a1a1a; border: 1px solid #333; color: #888; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .panel-expand-btn:hover { border-color: #4169E1; color: #fff; background: #4169E120; }
    .panel-collapsed-label { writing-mode: vertical-rl; text-orientation: mixed; font-size: 11px; color: #666; letter-spacing: 1px; }
    .studio-panel.collapsed { display: none; }
    
    .ai-icon-sm { width: 24px; height: 24px; border-radius: 6px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; }
    .ai-studio-chat { flex: 1; overflow-y: auto; padding: 12px; }
    .ai-studio-msg { margin-bottom: 12px; }
    .ai-studio-msg.assistant .ai-studio-msg-content { background: #1a1a1a; border-radius: 12px; padding: 12px; font-size: 13px; line-height: 1.5; }
    .ai-studio-msg.assistant ul { margin: 8px 0 0 16px; padding: 0; }
    .ai-studio-msg.assistant li { margin-bottom: 4px; color: #888; font-size: 12px; }
    .ai-studio-msg.user .ai-studio-msg-content { background: #4169E1; border-radius: 12px; padding: 10px 14px; font-size: 13px; margin-left: 20px; }
    .ai-studio-quick { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 12px; border-top: 1px solid #222; }
    .ai-quick-chip { padding: 5px 10px; background: #1a1a1a; border: 1px solid #333; border-radius: 14px; color: #888; font-size: 11px; cursor: pointer; transition: all 0.2s; }
    .ai-quick-chip:hover { border-color: #4169E1; color: #fff; }
    .ai-studio-input { display: flex; gap: 8px; padding: 12px; border-top: 1px solid #222; }
    .ai-studio-input textarea { flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 10px; color: #fff; font-size: 13px; resize: none; font-family: inherit; }
    .ai-studio-input textarea:focus { outline: none; border-color: #4169E1; }
    .ai-studio-send { width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #4169E1, #00ff88); border: none; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .ai-studio-send:hover { transform: scale(1.05); }
    
    .program-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 12px; border-top: 1px solid #222; background: #0a0a0a; }
    .program-stat { text-align: center; }
    .program-stat-value { display: block; font-size: 18px; font-weight: 700; color: #4169E1; }
    .program-stat-label { font-size: 10px; color: #666; text-transform: uppercase; }
    
    /* Program Detail View */
    .program-day-card { background: #1a1a1a; border: 1px solid #222; border-radius: 10px; padding: 12px; text-align: center; }
    .program-day-card.today { border-color: #4169E1; background: #4169E110; }
    .program-day-name { font-size: 11px; font-weight: 600; color: #888; text-transform: uppercase; margin-bottom: 4px; }
    .program-day-focus { font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 10px; }
    .program-day-exercises { font-size: 11px; color: #888; line-height: 1.6; min-height: 80px; }
    .program-day-status { font-size: 10px; padding: 4px 8px; border-radius: 10px; margin-top: 10px; display: inline-block; }
    .program-day-status.completed { background: #00ff8820; color: #00ff88; }
    .program-day-status.pending { background: #33333380; color: #666; }
    .program-day-status.rest { background: #22222280; color: #444; }
    .program-day-status.today { background: #4169E130; color: #4169E1; }
    
    /* LiftAssistant Insight Cards */
    .insight-card { background: #1a1a1a; border: 1px solid #222; border-radius: 12px; padding: 14px; margin-bottom: 12px; }
    .insight-card.priority { border-left: 3px solid #ff6b6b; }
    .insight-card.positive { border-left: 3px solid #00ff88; }
    .insight-card.nutrition { border-left: 3px solid #ffcc00; }
    .insight-card.habit { border-left: 3px solid #4169E1; }
    .insight-card.milestone { border-left: 3px solid #00ff88; background: linear-gradient(135deg, #00ff8808 0%, transparent 100%); }
    .insight-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .insight-icon { font-size: 14px; }
    .insight-type { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: #888; }
    .insight-time { font-size: 10px; color: #555; margin-left: auto; }
    .insight-title { font-size: 14px; font-weight: 600; margin-bottom: 8px; }
    .insight-body { font-size: 12px; color: #aaa; line-height: 1.5; margin-bottom: 10px; }
    .insight-suggestion { font-size: 12px; color: #888; background: #0a0a0a; border-radius: 8px; padding: 10px; margin-bottom: 10px; line-height: 1.5; }
    .insight-suggestion strong { color: #4169E1; }
    .insight-actions { display: flex; gap: 8px; }
    .insight-btn { padding: 6px 12px; background: #222; border: 1px solid #333; border-radius: 6px; color: #ccc; font-size: 11px; cursor: pointer; transition: all 0.2s; }
    .insight-btn:hover { border-color: #4169E1; color: #fff; }
    .insight-btn.primary { background: linear-gradient(135deg, #4169E1, #00ff88); border: none; color: #fff; }
    .insight-btn.primary:hover { transform: translateY(-1px); }
    
    /* Program Draft Styles */
    .program-draft { font-size: 13px; line-height: 1.5; }
    .draft-header { background: linear-gradient(135deg, #4169E110, #00ff8808); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
    .draft-section { background: #0a0a0a; border-radius: 6px; padding: 10px; margin-bottom: 10px; font-size: 12px; }
    .draft-phases { margin: 12px 0; }
    .draft-phase { background: #0a0a0a; border: 1px solid #222; border-radius: 10px; padding: 12px; margin-bottom: 10px; }
    .phase-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .phase-weeks { font-size: 11px; color: #4169E1; background: #4169E120; padding: 2px 8px; border-radius: 10px; }
    .phase-focus { font-size: 12px; color: #888; margin-bottom: 10px; font-style: italic; }
    .phase-structure { border-left: 2px solid #333; padding-left: 12px; margin-left: 4px; }
    .phase-day { margin-bottom: 8px; font-size: 12px; }
    .phase-day strong { color: #fff; }
    .phase-exercises { color: #666; font-size: 11px; margin-top: 2px; }
    .phase-notes { font-size: 11px; color: #00ff88; margin-top: 8px; padding-top: 8px; border-top: 1px solid #222; }
    .draft-actions { background: #4169E110; border-radius: 8px; padding: 12px; margin-top: 12px; text-align: center; }
    
    /* P&L Chart Styles */
    .chart-period-btns { display: flex; gap: 4px; }
    .period-btn { padding: 4px 10px; background: transparent; border: 1px solid #333; border-radius: 6px; color: #666; font-size: 11px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
    .period-btn:hover { border-color: #4169E1; color: #fff; }
    .period-btn.active { background: #4169E1; border-color: #4169E1; color: #fff; }
    .chart-legend { display: flex; gap: 16px; justify-content: center; margin-top: 12px; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #888; }
    .legend-dot { width: 8px; height: 8px; border-radius: 50%; }
    
    /* Client Performance Styles */
    .client-perf-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid #222; }
    .client-perf-row:last-child { border-bottom: none; }
    .client-perf-avatar { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; flex-shrink: 0; }
    .client-perf-info { flex: 1; min-width: 0; }
    .client-perf-name { font-size: 13px; font-weight: 500; }
    .client-perf-meta { font-size: 11px; color: #666; }
    .client-perf-bar { width: 80px; height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
    .client-perf-fill { height: 100%; background: #00ff88; border-radius: 3px; transition: width 0.3s; }
    .client-perf-score { font-size: 14px; font-weight: 600; color: #00ff88; width: 40px; text-align: right; }
  </style>

  <!-- Main Content -->
  <main class="main">
    <!-- Dashboard Page -->
    <div id="page-dashboard" class="page active">
      <header class="header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </button>
        <h1 class="header-title">Dashboard</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Quick Add
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Stats Row -->
        <div class="grid-4" style="margin-bottom: 16px;">
          <div class="stat-card">
            <div class="stat-value blue">12</div>
            <div class="stat-label">Active Clients</div>
            <div class="stat-change up">+2 this month</div>
          </div>
          <div class="stat-card">
            <div class="stat-value green">$8,450</div>
            <div class="stat-label">Revenue (Dec)</div>
            <div class="stat-change up">+12% vs Nov</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">$5,200</div>
            <div class="stat-label">Net Profit (Dec)</div>
            <div class="stat-change up">+18% vs Nov</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">94%</div>
            <div class="stat-label">Client Retention</div>
            <div class="stat-change up">+3%</div>
          </div>
        </div>
        
        <!-- P&L Chart and Schedule Row -->
        <div class="grid-2" style="margin-bottom: 16px;">
          <!-- P&L Chart -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Revenue & Profit</div>
              <div class="chart-period-btns">
                <button class="period-btn" onclick="updatePLChart('1m')">1M</button>
                <button class="period-btn active" onclick="updatePLChart('6m')">6M</button>
                <button class="period-btn" onclick="updatePLChart('1y')">1Y</button>
                <button class="period-btn" onclick="updatePLChart('5y')">5Y</button>
              </div>
            </div>
            <div style="height: 220px; position: relative;">
              <canvas id="plChart"></canvas>
            </div>
            <div class="chart-legend">
              <div class="legend-item"><span class="legend-dot" style="background:#4169E1;"></span> Revenue</div>
              <div class="legend-item"><span class="legend-dot" style="background:#00ff88;"></span> Profit</div>
              <div class="legend-item"><span class="legend-dot" style="background:#ff6b6b;"></span> Expenses</div>
            </div>
          </div>
          
          <!-- Today's Schedule -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Today's Schedule</div>
              <button class="btn btn-secondary btn-sm" onclick="showPage('calendar')">View All</button>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">9:00 AM</div>
              <div class="schedule-info">
                <div class="schedule-title">Sarah Johnson - Upper Body</div>
                <div class="schedule-meta">In-Person  Downtown Gym</div>
              </div>
              <div class="schedule-avatar" style="background: #4169E1;">SJ</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">10:30 AM</div>
              <div class="schedule-info">
                <div class="schedule-title">Mike Chen - Check-in Call</div>
                <div class="schedule-meta">Virtual  Zoom</div>
              </div>
              <div class="schedule-avatar" style="background: #00ff88; color: #000;">MC</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">2:00 PM</div>
              <div class="schedule-info">
                <div class="schedule-title">Emma Wilson - Lower Body</div>
                <div class="schedule-meta">In-Person  Studio B</div>
              </div>
              <div class="schedule-avatar" style="background: #ff6b6b;">EW</div>
            </div>
            <div class="schedule-item">
              <div class="schedule-time">4:00 PM</div>
              <div class="schedule-info">
                <div class="schedule-title">David Park - Program Review</div>
                <div class="schedule-meta">Virtual  Google Meet</div>
              </div>
              <div class="schedule-avatar" style="background: #ffcc00; color: #000;">DP</div>
            </div>
          </div>
        </div>
        
        <!-- Bottom Row: Client Performance & AI -->
        <div class="grid-2">
          <!-- Client Performance -->
          <div class="card">
            <div class="card-header">
              <div class="card-title">Client Performance</div>
              <button class="btn btn-secondary btn-sm" onclick="showPage('clients')">View All</button>
            </div>
            <div class="client-perf-row">
              <div class="client-perf-avatar" style="background: #4169E1;">SJ</div>
              <div class="client-perf-info">
                <div class="client-perf-name">Sarah Johnson</div>
                <div class="client-perf-meta">4/4 workouts  92% nutrition</div>
              </div>
              <div class="client-perf-bar"><div class="client-perf-fill" style="width:94%;"></div></div>
              <div class="client-perf-score">94%</div>
            </div>
            <div class="client-perf-row">
              <div class="client-perf-avatar" style="background: #00ff88; color:#000;">MC</div>
              <div class="client-perf-info">
                <div class="client-perf-name">Mike Chen</div>
                <div class="client-perf-meta">3/4 workouts  85% nutrition</div>
              </div>
              <div class="client-perf-bar"><div class="client-perf-fill" style="width:88%; background:#ffcc00;"></div></div>
              <div class="client-perf-score" style="color:#ffcc00;">88%</div>
            </div>
            <div class="client-perf-row">
              <div class="client-perf-avatar" style="background: #ff6b6b;">EW</div>
              <div class="client-perf-info">
                <div class="client-perf-name">Emma Wilson</div>
                <div class="client-perf-meta">3/3 workouts  78% nutrition</div>
              </div>
              <div class="client-perf-bar"><div class="client-perf-fill" style="width:82%;"></div></div>
              <div class="client-perf-score">82%</div>
            </div>
            <div class="client-perf-row">
              <div class="client-perf-avatar" style="background: #ffcc00; color:#000;">DP</div>
              <div class="client-perf-info">
                <div class="client-perf-name">David Park</div>
                <div class="client-perf-meta">5/5 workouts  95% nutrition</div>
              </div>
              <div class="client-perf-bar"><div class="client-perf-fill" style="width:96%;"></div></div>
              <div class="client-perf-score">96%</div>
            </div>
          </div>
          
          <!-- AI Quick Actions -->
          <div class="ai-panel">
            <div class="ai-panel-header">
              <div class="ai-panel-icon">
                <svg width="22" height="22" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="#fff"/></svg>
              </div>
              <div>
                <div class="ai-panel-title">LiftWise AI</div>
                <div class="ai-panel-subtitle">Your programming assistant</div>
              </div>
            </div>
            <div class="ai-input-area">
              <textarea class="ai-textarea" placeholder="Tell me what you need...&#10;&#10;Examples:&#10; Create a 4-week hypertrophy program for Sarah&#10; Reschedule all of Mike's sessions to mornings&#10; Generate a deload week for all clients"></textarea>
              <div class="ai-suggestions">
                <span class="ai-suggestion" onclick="setAIPrompt('Create a program')">Create program</span>
                <span class="ai-suggestion" onclick="setAIPrompt('Reschedule sessions')">Reschedule</span>
                <span class="ai-suggestion" onclick="setAIPrompt('Generate deload week')">Deload week</span>
                <span class="ai-suggestion" onclick="setAIPrompt('Review progress')">Review progress</span>
              </div>
              <div class="ai-actions">
                <button class="btn" style="flex:1;">
                  <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                  Run Command
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar Page -->
    <div id="page-calendar" class="page">
      <header class="header">
        <h1 class="header-title">Calendar</h1>
        <div class="header-actions">
          <button class="btn">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            New Session
          </button>
        </div>
      </header>
      
      <div class="content">
        <div class="calendar-container">
          <div class="calendar-main">
            <div class="calendar-header">
              <div class="calendar-nav">
                <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                </button>
                <div class="calendar-month" id="calendar-month">December 2024</div>
                <button class="calendar-nav-btn" onclick="changeMonth(1)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                </button>
              </div>
              <div class="calendar-views">
                <button class="calendar-view-btn" onclick="setCalendarView('week')">Week</button>
                <button class="calendar-view-btn active" onclick="setCalendarView('month')">Month</button>
              </div>
            </div>
            
            <div class="calendar-grid">
              <div class="calendar-weekdays">
                <div class="calendar-weekday">Sun</div>
                <div class="calendar-weekday">Mon</div>
                <div class="calendar-weekday">Tue</div>
                <div class="calendar-weekday">Wed</div>
                <div class="calendar-weekday">Thu</div>
                <div class="calendar-weekday">Fri</div>
                <div class="calendar-weekday">Sat</div>
              </div>
              <div class="calendar-days" id="calendar-days">
                <!-- Generated by JS -->
              </div>
            </div>
          </div>
          
          <div class="calendar-sidebar">
            <!-- AI Command Panel -->
            <div class="ai-panel" style="flex: none; max-height: 280px;">
              <div class="ai-panel-header">
                <div class="ai-panel-icon">
                  <svg width="22" height="22" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="#fff"/></svg>
                </div>
                <div>
                  <div class="ai-panel-title">AI Scheduling</div>
                  <div class="ai-panel-subtitle">Bulk edit with natural language</div>
                </div>
              </div>
              <textarea class="ai-textarea" style="min-height: 80px;" placeholder="e.g., Move all of Sarah's sessions to 8am next week"></textarea>
              <div class="ai-actions">
                <button class="btn btn-sm" style="flex:1;">Apply Changes</button>
              </div>
            </div>
            
            <!-- Selected Day Schedule -->
            <div class="schedule-card" style="flex: 1;">
              <div class="card-title" style="margin-bottom: 16px;">December 22, 2024</div>
              <div class="schedule-item">
                <div class="schedule-time">9:00 AM</div>
                <div class="schedule-info">
                  <div class="schedule-title">Sarah Johnson</div>
                  <div class="schedule-meta">Upper Body  In-Person</div>
                </div>
              </div>
              <div class="schedule-item">
                <div class="schedule-time">10:30 AM</div>
                <div class="schedule-info">
                  <div class="schedule-title">Mike Chen</div>
                  <div class="schedule-meta">Check-in  Virtual</div>
                </div>
              </div>
              <div class="schedule-item">
                <div class="schedule-time">2:00 PM</div>
                <div class="schedule-info">
                  <div class="schedule-title">Emma Wilson</div>
                  <div class="schedule-meta">Lower Body  In-Person</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Clients Page -->
    <div id="page-clients" class="page">
      <header class="header">
        <h1 class="header-title">Clients</h1>
        <div class="header-actions">
          <input type="text" placeholder="Search clients..." style="padding: 10px 16px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #fff; width: 250px;">
          <button class="btn">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Add Client
          </button>
        </div>
      </header>
      
      <div class="content">
        <div class="client-row" onclick="viewClient('sarah')">
          <div class="client-avatar-lg">SJ</div>
          <div class="client-details">
            <div class="client-name-lg">Sarah Johnson</div>
            <div class="client-meta-lg">Hypertrophy  3x/week  Started Oct 2024</div>
          </div>
          <div class="client-stats">
            <div class="client-stat">
              <div class="client-stat-value" style="color: #00ff88;">94%</div>
              <div class="client-stat-label">Compliance</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value">12</div>
              <div class="client-stat-label">Sessions</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value" style="color: #4169E1;">$600</div>
              <div class="client-stat-label">Monthly</div>
            </div>
          </div>
        </div>
        
        <div class="client-row" onclick="viewClient('mike')">
          <div class="client-avatar-lg" style="background: linear-gradient(135deg, #00ff88, #4169E1);">MC</div>
          <div class="client-details">
            <div class="client-name-lg">Mike Chen</div>
            <div class="client-meta-lg">Strength  4x/week  Started Aug 2024</div>
          </div>
          <div class="client-stats">
            <div class="client-stat">
              <div class="client-stat-value" style="color: #00ff88;">88%</div>
              <div class="client-stat-label">Compliance</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value">18</div>
              <div class="client-stat-label">Sessions</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value" style="color: #4169E1;">$800</div>
              <div class="client-stat-label">Monthly</div>
            </div>
          </div>
        </div>
        
        <div class="client-row" onclick="viewClient('emma')">
          <div class="client-avatar-lg" style="background: linear-gradient(135deg, #ff6b6b, #ffcc00);">EW</div>
          <div class="client-details">
            <div class="client-name-lg">Emma Wilson</div>
            <div class="client-meta-lg">Fat Loss  3x/week  Started Nov 2024</div>
          </div>
          <div class="client-stats">
            <div class="client-stat">
              <div class="client-stat-value" style="color: #ffcc00;">76%</div>
              <div class="client-stat-label">Compliance</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value">8</div>
              <div class="client-stat-label">Sessions</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value" style="color: #4169E1;">$450</div>
              <div class="client-stat-label">Monthly</div>
            </div>
          </div>
        </div>
        
        <div class="client-row" onclick="viewClient('david')">
          <div class="client-avatar-lg" style="background: linear-gradient(135deg, #ffcc00, #ff6b6b);">DP</div>
          <div class="client-details">
            <div class="client-name-lg">David Park</div>
            <div class="client-meta-lg">Athletic Performance  5x/week  Started Jun 2024</div>
          </div>
          <div class="client-stats">
            <div class="client-stat">
              <div class="client-stat-value" style="color: #00ff88;">98%</div>
              <div class="client-stat-label">Compliance</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value">24</div>
              <div class="client-stat-label">Sessions</div>
            </div>
            <div class="client-stat">
              <div class="client-stat-value" style="color: #4169E1;">$1,200</div>
              <div class="client-stat-label">Monthly</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Client Detail Page -->
    <div id="page-client-detail" class="page">
      <header class="header">
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn btn-secondary btn-sm" onclick="showPage('clients')" style="padding:8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <div class="client-avatar-lg" id="client-detail-avatar">SJ</div>
          <div>
            <h1 class="header-title" id="client-detail-name" style="margin:0;">Sarah Johnson</h1>
            <div style="font-size:12px;color:#666;" id="client-detail-meta">Hypertrophy  3x/week  Since Oct 2024</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="messageClient()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
            Message
          </button>
          <button class="btn btn-secondary btn-sm" onclick="editClientProgram()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg>
            Edit Program
          </button>
        </div>
      </header>
      
      <div class="content" style="display:grid;grid-template-columns:1fr 380px;gap:20px;height:calc(100vh - 80px);overflow:hidden;">
        <!-- Main Content Area -->
        <div style="overflow-y:auto;padding-right:10px;">
          <!-- Quick Stats -->
          <div class="grid-4" style="margin-bottom:20px;">
            <div class="stat-card">
              <div class="stat-value" id="client-stat-compliance" style="color:#00ff88;">94%</div>
              <div class="stat-label">Compliance</div>
              <div class="stat-change up" id="client-stat-compliance-trend"> 8% vs last month</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="client-stat-workouts">12</div>
              <div class="stat-label">Workouts (Dec)</div>
              <div class="stat-change up">On track</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="client-stat-weight">142 lbs</div>
              <div class="stat-label">Current Weight</div>
              <div class="stat-change up" id="client-stat-weight-trend"> 3 lbs this month</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="client-stat-streak">8</div>
              <div class="stat-label">Day Streak</div>
              <div class="stat-change">Personal best!</div>
            </div>
          </div>
          
          <!-- Performance Charts -->
          <div class="grid-2" style="margin-bottom:20px;">
            <div class="card">
              <div class="card-header">
                <span class="card-title">Strength Progress</span>
                <div class="chart-period-btns">
                  <button class="period-btn" onclick="updateClientChart('1m')">1M</button>
                  <button class="period-btn active" onclick="updateClientChart('3m')">3M</button>
                  <button class="period-btn" onclick="updateClientChart('6m')">6M</button>
                </div>
              </div>
              <div style="height:180px;position:relative;">
                <canvas id="clientStrengthChart"></canvas>
              </div>
            </div>
            <div class="card">
              <div class="card-header">
                <span class="card-title">Body Composition</span>
              </div>
              <div style="height:180px;position:relative;">
                <canvas id="clientBodyChart"></canvas>
              </div>
            </div>
          </div>
          
          <!-- Recent Activity & Nutrition -->
          <div class="grid-2">
            <div class="card">
              <div class="card-header">
                <span class="card-title">Recent Workouts</span>
                <span style="font-size:11px;color:#4169E1;cursor:pointer;">View All</span>
              </div>
              <div class="schedule-item">
                <div class="schedule-time" style="min-width:70px;">Today</div>
                <div class="schedule-info">
                  <div class="schedule-title">Upper Push</div>
                  <div class="schedule-meta">All sets completed  RPE 8 avg</div>
                </div>
                <span class="exercise-tag" style="background:#00ff8820;color:#00ff88;">Done</span>
              </div>
              <div class="schedule-item">
                <div class="schedule-time" style="min-width:70px;">Dec 20</div>
                <div class="schedule-info">
                  <div class="schedule-title">Lower Body</div>
                  <div class="schedule-meta">Squat PR: 185 lbs</div>
                </div>
                <span class="exercise-tag" style="background:#4169E120;color:#4169E1;">PR!</span>
              </div>
              <div class="schedule-item">
                <div class="schedule-time" style="min-width:70px;">Dec 18</div>
                <div class="schedule-info">
                  <div class="schedule-title">Pull Day</div>
                  <div class="schedule-meta">Skipped last 2 exercises</div>
                </div>
                <span class="exercise-tag" style="background:#ffcc0020;color:#ffcc00;">Partial</span>
              </div>
            </div>
            
            <div class="card">
              <div class="card-header">
                <span class="card-title">Nutrition (7-day avg)</span>
              </div>
              <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:12px;">
                <div style="text-align:center;">
                  <div style="font-size:18px;font-weight:700;">1,820</div>
                  <div style="font-size:10px;color:#666;">CALORIES</div>
                  <div style="font-size:10px;color:#00ff88;"> 180 deficit</div>
                </div>
                <div style="text-align:center;">
                  <div style="font-size:18px;font-weight:700;color:#4169E1;">142g</div>
                  <div style="font-size:10px;color:#666;">PROTEIN</div>
                  <div style="font-size:10px;color:#00ff88;"> On target</div>
                </div>
                <div style="text-align:center;">
                  <div style="font-size:18px;font-weight:700;color:#ffcc00;">165g</div>
                  <div style="font-size:10px;color:#666;">CARBS</div>
                  <div style="font-size:10px;color:#888;">-15g</div>
                </div>
                <div style="text-align:center;">
                  <div style="font-size:18px;font-weight:700;color:#ff6b6b;">58g</div>
                  <div style="font-size:10px;color:#666;">FATS</div>
                  <div style="font-size:10px;color:#888;">+3g</div>
                </div>
              </div>
              <div style="height:6px;background:#222;border-radius:3px;overflow:hidden;display:flex;">
                <div style="width:31%;background:#4169E1;"></div>
                <div style="width:36%;background:#ffcc00;"></div>
                <div style="width:28%;background:#ff6b6b;"></div>
              </div>
              <div style="font-size:10px;color:#666;margin-top:6px;text-align:center;">Protein 31%  Carbs 36%  Fats 28%</div>
            </div>
          </div>
        </div>
        
        <!-- LiftAssistant Insights Panel -->
        <div class="card" style="display:flex;flex-direction:column;height:100%;margin:0;overflow:hidden;">
          <div style="padding:16px;border-bottom:1px solid #222;display:flex;align-items:center;gap:10px;">
            <div style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#4169E1,#00ff88);display:flex;align-items:center;justify-content:center;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"/></svg>
            </div>
            <div style="flex:1;">
              <div style="font-weight:600;font-size:14px;"><span>Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span> Insights</div>
              <div style="font-size:11px;color:#666;">Analyzing 12 weeks of data</div>
            </div>
            <div style="width:8px;height:8px;border-radius:50%;background:#00ff88;"></div>
          </div>
          
          <!-- Insights Feed -->
          <div style="flex:1;overflow-y:auto;padding:12px;" id="client-insights-feed">
            <!-- Priority Alert -->
            <div class="insight-card priority">
              <div class="insight-header">
                <span class="insight-icon"></span>
                <span class="insight-type">Action Needed</span>
                <span class="insight-time">Just now</span>
              </div>
              <div class="insight-title">Recovery Pattern Detected</div>
              <div class="insight-body">Sarah's HRV has dropped 15% over the past 5 days while sleep quality decreased. Combined with her partial workout on Dec 18, she may be approaching overtraining.</div>
              <div class="insight-suggestion">
                <strong>Suggestion:</strong> Consider a deload week or reduce volume by 20% for the next 3-4 sessions. Check in about stress/sleep.
              </div>
              <div class="insight-actions">
                <button class="insight-btn primary" onclick="applyInsight('deload')">Apply Deload</button>
                <button class="insight-btn" onclick="dismissInsight(this)">Dismiss</button>
              </div>
            </div>
            
            <!-- Positive Trend -->
            <div class="insight-card positive">
              <div class="insight-header">
                <span class="insight-icon"></span>
                <span class="insight-type">Trend</span>
                <span class="insight-time">2 hours ago</span>
              </div>
              <div class="insight-title">Strength Gains Accelerating</div>
              <div class="insight-body">Bench press has increased 12% in 6 weeks (95107 lbs). This exceeds the typical 5-8% for her training age. Squat PR yesterday confirms progressive overload is working.</div>
              <div class="insight-suggestion">
                <strong>Coaching tip:</strong> Celebrate this win! Consider discussing long-term strength goals in your next session.
              </div>
            </div>
            
            <!-- Nutrition Insight -->
            <div class="insight-card nutrition">
              <div class="insight-header">
                <span class="insight-icon"></span>
                <span class="insight-type">Nutrition</span>
                <span class="insight-time">Yesterday</span>
              </div>
              <div class="insight-title">Protein Timing Opportunity</div>
              <div class="insight-body">Analysis shows Sarah consistently logs protein-heavy meals at dinner (60% of daily intake) but minimal protein at breakfast. Post-workout protein is often delayed 3+ hours.</div>
              <div class="insight-suggestion">
                <strong>Suggestion:</strong> Recommend redistributing protein across meals. A morning shake could improve muscle protein synthesis by ~15%.
              </div>
              <div class="insight-actions">
                <button class="insight-btn" onclick="sendNutritionTip()">Send Tip to Sarah</button>
              </div>
            </div>
            
            <!-- Habit Pattern -->
            <div class="insight-card habit">
              <div class="insight-header">
                <span class="insight-icon"></span>
                <span class="insight-type">Pattern</span>
                <span class="insight-time">3 days ago</span>
              </div>
              <div class="insight-title">Weekend Compliance Drop</div>
              <div class="insight-body">Nutrition logging drops 40% on weekends (last 8 weeks). Saturday workouts are skipped 3x more often than weekday sessions.</div>
              <div class="insight-suggestion">
                <strong>Coaching opportunity:</strong> Discuss weekend routine. Consider moving Saturday workout to Sunday or creating a flexible "weekend workout" option.
              </div>
            </div>
            
            <!-- Milestone -->
            <div class="insight-card milestone">
              <div class="insight-header">
                <span class="insight-icon"></span>
                <span class="insight-type">Milestone</span>
                <span class="insight-time">1 week ago</span>
              </div>
              <div class="insight-title">8-Week Consistency Streak</div>
              <div class="insight-body">Sarah has logged workouts for 8 consecutive weeks - her longest streak since starting. Compliance is up 23% compared to her first month.</div>
            </div>
          </div>
          
          <!-- Ask LiftAssistant -->
          <div style="padding:12px;border-top:1px solid #222;">
            <div style="display:flex;gap:8px;">
              <input type="text" id="client-ai-input" placeholder="Ask about Sarah's progress..." style="flex:1;padding:10px 14px;background:#0a0a0a;border:1px solid #333;border-radius:8px;color:#fff;font-size:13px;">
              <button class="btn btn-sm" onclick="askClientAI()" style="padding:10px 14px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
              </button>
            </div>
            <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
              <button class="ai-quick-chip" onclick="askClientAI('What should I focus on next session?')">Next session focus</button>
              <button class="ai-quick-chip" onclick="askClientAI('Is she ready for a program change?')">Program change?</button>
              <button class="ai-quick-chip" onclick="askClientAI('Summarize this month')">Monthly summary</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- LiftAssistant Page -->
    <div id="page-ai-coach" class="page">
      <header class="header">
        <h1 class="header-title"><span>Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span></h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm">View History</button>
        </div>
      </header>
      
      <div class="content">
        <div style="display: grid; grid-template-columns: 1fr 350px; gap: 24px; height: calc(100vh - 140px);">
          <!-- Main Chat Area -->
          <div class="card" style="display: flex; flex-direction: column; padding: 0; overflow: hidden;">
            <div style="padding: 16px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 12px;">
              <div class="ai-panel-icon">
                <svg width="22" height="22" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="#fff"/></svg>
              </div>
              <div>
                <div style="font-weight: 600;">LiftWise AI</div>
                <div style="font-size: 12px; color: #666;">Programming Assistant  GPT-4</div>
              </div>
            </div>
            
            <div style="flex: 1; overflow-y: auto; padding: 16px;" id="desktop-ai-messages">
              <!-- AI Welcome Message -->
              <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="22" height="22" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="#fff"/></svg>
                </div>
                <div style="background: #1a1a1a; border-radius: 12px; padding: 16px; max-width: 80%;">
                  <div style="font-size: 12px; color: #4169E1; margin-bottom: 8px;">LiftWise AI</div>
                  <div style="line-height: 1.6;">
                    Hey! I'm your AI programming assistant. I can help you with:
                    <ul style="margin: 12px 0 0 20px; color: #ccc;">
                      <li>Creating periodized training programs</li>
                      <li>Bulk scheduling and rescheduling sessions</li>
                      <li>Generating deload weeks</li>
                      <li>Analyzing client progress</li>
                      <li>Exercise substitutions and progressions</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <div style="padding: 16px; border-top: 1px solid #222;">
              <div style="display: flex; gap: 12px;">
                <textarea id="desktop-ai-input" style="flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 12px; padding: 14px; color: #fff; font-size: 14px; resize: none; height: 52px; font-family: inherit;" placeholder="Ask me anything about programming, scheduling, or client management..."></textarea>
                <button class="btn" onclick="sendDesktopAIMessage()">
                  <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Quick Actions Sidebar -->
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div class="card">
              <div class="card-title" style="margin-bottom: 16px;">Quick Commands</div>
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <button class="btn btn-secondary btn-sm" style="justify-content: flex-start;" onclick="setDesktopPrompt('Create a 4-week hypertrophy program for Sarah Johnson')">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                  Create Program
                </button>
                <button class="btn btn-secondary btn-sm" style="justify-content: flex-start;" onclick="setDesktopPrompt('Generate a deload week for all clients starting Monday')">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                  Deload Week
                </button>
                <button class="btn btn-secondary btn-sm" style="justify-content: flex-start;" onclick="setDesktopPrompt('Reschedule all sessions for Mike Chen to morning slots')">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>
                  Reschedule
                </button>
                <button class="btn btn-secondary btn-sm" style="justify-content: flex-start;" onclick="setDesktopPrompt('Analyze progress for Emma Wilson over the last 4 weeks')">
                  <svg viewBox="0 0 24 24" style="width:16px;height:16px;"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
                  Analyze Progress
                </button>
              </div>
            </div>
            
            <div class="card">
              <div class="card-title" style="margin-bottom: 16px;">Select Client</div>
              <select style="width: 100%; padding: 12px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; font-size: 14px;">
                <option>All Clients</option>
                <option>Sarah Johnson</option>
                <option>Mike Chen</option>
                <option>Emma Wilson</option>
                <option>David Park</option>
              </select>
            </div>
            
            <div class="card" style="flex: 1;">
              <div class="card-title" style="margin-bottom: 16px;">Recent Actions</div>
              <div style="font-size: 13px; color: #666;">
                <div style="padding: 8px 0; border-bottom: 1px solid #222;">Created 4-week program for Sarah</div>
                <div style="padding: 8px 0; border-bottom: 1px solid #222;">Rescheduled Mike's Thursday session</div>
                <div style="padding: 8px 0;">Generated deload for David</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Placeholder pages -->
    <div id="page-messages" class="page">
      <header class="header"><h1 class="header-title">Messages</h1></header>
      <div class="content"><div class="card"><p style="color:#666;">Messages interface coming soon...</p></div></div>
    </div>
    
    <!-- Communities Page -->
    <div id="page-communities" class="page">
      <header class="header">
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </button>
        <h1 class="header-title">Communities</h1>
        <div class="header-actions">
          <button class="btn" onclick="openCreateCommunityModal()">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            New Community
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Community Stats -->
        <div class="grid-4" style="margin-bottom: 20px;">
          <div class="stat-card">
            <div class="stat-value" style="background:linear-gradient(90deg,#764ba2,#667eea);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">3</div>
            <div class="stat-label">Active Communities</div>
          </div>
          <div class="stat-card">
            <div class="stat-value blue">24</div>
            <div class="stat-label">Total Members</div>
          </div>
          <div class="stat-card">
            <div class="stat-value green">156</div>
            <div class="stat-label">Messages This Week</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">5</div>
            <div class="stat-label">Upcoming Events</div>
          </div>
        </div>
        
        <!-- Communities Grid -->
        <div class="grid-3" id="communities-grid">
          <!-- 6AM Crew -->
          <div class="community-card" onclick="viewCommunity('6am-crew')">
            <div class="community-header">
              <div class="community-icon" style="background:linear-gradient(135deg,#ff6b6b,#ffcc00);"><svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M12.5 7.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5v4.29l-2.15 2.15c-.2.2-.2.51 0 .71.1.1.23.15.35.15s.26-.05.35-.15l2.29-2.29c.09-.09.16-.21.16-.35V7.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></div>
              <div class="community-badge accountability">Accountability</div>
            </div>
            <div class="community-name">6AM Crew</div>
            <div class="community-desc">Early morning warriors! Share your wins and keep each other accountable.</div>
            <div class="community-stats-row">
              <div class="community-stat">
                <span class="community-stat-value">8</span>
                <span class="community-stat-label">Members</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">45</span>
                <span class="community-stat-label">Messages</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">2</span>
                <span class="community-stat-label">Events</span>
              </div>
            </div>
            <div class="community-activity">
              <div class="community-activity-dot"></div>
              <span>3 new messages today</span>
            </div>
          </div>
          
          <!-- HYROX Prep -->
          <div class="community-card" onclick="viewCommunity('hyrox-prep')">
            <div class="community-header">
              <div class="community-icon" style="background:linear-gradient(135deg,#4169E1,#00ff88);"><svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z"/></svg></div>
              <div class="community-badge program">Program</div>
            </div>
            <div class="community-name">HYROX Prep 2025</div>
            <div class="community-desc">Training together for the January HYROX race. Tips, workouts, and motivation.</div>
            <div class="community-stats-row">
              <div class="community-stat">
                <span class="community-stat-value">12</span>
                <span class="community-stat-label">Members</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">89</span>
                <span class="community-stat-label">Messages</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">3</span>
                <span class="community-stat-label">Events</span>
              </div>
            </div>
            <div class="community-activity">
              <div class="community-activity-dot"></div>
              <span>Race simulation this Saturday!</span>
            </div>
          </div>
          
          <!-- Nutrition Challenge -->
          <div class="community-card" onclick="viewCommunity('nutrition-challenge')">
            <div class="community-header">
              <div class="community-icon" style="background:linear-gradient(135deg,#00ff88,#4169E1);"><svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l7.59-7.59L21 8l-9 9z"/></svg></div>
              <div class="community-badge challenge">Challenge</div>
            </div>
            <div class="community-name">Nutrition Challenge</div>
            <div class="community-desc">30-day nutrition challenge group. Daily check-ins and meal sharing.</div>
            <div class="community-stats-row">
              <div class="community-stat">
                <span class="community-stat-value">15</span>
                <span class="community-stat-label">Members</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">122</span>
                <span class="community-stat-label">Messages</span>
              </div>
              <div class="community-stat">
                <span class="community-stat-value">1</span>
                <span class="community-stat-label">Events</span>
              </div>
            </div>
            <div class="community-activity">
              <div class="community-activity-dot" style="background:#ffcc00;"></div>
              <span>Day 12 of 30 - 85% participation</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Community Detail Modal -->
    <div class="community-modal" id="community-modal">
      <div class="community-modal-content">
        <div class="community-modal-header">
          <div style="display:flex;align-items:center;gap:12px;">
            <div class="community-icon" id="modal-community-icon" style="background:linear-gradient(135deg,#ff6b6b,#ffcc00);"><svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M12.5 7.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5v4.29l-2.15 2.15c-.2.2-.2.51 0 .71.1.1.23.15.35.15s.26-.05.35-.15l2.29-2.29c.09-.09.16-.21.16-.35V7.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></div>
            <div>
              <div class="community-modal-title" id="modal-community-name">6AM Crew</div>
              <div class="community-modal-subtitle" id="modal-community-type">Accountability Group  8 members</div>
            </div>
          </div>
          <button class="community-modal-close" onclick="closeCommunityModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </div>
        
        <div class="community-modal-tabs">
          <button class="community-tab active" onclick="showCommunityTab('chat')">Chat</button>
          <button class="community-tab" onclick="showCommunityTab('events')">Events</button>
          <button class="community-tab" onclick="showCommunityTab('members')">Members</button>
          <button class="community-tab" onclick="showCommunityTab('settings')">Settings</button>
        </div>
        
        <!-- Chat Tab -->
        <div class="community-tab-content active" id="community-chat">
          <div class="community-chat-messages" id="community-messages">
            <div class="community-message announcement">
              <div class="community-message-header">
                <span class="community-message-sender"> Alex Trainer</span>
                <span class="community-message-time">Yesterday</span>
              </div>
              <div class="community-message-content">Welcome to the 6AM Crew! Let's crush it together. Post your morning workout wins here! </div>
            </div>
            <div class="community-message">
              <div class="community-message-avatar">SJ</div>
              <div class="community-message-body">
                <div class="community-message-header">
                  <span class="community-message-sender">Sarah Johnson</span>
                  <span class="community-message-time">2h ago</span>
                </div>
                <div class="community-message-content">Crushed my 5am workout today!  New PR on deadlifts - 185 lbs!</div>
              </div>
            </div>
            <div class="community-message">
              <div class="community-message-avatar" style="background:linear-gradient(135deg,#00ff88,#4169E1);">MC</div>
              <div class="community-message-body">
                <div class="community-message-header">
                  <span class="community-message-sender">Mike Chen</span>
                  <span class="community-message-time">1h ago</span>
                </div>
                <div class="community-message-content">Nice Sarah! I hit a new PR on deadlifts this morning too. Something in the water today </div>
              </div>
            </div>
            <div class="community-message">
              <div class="community-message-avatar" style="background:linear-gradient(135deg,#4169E1,#00ff88);">AT</div>
              <div class="community-message-body">
                <div class="community-message-header">
                  <span class="community-message-sender">Alex Trainer</span>
                  <span class="community-message-time">30m ago</span>
                </div>
                <div class="community-message-content">Love seeing this energy! Keep it up team  Remember, Saturday we have the group workout at the park!</div>
              </div>
            </div>
          </div>
          <div class="community-chat-input">
            <input type="text" id="community-message-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter')sendCommunityMessage()">
            <button class="btn btn-sm" onclick="sendCommunityMessage()">Send</button>
          </div>
        </div>
        
        <!-- Events Tab -->
        <div class="community-tab-content" id="community-events">
          <button class="btn btn-secondary" style="margin-bottom:16px;" onclick="openCreateEventModal()">
            <svg viewBox="0 0 24 24" width="16" height="16"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/></svg>
            Create Event
          </button>
          <div class="community-events-list">
            <div class="community-event-card">
              <div class="community-event-date">
                <div class="community-event-month">DEC</div>
                <div class="community-event-day">26</div>
              </div>
              <div class="community-event-info">
                <div class="community-event-title">Saturday Group Workout</div>
                <div class="community-event-meta">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="#666"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                  9:00 AM
                </div>
                <div class="community-event-meta">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="#666"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                  Golden Gate Park
                </div>
              </div>
              <div class="community-event-rsvp">
                <div class="community-event-going">6 going</div>
                <button class="btn btn-sm btn-secondary">RSVP</button>
              </div>
            </div>
            <div class="community-event-card">
              <div class="community-event-date">
                <div class="community-event-month">JAN</div>
                <div class="community-event-day">02</div>
              </div>
              <div class="community-event-info">
                <div class="community-event-title">New Year Kickoff Challenge</div>
                <div class="community-event-meta">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="#666"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                  6:00 AM
                </div>
                <div class="community-event-meta">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="#666"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg>
                  Virtual - Zoom
                </div>
              </div>
              <div class="community-event-rsvp">
                <div class="community-event-going">8 going</div>
                <button class="btn btn-sm">Going </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Members Tab -->
        <div class="community-tab-content" id="community-members">
          <button class="btn btn-secondary" style="margin-bottom:16px;" onclick="openAddMembersModal()">
            <svg viewBox="0 0 24 24" width="16" height="16"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/></svg>
            Add Members
          </button>
          <div class="community-members-list">
            <div class="community-member">
              <div class="community-member-avatar" style="background:linear-gradient(135deg,#4169E1,#00ff88);">AT</div>
              <div class="community-member-info">
                <div class="community-member-name">Alex Trainer</div>
                <div class="community-member-role admin">Admin</div>
              </div>
              <div class="community-member-status online"></div>
            </div>
            <div class="community-member">
              <div class="community-member-avatar">SJ</div>
              <div class="community-member-info">
                <div class="community-member-name">Sarah Johnson</div>
                <div class="community-member-role">Member</div>
              </div>
              <div class="community-member-status online"></div>
            </div>
            <div class="community-member">
              <div class="community-member-avatar" style="background:linear-gradient(135deg,#00ff88,#4169E1);">MC</div>
              <div class="community-member-info">
                <div class="community-member-name">Mike Chen</div>
                <div class="community-member-role">Member</div>
              </div>
              <div class="community-member-status"></div>
            </div>
            <div class="community-member">
              <div class="community-member-avatar" style="background:linear-gradient(135deg,#ff6b6b,#ffcc00);">EW</div>
              <div class="community-member-info">
                <div class="community-member-name">Emma Wilson</div>
                <div class="community-member-role">Member</div>
              </div>
              <div class="community-member-status online"></div>
            </div>
            <div class="community-member">
              <div class="community-member-avatar" style="background:linear-gradient(135deg,#764ba2,#667eea);">DK</div>
              <div class="community-member-info">
                <div class="community-member-name">David Kim</div>
                <div class="community-member-role">Member</div>
              </div>
              <div class="community-member-status"></div>
            </div>
          </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="community-tab-content" id="community-settings">
          <div class="community-settings-section">
            <label class="input-label">Community Name</label>
            <input type="text" class="nutrition-input" value="6AM Crew">
          </div>
          <div class="community-settings-section">
            <label class="input-label">Description</label>
            <textarea class="nutrition-input" rows="3">Early morning warriors! Share your wins and keep each other accountable.</textarea>
          </div>
          <div class="community-settings-section">
            <label class="input-label">Community Type</label>
            <select class="nutrition-input">
              <option value="accountability" selected>Accountability Group</option>
              <option value="program">Program Group</option>
              <option value="challenge">Challenge</option>
              <option value="general">General</option>
            </select>
          </div>
          <div class="community-settings-section">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input type="checkbox" checked> Allow members to post
            </label>
          </div>
          <div class="community-settings-section">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
              <input type="checkbox"> Allow members to create events
            </label>
          </div>
          <div style="display:flex;gap:12px;margin-top:20px;">
            <button class="btn" onclick="saveCommunitySettings()">Save Changes</button>
            <button class="btn btn-secondary" style="color:#ff6b6b;border-color:#ff6b6b;" onclick="deleteCommunity()">Delete Community</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Create Community Modal -->
    <div class="community-modal" id="create-community-modal">
      <div class="community-modal-content" style="max-width:500px;">
        <div class="community-modal-header">
          <div class="community-modal-title">Create New Community</div>
          <button class="community-modal-close" onclick="closeCreateCommunityModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </div>
        <div style="padding:20px;">
          <div class="community-settings-section">
            <label class="input-label">Community Name</label>
            <input type="text" class="nutrition-input" id="new-community-name" placeholder="e.g., Morning Warriors">
          </div>
          <div class="community-settings-section">
            <label class="input-label">Description</label>
            <textarea class="nutrition-input" id="new-community-desc" rows="3" placeholder="What's this community about?"></textarea>
          </div>
          <div class="community-settings-section">
            <label class="input-label">Community Type</label>
            <select class="nutrition-input" id="new-community-type">
              <option value="general">General</option>
              <option value="accountability">Accountability Group</option>
              <option value="program">Program Group</option>
              <option value="challenge">Challenge</option>
            </select>
          </div>
          <div class="community-settings-section">
            <label class="input-label">Add Members</label>
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;">
              <label class="member-checkbox"><input type="checkbox" value="sarah"> Sarah Johnson</label>
              <label class="member-checkbox"><input type="checkbox" value="mike"> Mike Chen</label>
              <label class="member-checkbox"><input type="checkbox" value="emma"> Emma Wilson</label>
              <label class="member-checkbox"><input type="checkbox" value="david"> David Kim</label>
              <label class="member-checkbox"><input type="checkbox" value="lisa"> Lisa Park</label>
              <label class="member-checkbox"><input type="checkbox" value="james"> James Brown</label>
            </div>
          </div>
          <button class="btn" style="width:100%;margin-top:16px;" onclick="createCommunity()">Create Community</button>
        </div>
      </div>
    </div>
    
    <!-- Programs Repository Page -->
    <div id="page-programs" class="page">
      <header class="header">
        <h1 class="header-title">Programs</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm">
            <svg viewBox="0 0 24 24"><path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/></svg>
            Filter
          </button>
          <button class="btn" onclick="showPage('studio')">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Create New
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Program Stats -->
        <div class="grid-4" style="margin-bottom: 20px;">
          <div class="stat-card">
            <div class="stat-value blue">8</div>
            <div class="stat-label">Active Programs</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">15</div>
            <div class="stat-label">Templates</div>
          </div>
          <div class="stat-card">
            <div class="stat-value green">12</div>
            <div class="stat-label">Clients Assigned</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">94%</div>
            <div class="stat-label">Avg Completion</div>
          </div>
        </div>
        
        <!-- Tabs -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button class="nutrition-tab active" onclick="showProgramsTab('active')">Active Programs</button>
          <button class="nutrition-tab" onclick="showProgramsTab('templates')">Templates</button>
          <button class="nutrition-tab" onclick="showProgramsTab('archived')">Archived</button>
        </div>
        
        <!-- Active Programs Grid -->
        <div id="programs-active" class="grid-3">
          <div class="plan-card" onclick="editProgram('ppl')">
            <div class="plan-header">
              <div class="plan-avatar">SJ</div>
              <div>
                <div class="plan-client">Push/Pull/Legs</div>
                <div class="plan-meta">Sarah Johnson  Week 3 of 8</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
              <span class="exercise-tag bodypart">Hypertrophy</span>
              <span class="exercise-tag equipment">4 days/week</span>
            </div>
            <div class="plan-compliance"><div class="plan-compliance-bar" style="width:85%;"></div></div>
            <div class="plan-compliance-text">85% compliance this week</div>
          </div>
          
          <div class="plan-card" onclick="editProgram('strength')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:linear-gradient(135deg,#00ff88,#4169E1);">MC</div>
              <div>
                <div class="plan-client">Strength Builder</div>
                <div class="plan-meta">Mike Chen  Week 6 of 12</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
              <span class="exercise-tag bodypart">Strength</span>
              <span class="exercise-tag equipment">5 days/week</span>
            </div>
            <div class="plan-compliance"><div class="plan-compliance-bar" style="width:92%;"></div></div>
            <div class="plan-compliance-text">92% compliance this week</div>
          </div>
          
          <div class="plan-card" onclick="editProgram('cut')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:linear-gradient(135deg,#ff6b6b,#ffcc00);">EW</div>
              <div>
                <div class="plan-client">Summer Cut</div>
                <div class="plan-meta">Emma Wilson  Week 2 of 6</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
              <span class="exercise-tag bodypart">Fat Loss</span>
              <span class="exercise-tag equipment">6 days/week</span>
            </div>
            <div class="plan-compliance"><div class="plan-compliance-bar" style="width:78%;"></div></div>
            <div class="plan-compliance-text">78% compliance this week</div>
          </div>
          
          <div class="plan-card" onclick="editProgram('beginner')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:linear-gradient(135deg,#4169E1,#00ff88);">DP</div>
              <div>
                <div class="plan-client">Beginner Foundations</div>
                <div class="plan-meta">David Park  Week 1 of 4</div>
              </div>
            </div>
            <div style="display:flex;gap:8px;margin-bottom:12px;">
              <span class="exercise-tag bodypart">General</span>
              <span class="exercise-tag equipment">3 days/week</span>
            </div>
            <div class="plan-compliance"><div class="plan-compliance-bar" style="width:100%;"></div></div>
            <div class="plan-compliance-text">100% compliance this week</div>
          </div>
        </div>
        
        <!-- Templates (hidden by default) -->
        <div id="programs-templates" class="grid-3" style="display:none;">
          <div class="plan-card" style="border-style:dashed;cursor:pointer;" onclick="showPage('studio')">
            <div style="text-align:center;padding:20px 0;">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="#4169E1"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
              <div style="margin-top:8px;color:#888;">Create New Template</div>
            </div>
          </div>
          
          <div class="plan-card" onclick="useTemplate('ppl')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:#333;"></div>
              <div>
                <div class="plan-client">PPL Classic</div>
                <div class="plan-meta">Push/Pull/Legs  6 days</div>
              </div>
            </div>
            <div style="font-size:12px;color:#888;margin-top:8px;">Used 24 times  Last updated Nov 15</div>
          </div>
          
          <div class="plan-card" onclick="useTemplate('upper-lower')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:#333;"></div>
              <div>
                <div class="plan-client">Upper/Lower Split</div>
                <div class="plan-meta">4 day split  Intermediate</div>
              </div>
            </div>
            <div style="font-size:12px;color:#888;margin-top:8px;">Used 18 times  Last updated Dec 1</div>
          </div>
          
          <div class="plan-card" onclick="useTemplate('fullbody')">
            <div class="plan-header">
              <div class="plan-avatar" style="background:#333;"></div>
              <div>
                <div class="plan-client">Full Body 3x</div>
                <div class="plan-meta">3 day full body  Beginner</div>
              </div>
            </div>
            <div style="font-size:12px;color:#888;margin-top:8px;">Used 31 times  Last updated Oct 20</div>
          </div>
        </div>
        
        <!-- Archived (hidden by default) -->
        <div id="programs-archived" style="display:none;">
          <div class="card" style="text-align:center;padding:40px;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="#333"><path d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>
            <div style="color:#666;margin-top:12px;">No archived programs</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Program Detail View Page -->
    <div id="page-program-detail" class="page">
      <header class="header">
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn btn-secondary btn-sm" onclick="showPage('programs')" style="padding:8px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
          </button>
          <h1 class="header-title" id="program-detail-title">Push/Pull/Legs</h1>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="duplicateProgram()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            Duplicate
          </button>
          <button class="btn" onclick="editInStudio()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
            Edit in Studio
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Program Overview -->
        <div class="grid-2" style="margin-bottom:20px;">
          <div class="card">
            <div class="card-header">
              <span class="card-title">Program Info</span>
              <span class="exercise-tag bodypart" id="program-detail-type">Hypertrophy</span>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
              <div>
                <div style="font-size:11px;color:#666;text-transform:uppercase;margin-bottom:4px;">Client</div>
                <div style="font-size:14px;font-weight:500;" id="program-detail-client">Sarah Johnson</div>
              </div>
              <div>
                <div style="font-size:11px;color:#666;text-transform:uppercase;margin-bottom:4px;">Duration</div>
                <div style="font-size:14px;font-weight:500;" id="program-detail-duration">8 weeks</div>
              </div>
              <div>
                <div style="font-size:11px;color:#666;text-transform:uppercase;margin-bottom:4px;">Frequency</div>
                <div style="font-size:14px;font-weight:500;" id="program-detail-frequency">4 days/week</div>
              </div>
              <div>
                <div style="font-size:11px;color:#666;text-transform:uppercase;margin-bottom:4px;">Current Week</div>
                <div style="font-size:14px;font-weight:500;" id="program-detail-week">Week 3 of 8</div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <span class="card-title">Progress</span>
            </div>
            <div style="margin-bottom:16px;">
              <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
                <span style="font-size:12px;color:#888;">Overall Completion</span>
                <span style="font-size:12px;font-weight:600;" id="program-detail-completion">37%</span>
              </div>
              <div style="height:8px;background:#222;border-radius:4px;overflow:hidden;">
                <div style="height:100%;width:37%;background:linear-gradient(90deg,#4169E1,#00ff88);border-radius:4px;" id="program-detail-progress-bar"></div>
              </div>
            </div>
            <div class="stats-row" style="justify-content:space-between;">
              <div class="stat-item" style="flex:none;">
                <div class="stat-value" style="font-size:24px;color:#00ff88;" id="program-detail-compliance">85%</div>
                <div class="stat-label">Compliance</div>
              </div>
              <div class="stat-item" style="flex:none;">
                <div class="stat-value" style="font-size:24px;" id="program-detail-workouts">12</div>
                <div class="stat-label">Workouts Done</div>
              </div>
              <div class="stat-item" style="flex:none;">
                <div class="stat-value" style="font-size:24px;" id="program-detail-remaining">20</div>
                <div class="stat-label">Remaining</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Weekly Schedule -->
        <div class="card" style="margin-bottom:20px;">
          <div class="card-header">
            <span class="card-title">Weekly Schedule</span>
            <div style="display:flex;gap:4px;">
              <button class="period-btn" onclick="viewProgramWeek(1)">Wk 1</button>
              <button class="period-btn" onclick="viewProgramWeek(2)">Wk 2</button>
              <button class="period-btn active" onclick="viewProgramWeek(3)">Wk 3</button>
              <button class="period-btn" onclick="viewProgramWeek(4)">Wk 4</button>
            </div>
          </div>
          
          <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:8px;" id="program-week-view">
            <div class="program-day-card">
              <div class="program-day-name">Mon</div>
              <div class="program-day-focus">Push</div>
              <div class="program-day-exercises">
                <div>Bench Press</div>
                <div>Incline DB Press</div>
                <div>Shoulder Press</div>
                <div>Lateral Raises</div>
                <div>Tricep Pushdown</div>
              </div>
              <div class="program-day-status completed"> Completed</div>
            </div>
            <div class="program-day-card">
              <div class="program-day-name">Tue</div>
              <div class="program-day-focus">Pull</div>
              <div class="program-day-exercises">
                <div>Barbell Row</div>
                <div>Lat Pulldown</div>
                <div>Seated Cable Row</div>
                <div>Face Pulls</div>
                <div>Barbell Curl</div>
              </div>
              <div class="program-day-status completed"> Completed</div>
            </div>
            <div class="program-day-card">
              <div class="program-day-name">Wed</div>
              <div class="program-day-focus">Rest</div>
              <div class="program-day-exercises" style="color:#444;">
                <div>Recovery Day</div>
              </div>
              <div class="program-day-status rest">Rest</div>
            </div>
            <div class="program-day-card today">
              <div class="program-day-name">Thu</div>
              <div class="program-day-focus">Legs</div>
              <div class="program-day-exercises">
                <div>Barbell Squat</div>
                <div>Romanian Deadlift</div>
                <div>Leg Press</div>
                <div>Leg Curl</div>
                <div>Calf Raises</div>
              </div>
              <div class="program-day-status today">Today</div>
            </div>
            <div class="program-day-card">
              <div class="program-day-name">Fri</div>
              <div class="program-day-focus">Upper</div>
              <div class="program-day-exercises">
                <div>Incline Bench</div>
                <div>Pull-ups</div>
                <div>DB Shoulder Press</div>
                <div>Cable Flyes</div>
                <div>Hammer Curls</div>
              </div>
              <div class="program-day-status pending">Upcoming</div>
            </div>
            <div class="program-day-card">
              <div class="program-day-name">Sat</div>
              <div class="program-day-focus">Cardio</div>
              <div class="program-day-exercises" style="color:#666;">
                <div>30 min LISS</div>
                <div>or HIIT 15 min</div>
              </div>
              <div class="program-day-status pending">Upcoming</div>
            </div>
            <div class="program-day-card">
              <div class="program-day-name">Sun</div>
              <div class="program-day-focus">Rest</div>
              <div class="program-day-exercises" style="color:#444;">
                <div>Recovery Day</div>
              </div>
              <div class="program-day-status rest">Rest</div>
            </div>
          </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">Recent Activity</span>
          </div>
          <div class="schedule-item">
            <div class="schedule-time" style="min-width:80px;">Today</div>
            <div class="schedule-info">
              <div class="schedule-title">Legs workout scheduled</div>
              <div class="schedule-meta">5 exercises  Est. 55 min</div>
            </div>
            <span class="exercise-tag" style="background:#ffcc0020;color:#ffcc00;">Pending</span>
          </div>
          <div class="schedule-item">
            <div class="schedule-time" style="min-width:80px;">Yesterday</div>
            <div class="schedule-info">
              <div class="schedule-title">Pull workout completed</div>
              <div class="schedule-meta">All sets completed  48 min</div>
            </div>
            <span class="exercise-tag" style="background:#00ff8820;color:#00ff88;">Done</span>
          </div>
          <div class="schedule-item">
            <div class="schedule-time" style="min-width:80px;">Dec 18</div>
            <div class="schedule-info">
              <div class="schedule-title">Push workout completed</div>
              <div class="schedule-meta">All sets completed  52 min</div>
            </div>
            <span class="exercise-tag" style="background:#00ff8820;color:#00ff88;">Done</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Program Studio Page -->
    <div id="page-studio" class="page">
      <header class="header">
        <h1 class="header-title">Program Studio</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="showPage('programs')">
            <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            My Programs
          </button>
          <button class="btn" onclick="openNewProgramModal()">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            New Program
          </button>
        </div>
      </header>
      
      <div class="content" style="padding: 0; display: flex; height: calc(100vh - 60px);" id="studio-content">
        <!-- Left Panel: Exercise Library -->
        <div class="studio-panel studio-exercises" id="panel-exercises">
          <div class="studio-panel-header">
            <span class="studio-panel-title">Exercise Library</span>
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="studio-panel-count" id="exercise-count">0 exercises</span>
              <button class="panel-toggle-btn" onclick="togglePanel('exercises')" title="Collapse panel">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
              </button>
            </div>
          </div>
          <div class="studio-panel-body" id="panel-exercises-body">
            <div class="studio-search">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="#666"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
              <input type="text" id="studio-exercise-search" placeholder="Search exercises..." oninput="filterStudioExercises()">
            </div>
            <div class="studio-filters">
              <select id="studio-bodypart" onchange="filterStudioExercises()">
                <option value="">All Body Parts</option>
                <option value="chest">Chest</option>
                <option value="back">Back</option>
                <option value="shoulders">Shoulders</option>
                <option value="upper arms">Arms</option>
                <option value="upper legs">Legs</option>
                <option value="waist">Core</option>
              </select>
              <select id="studio-equipment" onchange="filterStudioExercises()">
                <option value="">All Equipment</option>
                <option value="barbell">Barbell</option>
                <option value="dumbbell">Dumbbell</option>
                <option value="cable">Cable</option>
                <option value="machine">Machine</option>
                <option value="body weight">Bodyweight</option>
              </select>
            </div>
            <div class="studio-exercise-list" id="studio-exercise-list">
              <!-- Exercises loaded here -->
            </div>
          </div>
        </div>
        
        <!-- Collapsed Exercise Panel -->
        <div class="studio-panel-collapsed" id="panel-exercises-collapsed" style="display:none;">
          <button class="panel-expand-btn" onclick="togglePanel('exercises')" title="Expand Exercise Library">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>
          </button>
          <span class="panel-collapsed-label">Exercises</span>
        </div>
        
        <!-- Center Panel: Program Builder -->
        <div class="studio-panel studio-builder" id="panel-builder">
          <div class="studio-panel-header">
            <div style="display:flex;align-items:center;gap:12px;">
              <input type="text" id="program-title" class="program-title-input" value="New Program" placeholder="Program Name">
              <select id="program-client" class="studio-select-sm">
                <option value="">Select Client</option>
                <option value="sarah">Sarah Johnson</option>
                <option value="mike">Mike Chen</option>
                <option value="emma">Emma Wilson</option>
                <option value="david">David Park</option>
              </select>
            </div>
            <div class="studio-actions">
              <button class="btn btn-secondary btn-sm" onclick="undoProgramChange()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></svg>
              </button>
              <button class="btn btn-secondary btn-sm" onclick="redoProgramChange()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></svg>
              </button>
              <button class="btn btn-sm" onclick="saveProgramStudio()">Save Program</button>
            </div>
          </div>
          
          <!-- Week Navigation -->
          <div class="week-nav">
            <button class="week-nav-btn" onclick="changeWeek(-1)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            </button>
            <div class="week-tabs" id="week-tabs">
              <button class="week-tab active" onclick="selectWeek(1)">Week 1</button>
              <button class="week-tab" onclick="selectWeek(2)">Week 2</button>
              <button class="week-tab" onclick="selectWeek(3)">Week 3</button>
              <button class="week-tab" onclick="selectWeek(4)">Week 4</button>
            </div>
            <button class="week-nav-btn" onclick="changeWeek(1)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
            </button>
            <button class="week-add-btn" onclick="addWeek()">+ Add Week</button>
          </div>
          
          <!-- Days Grid -->
          <div class="days-grid" id="days-grid">
            <div class="day-column" data-day="1">
              <div class="day-header">
                <span class="day-name">Monday</span>
                <span class="day-focus" contenteditable="true">Push</span>
              </div>
              <div class="day-exercises" id="day-1-exercises" ondrop="dropExercise(event, 1)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Drag exercises here</div>
              </div>
            </div>
            <div class="day-column" data-day="2">
              <div class="day-header">
                <span class="day-name">Tuesday</span>
                <span class="day-focus" contenteditable="true">Pull</span>
              </div>
              <div class="day-exercises" id="day-2-exercises" ondrop="dropExercise(event, 2)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Drag exercises here</div>
              </div>
            </div>
            <div class="day-column" data-day="3">
              <div class="day-header">
                <span class="day-name">Wednesday</span>
                <span class="day-focus" contenteditable="true">Rest</span>
              </div>
              <div class="day-exercises" id="day-3-exercises" ondrop="dropExercise(event, 3)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Rest Day</div>
              </div>
            </div>
            <div class="day-column" data-day="4">
              <div class="day-header">
                <span class="day-name">Thursday</span>
                <span class="day-focus" contenteditable="true">Legs</span>
              </div>
              <div class="day-exercises" id="day-4-exercises" ondrop="dropExercise(event, 4)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Drag exercises here</div>
              </div>
            </div>
            <div class="day-column" data-day="5">
              <div class="day-header">
                <span class="day-name">Friday</span>
                <span class="day-focus" contenteditable="true">Upper</span>
              </div>
              <div class="day-exercises" id="day-5-exercises" ondrop="dropExercise(event, 5)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Drag exercises here</div>
              </div>
            </div>
            <div class="day-column" data-day="6">
              <div class="day-header">
                <span class="day-name">Saturday</span>
                <span class="day-focus" contenteditable="true">Cardio</span>
              </div>
              <div class="day-exercises" id="day-6-exercises" ondrop="dropExercise(event, 6)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Drag exercises here</div>
              </div>
            </div>
            <div class="day-column" data-day="7">
              <div class="day-header">
                <span class="day-name">Sunday</span>
                <span class="day-focus" contenteditable="true">Rest</span>
              </div>
              <div class="day-exercises" id="day-7-exercises" ondrop="dropExercise(event, 7)" ondragover="allowDrop(event)">
                <div class="drop-zone-hint">Rest Day</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Right Panel: LiftAssistant -->
        <div class="studio-panel studio-ai" id="panel-ai">
          <div class="studio-panel-header">
            <div style="display:flex;align-items:center;gap:8px;">
              <button class="panel-toggle-btn" onclick="togglePanel('ai')" title="Collapse panel">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
              </button>
              <div class="ai-icon-sm">
                <svg width="16" height="16" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/></svg>
              </div>
              <span class="studio-panel-title"><span style="color:#fff;">Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span></span>
            </div>
          </div>
          
          <div class="studio-panel-body" id="panel-ai-body">
            <div class="ai-studio-chat" id="ai-studio-chat">
              <div class="ai-studio-msg assistant">
                <div class="ai-studio-msg-content">
                  I can help you build this program! Try:
                  <ul>
                    <li>"Generate a 4-week hypertrophy program"</li>
                    <li>"Add chest exercises to Monday"</li>
                    <li>"Swap bench press for dumbbell press"</li>
                    <li>"Make week 4 a deload week"</li>
                    <li>"Add progressive overload"</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="ai-studio-quick">
              <button class="ai-quick-chip" onclick="aiStudioCommand('generate')">Generate Program</button>
              <button class="ai-quick-chip" onclick="aiStudioCommand('deload')">Add Deload</button>
              <button class="ai-quick-chip" onclick="aiStudioCommand('progress')">Add Progression</button>
              <button class="ai-quick-chip" onclick="aiStudioCommand('balance')">Balance Volume</button>
            </div>
            
            <div class="ai-studio-input">
              <textarea id="ai-studio-input" placeholder="Ask AI to help build your program..." rows="2"></textarea>
              <button class="ai-studio-send" onclick="sendAIStudioMessage()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
              </button>
          </div>
          
          <!-- Program Stats -->
          <div class="program-stats">
            <div class="program-stat">
              <span class="program-stat-value" id="stat-exercises">0</span>
              <span class="program-stat-label">Exercises</span>
            </div>
            <div class="program-stat">
              <span class="program-stat-value" id="stat-sets">0</span>
              <span class="program-stat-label">Total Sets</span>
            </div>
            <div class="program-stat">
              <span class="program-stat-value" id="stat-volume">0</span>
              <span class="program-stat-label">Weekly Vol</span>
            </div>
          </div>
          </div>
        </div>
        
        <!-- Collapsed AI Panel -->
        <div class="studio-panel-collapsed" id="panel-ai-collapsed" style="display:none;">
          <button class="panel-expand-btn" onclick="togglePanel('ai')" title="Expand LiftAssistant">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"/></svg>
          </button>
          <span class="panel-collapsed-label">AI</span>
        </div>
      </div>
    </div>
    
    <!-- Nutrition Planning Page -->
    <div id="page-nutrition" class="page">
      <header class="header">
        <h1 class="header-title">Nutrition Planning</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="showNutritionTab('plans')">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
            Saved Plans
          </button>
          <button class="btn" onclick="showNutritionTab('create')">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            New Plan
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Tab Navigation -->
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button class="nutrition-tab active" id="tab-ai" onclick="showNutritionTab('ai')"><span style="color:#fff;">Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span></button>
          <button class="nutrition-tab" id="tab-create" onclick="showNutritionTab('create')">Custom Builder</button>
          <button class="nutrition-tab" id="tab-plans" onclick="showNutritionTab('plans')">Client Plans</button>
          <button class="nutrition-tab" id="tab-foods" onclick="showNutritionTab('foods')">Food Database</button>
        </div>
        
        <!-- AI Generator Tab -->
        <div id="nutrition-ai" class="nutrition-content">
          <div style="display: grid; grid-template-columns: 1fr 400px; gap: 16px; height: calc(100vh - 200px);">
            <!-- AI Chat -->
            <div class="card" style="display: flex; flex-direction: column; padding: 0; overflow: hidden;">
              <div style="padding: 16px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 12px;">
                <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #00ff88, #4169E1); display: flex; align-items: center; justify-content: center;">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="#fff"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2v16.94h.06zM1 21.99h15.03V3.95l-5-2-10 2v18.04z"/></svg>
                </div>
                <div>
                  <div style="font-weight: 600;"><span>Lift</span><span style="background:linear-gradient(90deg,#4169E1,#00ff88);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Assistant</span></div>
                  <div style="font-size: 12px; color: #666;">Meal Plan Generator  GPT-4</div>
                </div>
              </div>
              
              <div style="flex: 1; overflow-y: auto; padding: 16px;" id="nutrition-ai-messages">
                <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                  <div style="width: 36px; height: 36px; border-radius: 10px; background: linear-gradient(135deg, #00ff88, #4169E1); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2v16.94h.06zM1 21.99h15.03V3.95l-5-2-10 2v18.04z"/></svg>
                  </div>
                  <div style="background: #1a1a1a; border-radius: 12px; padding: 14px; max-width: 85%;">
                    <div style="font-size: 11px; color: #00ff88; margin-bottom: 6px;"><span style="color:#fff;">Lift</span><span style="color:#00ff88;">Assistant</span></div>
                    <div style="line-height: 1.5; font-size: 14px;">
                      Hey! I can help you create personalized nutrition plans. Tell me about your client:
                      <ul style="margin: 10px 0 0 16px; color: #ccc; font-size: 13px;">
                        <li>Their goals (fat loss, muscle gain, maintenance)</li>
                        <li>Current stats (weight, body fat %, activity level)</li>
                        <li>Dietary preferences or restrictions</li>
                        <li>Number of meals per day</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Quick Prompts -->
              <div style="padding: 8px 16px; border-top: 1px solid #222; display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="ai-quick-btn" onclick="useNutritionPrompt('fat-loss')">Fat Loss Plan</button>
                <button class="ai-quick-btn" onclick="useNutritionPrompt('muscle-gain')">Muscle Gain</button>
                <button class="ai-quick-btn" onclick="useNutritionPrompt('maintenance')">Maintenance</button>
                <button class="ai-quick-btn" onclick="useNutritionPrompt('keto')">Keto</button>
                <button class="ai-quick-btn" onclick="useNutritionPrompt('vegan')">Vegan</button>
              </div>
              
              <div style="padding: 12px 16px; border-top: 1px solid #222;">
                <div style="display: flex; gap: 12px;">
                  <textarea id="nutrition-ai-input" style="flex: 1; background: #0a0a0a; border: 1px solid #333; border-radius: 10px; padding: 12px; color: #fff; font-size: 14px; resize: none; height: 48px; font-family: inherit;" placeholder="Describe the nutrition plan you need..."></textarea>
                  <button class="btn" onclick="sendNutritionAIMessage()">
                    <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Generated Plan Preview -->
            <div class="card" style="display: flex; flex-direction: column; overflow: hidden;">
              <div class="card-title" style="margin-bottom: 12px;">Generated Plan Preview</div>
              <div id="generated-plan-preview" style="flex: 1; overflow-y: auto;">
                <div style="text-align: center; padding: 40px 20px; color: #666;">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="#333" style="margin-bottom: 12px;"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2v16.94h.06zM1 21.99h15.03V3.95l-5-2-10 2v18.04z"/></svg>
                  <p>Your AI-generated meal plan will appear here</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Custom Builder Tab -->
        <div id="nutrition-create" class="nutrition-content" style="display: none;">
          <div style="display: grid; grid-template-columns: 350px 1fr; gap: 16px; height: calc(100vh - 200px);">
            <!-- Macro Calculator -->
            <div class="card" style="overflow-y: auto;">
              <div class="card-title" style="margin-bottom: 16px;">Macro Calculator</div>
              
              <div class="input-group">
                <label class="input-label">Client</label>
                <select id="nutrition-client" class="nutrition-input" onchange="loadClientStats()">
                  <option value="">Select Client</option>
                  <option value="sarah">Sarah Johnson</option>
                  <option value="mike">Mike Chen</option>
                  <option value="emma">Emma Wilson</option>
                  <option value="david">David Park</option>
                </select>
              </div>
              
              <div class="input-group">
                <label class="input-label">Goal</label>
                <select id="nutrition-goal" class="nutrition-input" onchange="calculateMacros()">
                  <option value="fat-loss">Fat Loss (-500 cal)</option>
                  <option value="aggressive-loss">Aggressive Fat Loss (-750 cal)</option>
                  <option value="maintenance">Maintenance</option>
                  <option value="lean-gain">Lean Muscle Gain (+250 cal)</option>
                  <option value="bulk">Bulk (+500 cal)</option>
                </select>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div class="input-group">
                  <label class="input-label">Weight (lbs)</label>
                  <input type="number" id="client-weight" class="nutrition-input" value="145" onchange="calculateMacros()">
                </div>
                <div class="input-group">
                  <label class="input-label">Body Fat %</label>
                  <input type="number" id="client-bodyfat" class="nutrition-input" value="22" onchange="calculateMacros()">
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">Activity Level</label>
                <select id="activity-level" class="nutrition-input" onchange="calculateMacros()">
                  <option value="1.2">Sedentary (desk job)</option>
                  <option value="1.375">Light (1-3 days/week)</option>
                  <option value="1.55" selected>Moderate (3-5 days/week)</option>
                  <option value="1.725">Active (6-7 days/week)</option>
                  <option value="1.9">Very Active (2x/day)</option>
                </select>
              </div>
              
              <div class="input-group">
                <label class="input-label">Protein (g per lb of bodyweight)</label>
                <input type="range" id="protein-ratio" min="0.7" max="1.2" step="0.1" value="1.0" class="macro-slider" onchange="calculateMacros()">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666;">
                  <span>0.7g</span>
                  <span id="protein-ratio-display">1.0g</span>
                  <span>1.2g</span>
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">Fat % of Calories</label>
                <input type="range" id="fat-ratio" min="20" max="40" step="5" value="25" class="macro-slider" onchange="calculateMacros()">
                <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666;">
                  <span>20%</span>
                  <span id="fat-ratio-display">25%</span>
                  <span>40%</span>
                </div>
              </div>
              
              <!-- Calculated Macros Display -->
              <div class="macro-results" id="macro-results">
                <div class="macro-result-item">
                  <div class="macro-result-value" id="calc-calories">1,850</div>
                  <div class="macro-result-label">Calories</div>
                </div>
                <div class="macro-result-item">
                  <div class="macro-result-value protein" id="calc-protein">145g</div>
                  <div class="macro-result-label">Protein</div>
                </div>
                <div class="macro-result-item">
                  <div class="macro-result-value carbs" id="calc-carbs">185g</div>
                  <div class="macro-result-label">Carbs</div>
                </div>
                <div class="macro-result-item">
                  <div class="macro-result-value fats" id="calc-fats">52g</div>
                  <div class="macro-result-label">Fats</div>
                </div>
              </div>
              
              <button class="btn" style="width: 100%; margin-top: 12px;" onclick="applyMacrosToBuilder()">
                Apply to Meal Plan
              </button>
            </div>
            
            <!-- Meal Plan Builder -->
            <div class="card" style="display: flex; flex-direction: column; overflow: hidden;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div class="card-title">Meal Plan Builder</div>
                <div style="display: flex; gap: 8px;">
                  <button class="btn btn-secondary btn-sm" onclick="addMealSlot()">+ Add Meal</button>
                  <button class="btn btn-sm" onclick="saveMealPlan()">Save Plan</button>
                </div>
              </div>
              
              <!-- Daily Totals Bar -->
              <div class="daily-totals-bar">
                <div class="daily-total">
                  <span class="daily-total-label">Calories:</span>
                  <span class="daily-total-value" id="daily-calories">0</span>
                  <span class="daily-total-target">/ <span id="target-calories">1,850</span></span>
                </div>
                <div class="daily-total">
                  <span class="daily-total-label">Protein:</span>
                  <span class="daily-total-value protein" id="daily-protein">0g</span>
                  <span class="daily-total-target">/ <span id="target-protein">145g</span></span>
                </div>
                <div class="daily-total">
                  <span class="daily-total-label">Carbs:</span>
                  <span class="daily-total-value carbs" id="daily-carbs">0g</span>
                  <span class="daily-total-target">/ <span id="target-carbs">185g</span></span>
                </div>
                <div class="daily-total">
                  <span class="daily-total-label">Fats:</span>
                  <span class="daily-total-value fats" id="daily-fats">0g</span>
                  <span class="daily-total-target">/ <span id="target-fats">52g</span></span>
                </div>
              </div>
              
              <!-- Meals Container -->
              <div id="meals-container" style="flex: 1; overflow-y: auto; padding-right: 8px;">
                <!-- Meals will be added here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Client Plans Tab -->
        <div id="nutrition-plans" class="nutrition-content" style="display: none;">
          <div class="grid-3" style="gap: 16px;">
            <div class="plan-card" onclick="viewPlan('sarah')">
              <div class="plan-header">
                <div class="plan-avatar">SJ</div>
                <div>
                  <div class="plan-client">Sarah Johnson</div>
                  <div class="plan-meta">Fat Loss  Updated 2 days ago</div>
                </div>
              </div>
              <div class="plan-macros">
                <div class="plan-macro"><span class="plan-macro-value">1,650</span><span class="plan-macro-label">cal</span></div>
                <div class="plan-macro"><span class="plan-macro-value protein">145g</span><span class="plan-macro-label">P</span></div>
                <div class="plan-macro"><span class="plan-macro-value carbs">140g</span><span class="plan-macro-label">C</span></div>
                <div class="plan-macro"><span class="plan-macro-value fats">55g</span><span class="plan-macro-label">F</span></div>
              </div>
              <div class="plan-compliance">
                <div class="plan-compliance-bar" style="width: 85%;"></div>
              </div>
              <div class="plan-compliance-text">85% compliance this week</div>
            </div>
            
            <div class="plan-card" onclick="viewPlan('mike')">
              <div class="plan-header">
                <div class="plan-avatar" style="background: linear-gradient(135deg, #00ff88, #4169E1);">MC</div>
                <div>
                  <div class="plan-client">Mike Chen</div>
                  <div class="plan-meta">Muscle Gain  Updated 5 days ago</div>
                </div>
              </div>
              <div class="plan-macros">
                <div class="plan-macro"><span class="plan-macro-value">2,800</span><span class="plan-macro-label">cal</span></div>
                <div class="plan-macro"><span class="plan-macro-value protein">200g</span><span class="plan-macro-label">P</span></div>
                <div class="plan-macro"><span class="plan-macro-value carbs">300g</span><span class="plan-macro-label">C</span></div>
                <div class="plan-macro"><span class="plan-macro-value fats">85g</span><span class="plan-macro-label">F</span></div>
              </div>
              <div class="plan-compliance">
                <div class="plan-compliance-bar" style="width: 72%; background: #ffcc00;"></div>
              </div>
              <div class="plan-compliance-text">72% compliance this week</div>
            </div>
            
            <div class="plan-card" onclick="viewPlan('emma')">
              <div class="plan-header">
                <div class="plan-avatar" style="background: linear-gradient(135deg, #ff6b6b, #ffcc00);">EW</div>
                <div>
                  <div class="plan-client">Emma Wilson</div>
                  <div class="plan-meta">Fat Loss  Updated today</div>
                </div>
              </div>
              <div class="plan-macros">
                <div class="plan-macro"><span class="plan-macro-value">1,500</span><span class="plan-macro-label">cal</span></div>
                <div class="plan-macro"><span class="plan-macro-value protein">130g</span><span class="plan-macro-label">P</span></div>
                <div class="plan-macro"><span class="plan-macro-value carbs">120g</span><span class="plan-macro-label">C</span></div>
                <div class="plan-macro"><span class="plan-macro-value fats">50g</span><span class="plan-macro-label">F</span></div>
              </div>
              <div class="plan-compliance">
                <div class="plan-compliance-bar" style="width: 91%;"></div>
              </div>
              <div class="plan-compliance-text">91% compliance this week</div>
            </div>
            
            <div class="plan-card" onclick="viewPlan('david')">
              <div class="plan-header">
                <div class="plan-avatar" style="background: linear-gradient(135deg, #ffcc00, #ff6b6b);">DP</div>
                <div>
                  <div class="plan-client">David Park</div>
                  <div class="plan-meta">Performance  Updated 1 week ago</div>
                </div>
              </div>
              <div class="plan-macros">
                <div class="plan-macro"><span class="plan-macro-value">3,200</span><span class="plan-macro-label">cal</span></div>
                <div class="plan-macro"><span class="plan-macro-value protein">220g</span><span class="plan-macro-label">P</span></div>
                <div class="plan-macro"><span class="plan-macro-value carbs">380g</span><span class="plan-macro-label">C</span></div>
                <div class="plan-macro"><span class="plan-macro-value fats">90g</span><span class="plan-macro-label">F</span></div>
              </div>
              <div class="plan-compliance">
                <div class="plan-compliance-bar" style="width: 88%;"></div>
              </div>
              <div class="plan-compliance-text">88% compliance this week</div>
            </div>
          </div>
        </div>
        
        <!-- Food Database Tab -->
        <div id="nutrition-foods" class="nutrition-content" style="display: none;">
          <div style="display: grid; grid-template-columns: 1fr 350px; gap: 16px; height: calc(100vh - 200px);">
            <!-- Food Search -->
            <div class="card" style="display: flex; flex-direction: column; overflow: hidden;">
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <div style="flex: 1; position: relative;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#666" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                  <input type="text" id="food-search-input" placeholder="Search foods..." style="padding: 10px 16px 10px 40px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; width: 100%; font-size: 14px;" oninput="searchFoods()">
                </div>
                <select id="food-category-filter" class="nutrition-input" style="width: 180px;" onchange="filterFoods()">
                  <option value="">All Categories</option>
                  <option value="protein">Proteins</option>
                  <option value="carbs">Carbohydrates</option>
                  <option value="fats">Fats</option>
                  <option value="vegetables">Vegetables</option>
                  <option value="fruits">Fruits</option>
                  <option value="dairy">Dairy</option>
                </select>
              </div>
              
              <div id="food-database-status" style="font-size: 12px; color: #666; margin-bottom: 12px;"></div>
              
              <div id="food-database-grid" style="flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; align-content: start;">
                <!-- Foods will be loaded here -->
              </div>
            </div>
            
            <!-- Food Details / Add Custom -->
            <div class="card">
              <div class="card-title" style="margin-bottom: 16px;">Add Custom Food</div>
              
              <div class="input-group">
                <label class="input-label">Food Name</label>
                <input type="text" id="custom-food-name" class="nutrition-input" placeholder="e.g., Grilled Chicken Breast">
              </div>
              
              <div class="input-group">
                <label class="input-label">Serving Size</label>
                <div style="display: flex; gap: 8px;">
                  <input type="number" id="custom-serving-amount" class="nutrition-input" placeholder="100" style="flex: 1;">
                  <select id="custom-serving-unit" class="nutrition-input" style="width: 100px;">
                    <option value="g">grams</option>
                    <option value="oz">oz</option>
                    <option value="cup">cup</option>
                    <option value="tbsp">tbsp</option>
                    <option value="piece">piece</option>
                  </select>
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">Calories</label>
                <input type="number" id="custom-calories" class="nutrition-input" placeholder="165">
              </div>
              
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div class="input-group">
                  <label class="input-label">Protein (g)</label>
                  <input type="number" id="custom-protein" class="nutrition-input" placeholder="31">
                </div>
                <div class="input-group">
                  <label class="input-label">Carbs (g)</label>
                  <input type="number" id="custom-carbs" class="nutrition-input" placeholder="0">
                </div>
                <div class="input-group">
                  <label class="input-label">Fat (g)</label>
                  <input type="number" id="custom-fat" class="nutrition-input" placeholder="3.6">
                </div>
              </div>
              
              <div class="input-group">
                <label class="input-label">Category</label>
                <select id="custom-category" class="nutrition-input">
                  <option value="protein">Protein</option>
                  <option value="carbs">Carbohydrate</option>
                  <option value="fats">Fat</option>
                  <option value="vegetables">Vegetable</option>
                  <option value="fruits">Fruit</option>
                  <option value="dairy">Dairy</option>
                </select>
              </div>
              
              <button class="btn" style="width: 100%; margin-top: 12px;" onclick="addCustomFood()">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                Add to Database
              </button>
              
              <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid #222;">
                <div class="card-title" style="margin-bottom: 12px;">Quick Add Presets</div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                  <button class="preset-btn" onclick="addPresetFood('chicken')"> Chicken</button>
                  <button class="preset-btn" onclick="addPresetFood('rice')"> Rice</button>
                  <button class="preset-btn" onclick="addPresetFood('eggs')"> Eggs</button>
                  <button class="preset-btn" onclick="addPresetFood('salmon')"> Salmon</button>
                  <button class="preset-btn" onclick="addPresetFood('oats')"> Oats</button>
                  <button class="preset-btn" onclick="addPresetFood('broccoli')"> Broccoli</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Exercise Library Page -->
    <div id="page-exercises" class="page">
      <header class="header">
        <h1 class="header-title">Exercise Library</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="refreshExerciseLibrary()">
            <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
            Refresh
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Search and Filters -->
        <div class="grid-3" style="margin-bottom: 16px;">
          <div class="card" style="padding: 16px;">
            <div class="card-title" style="margin-bottom: 12px;">Search</div>
            <div style="position: relative;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#666" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
              <input type="text" id="exercise-search-input" placeholder="Search exercises..." style="padding: 10px 16px 10px 40px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; width: 100%; font-size: 14px;" oninput="searchExercises()">
            </div>
          </div>
          
          <div class="card" style="padding: 16px;">
            <div class="card-title" style="margin-bottom: 12px;">Body Part</div>
            <select id="bodypart-filter" style="padding: 10px 16px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; width: 100%; font-size: 14px;" onchange="filterExercises()">
              <option value="">All Body Parts</option>
              <option value="back">Back</option>
              <option value="cardio">Cardio</option>
              <option value="chest">Chest</option>
              <option value="lower arms">Lower Arms</option>
              <option value="lower legs">Lower Legs</option>
              <option value="neck">Neck</option>
              <option value="shoulders">Shoulders</option>
              <option value="upper arms">Upper Arms</option>
              <option value="upper legs">Upper Legs</option>
              <option value="waist">Waist</option>
            </select>
          </div>
          
          <div class="card" style="padding: 16px;">
            <div class="card-title" style="margin-bottom: 12px;">Equipment</div>
            <select id="equipment-filter" style="padding: 10px 16px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #fff; width: 100%; font-size: 14px;" onchange="filterExercises()">
              <option value="">All Equipment</option>
              <option value="barbell">Barbell</option>
              <option value="dumbbell">Dumbbell</option>
              <option value="cable">Cable</option>
              <option value="body weight">Body Weight</option>
              <option value="machine">Machine</option>
              <option value="kettlebell">Kettlebell</option>
              <option value="resistance band">Resistance Band</option>
            </select>
          </div>
        </div>
        
        <!-- API Status -->
        <div id="exercise-api-status" style="text-align: center; margin-bottom: 16px; font-size: 12px; color: #666;"></div>
        
        <!-- Exercise Grid -->
        <div id="exercise-grid" class="grid-3" style="gap: 16px;">
          <!-- Exercises will be loaded here -->
        </div>
        
        <!-- Loading State -->
        <div id="exercise-loading" style="text-align: center; padding: 40px; color: #666;">
          <div style="margin-bottom: 12px;">Loading exercises...</div>
          <div style="width: 40px; height: 40px; border: 3px solid #333; border-top: 3px solid #4169E1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        </div>
      </div>
    </div>
    
    <!-- Revenue/Business Page -->
    <div id="page-revenue" class="page">
      <header class="header">
        <h1 class="header-title">Business</h1>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
            Export Report
          </button>
          <button class="btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            New Invoice
          </button>
        </div>
      </header>
      
      <div class="content">
        <!-- Revenue Stats -->
        <div class="grid-4" style="margin-bottom:20px;">
          <div class="stat-card">
            <div class="stat-value green">$12,450</div>
            <div class="stat-label">Revenue (Dec)</div>
            <div class="stat-change up">+18% vs Nov</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">$8,200</div>
            <div class="stat-label">Net Profit</div>
            <div class="stat-change up">+22% vs Nov</div>
          </div>
          <div class="stat-card">
            <div class="stat-value blue">$4,250</div>
            <div class="stat-label">Expenses</div>
            <div class="stat-change">Rent, Software, Insurance</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">$1,038</div>
            <div class="stat-label">Avg per Client</div>
            <div class="stat-change up">+$85 vs Nov</div>
          </div>
        </div>
        
        <div class="grid-2" style="margin-bottom:20px;">
          <!-- Revenue Chart -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Revenue Trend</span>
              <div class="chart-period-btns">
                <button class="period-btn">1M</button>
                <button class="period-btn active">6M</button>
                <button class="period-btn">1Y</button>
              </div>
            </div>
            <div style="height:220px;position:relative;">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
          
          <!-- Revenue Breakdown -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">Revenue Breakdown</span>
            </div>
            <div style="display:flex;flex-direction:column;gap:12px;">
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:10px;">
                  <div style="width:12px;height:12px;border-radius:3px;background:#4169E1;"></div>
                  <span style="font-size:13px;">1-on-1 Training</span>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:14px;font-weight:600;">$7,200</div>
                  <div style="font-size:11px;color:#666;">58%</div>
                </div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:10px;">
                  <div style="width:12px;height:12px;border-radius:3px;background:#00ff88;"></div>
                  <span style="font-size:13px;">Online Coaching</span>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:14px;font-weight:600;">$3,600</div>
                  <div style="font-size:11px;color:#666;">29%</div>
                </div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:10px;">
                  <div style="width:12px;height:12px;border-radius:3px;background:#ffcc00;"></div>
                  <span style="font-size:13px;">Group Classes</span>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:14px;font-weight:600;">$1,200</div>
                  <div style="font-size:11px;color:#666;">10%</div>
                </div>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <div style="display:flex;align-items:center;gap:10px;">
                  <div style="width:12px;height:12px;border-radius:3px;background:#ff6b6b;"></div>
                  <span style="font-size:13px;">Nutrition Plans</span>
                </div>
                <div style="text-align:right;">
                  <div style="font-size:14px;font-weight:600;">$450</div>
                  <div style="font-size:11px;color:#666;">3%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Recent Transactions -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">Recent Transactions</span>
            <span style="font-size:11px;color:#4169E1;cursor:pointer;">View All</span>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <div class="client-row" style="margin:0;padding:12px;">
              <div class="client-avatar-lg" style="width:40px;height:40px;font-size:12px;">SJ</div>
              <div class="client-details">
                <div class="client-name-lg" style="font-size:14px;">Sarah Johnson</div>
                <div class="client-meta-lg" style="font-size:12px;">Monthly Training Package</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:16px;font-weight:600;color:#00ff88;">+$600</div>
                <div style="font-size:11px;color:#666;">Dec 20, 2024</div>
              </div>
            </div>
            <div class="client-row" style="margin:0;padding:12px;">
              <div class="client-avatar-lg" style="width:40px;height:40px;font-size:12px;background:linear-gradient(135deg,#00ff88,#4169E1);">MC</div>
              <div class="client-details">
                <div class="client-name-lg" style="font-size:14px;">Mike Chen</div>
                <div class="client-meta-lg" style="font-size:12px;">Premium Coaching + Nutrition</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:16px;font-weight:600;color:#00ff88;">+$800</div>
                <div style="font-size:11px;color:#666;">Dec 18, 2024</div>
              </div>
            </div>
            <div class="client-row" style="margin:0;padding:12px;">
              <div class="client-avatar-lg" style="width:40px;height:40px;font-size:12px;background:linear-gradient(135deg,#ff6b6b,#ffcc00);">EW</div>
              <div class="client-details">
                <div class="client-name-lg" style="font-size:14px;">Emma Wilson</div>
                <div class="client-meta-lg" style="font-size:12px;">Online Coaching</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:16px;font-weight:600;color:#00ff88;">+$450</div>
                <div style="font-size:11px;color:#666;">Dec 15, 2024</div>
              </div>
            </div>
            <div class="client-row" style="margin:0;padding:12px;">
              <div class="client-avatar-lg" style="width:40px;height:40px;font-size:12px;background:#333;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="#666"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
              </div>
              <div class="client-details">
                <div class="client-name-lg" style="font-size:14px;">Gym Rent</div>
                <div class="client-meta-lg" style="font-size:12px;">Monthly Expense</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:16px;font-weight:600;color:#ff6b6b;">-$2,500</div>
                <div style="font-size:11px;color:#666;">Dec 1, 2024</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Settings Page -->
    <div id="page-settings" class="page">
      <header class="header">
        <h1 class="header-title">Settings</h1>
      </header>
      
      <div class="content">
        <div class="grid-2" style="gap:20px;">
          <!-- Left Column -->
          <div style="display:flex;flex-direction:column;gap:16px;">
            <!-- Profile -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Profile</span>
                <button class="btn btn-secondary btn-sm">Edit</button>
              </div>
              <div style="display:flex;gap:16px;align-items:center;margin-bottom:16px;">
                <div style="width:72px;height:72px;border-radius:16px;background:linear-gradient(135deg,#4169E1,#00ff88);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:600;">AT</div>
                <div>
                  <div style="font-size:18px;font-weight:600;">Alex Trainer</div>
                  <div style="font-size:13px;color:#666;">alex@liftwise.us</div>
                  <div style="font-size:12px;color:#4169E1;margin-top:4px;">Pro Plan  Since Jan 2024</div>
                </div>
              </div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:13px;">
                <div><span style="color:#666;">Phone:</span> (555) 123-4567</div>
                <div><span style="color:#666;">Location:</span> San Francisco, CA</div>
                <div><span style="color:#666;">Certifications:</span> NASM, CSCS</div>
                <div><span style="color:#666;">Specialties:</span> Strength, Hyrox</div>
              </div>
            </div>
            
            <!-- Team & Staff -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Team & Staff</span>
                <button class="btn btn-secondary btn-sm">+ Add</button>
              </div>
              <div style="display:flex;flex-direction:column;gap:10px;">
                <div style="display:flex;align-items:center;gap:12px;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,#4169E1,#00ff88);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;">AT</div>
                  <div style="flex:1;">
                    <div style="font-size:13px;font-weight:500;">Alex Trainer</div>
                    <div style="font-size:11px;color:#666;">Owner  Head Coach</div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#00ff8820;color:#00ff88;border-radius:10px;">Active</span>
                </div>
                <div style="display:flex;align-items:center;gap:12px;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="width:36px;height:36px;border-radius:8px;background:#333;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;">JM</div>
                  <div style="flex:1;">
                    <div style="font-size:13px;font-weight:500;">Jamie Martinez</div>
                    <div style="font-size:11px;color:#666;">Assistant Coach</div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#00ff8820;color:#00ff88;border-radius:10px;">Active</span>
                </div>
                <div style="display:flex;align-items:center;gap:12px;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="width:36px;height:36px;border-radius:8px;background:#333;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;">KL</div>
                  <div style="flex:1;">
                    <div style="font-size:13px;font-weight:500;">Kim Lee</div>
                    <div style="font-size:11px;color:#666;">Nutrition Coach</div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#ffcc0020;color:#ffcc00;border-radius:10px;">Part-time</span>
                </div>
              </div>
            </div>
            
            <!-- Locations -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Locations</span>
                <button class="btn btn-secondary btn-sm">+ Add</button>
              </div>
              <div style="display:flex;flex-direction:column;gap:10px;">
                <div style="padding:12px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;justify-content:space-between;align-items:start;">
                    <div>
                      <div style="font-size:14px;font-weight:500;">Downtown Gym</div>
                      <div style="font-size:12px;color:#666;margin-top:2px;">123 Main St, San Francisco</div>
                    </div>
                    <span style="font-size:10px;padding:4px 8px;background:#4169E120;color:#4169E1;border-radius:10px;">Primary</span>
                  </div>
                  <div style="font-size:11px;color:#888;margin-top:8px;">Mon-Fri 6am-9pm  Sat 8am-6pm</div>
                </div>
                <div style="padding:12px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;justify-content:space-between;align-items:start;">
                    <div>
                      <div style="font-size:14px;font-weight:500;">Marina Studio</div>
                      <div style="font-size:12px;color:#666;margin-top:2px;">456 Beach Blvd, San Francisco</div>
                    </div>
                  </div>
                  <div style="font-size:11px;color:#888;margin-top:8px;">Tue/Thu 7am-12pm</div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right Column -->
          <div style="display:flex;flex-direction:column;gap:16px;">
            <!-- Billing & Payments -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Billing & Payments</span>
                <button class="btn btn-secondary btn-sm">Manage</button>
              </div>
              <div style="padding:12px;background:#1a1a1a;border-radius:8px;margin-bottom:12px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <div style="display:flex;align-items:center;gap:10px;">
                    <svg width="32" height="20" viewBox="0 0 32 20" fill="none"><rect width="32" height="20" rx="3" fill="#1a1f71"/><circle cx="12" cy="10" r="6" fill="#eb001b"/><circle cx="20" cy="10" r="6" fill="#f79e1b"/><path d="M16 5.5a6 6 0 000 9" fill="#ff5f00"/></svg>
                    <div>
                      <div style="font-size:13px;font-weight:500;">   4242</div>
                      <div style="font-size:11px;color:#666;">Expires 12/26</div>
                    </div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#00ff8820;color:#00ff88;border-radius:10px;">Default</span>
                </div>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:13px;padding:8px 0;border-bottom:1px solid #222;">
                <span style="color:#888;">Current Plan</span>
                <span style="font-weight:500;">Pro ($49/mo)</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:13px;padding:8px 0;border-bottom:1px solid #222;">
                <span style="color:#888;">Next Billing</span>
                <span>Jan 1, 2025</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:13px;padding:8px 0;">
                <span style="color:#888;">Payment Processing</span>
                <span style="color:#4169E1;">Stripe Connected </span>
              </div>
            </div>
            
            <!-- Integrations -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Integrations</span>
              </div>
              <div style="display:flex;flex-direction:column;gap:10px;">
                <div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div style="width:32px;height:32px;border-radius:6px;background:#635bff;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff;">S</div>
                    <div>
                      <div style="font-size:13px;font-weight:500;">Stripe</div>
                      <div style="font-size:11px;color:#666;">Payment processing</div>
                    </div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#00ff8820;color:#00ff88;border-radius:10px;">Connected</span>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div style="width:32px;height:32px;border-radius:6px;background:#4285f4;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:#fff;">G</div>
                    <div>
                      <div style="font-size:13px;font-weight:500;">Google Calendar</div>
                      <div style="font-size:11px;color:#666;">Schedule sync</div>
                    </div>
                  </div>
                  <span style="font-size:10px;padding:4px 8px;background:#00ff8820;color:#00ff88;border-radius:10px;">Connected</span>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div style="width:32px;height:32px;border-radius:6px;background:#25D366;display:flex;align-items:center;justify-content:center;">
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/></svg>
                    </div>
                    <div>
                      <div style="font-size:13px;font-weight:500;">WhatsApp</div>
                      <div style="font-size:11px;color:#666;">Client messaging</div>
                    </div>
                  </div>
                  <button class="btn btn-secondary btn-sm" style="padding:4px 10px;font-size:10px;">Connect</button>
                </div>
                <div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:#1a1a1a;border-radius:8px;">
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div style="width:32px;height:32px;border-radius:6px;background:#000;border:1px solid #333;display:flex;align-items:center;justify-content:center;">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83z"/></svg>
                    </div>
                    <div>
                      <div style="font-size:13px;font-weight:500;">Apple Health</div>
                      <div style="font-size:11px;color:#666;">Biometrics sync</div>
                    </div>
                  </div>
                  <button class="btn btn-secondary btn-sm" style="padding:4px 10px;font-size:10px;">Connect</button>
                </div>
              </div>
            </div>
            
            <!-- Account Settings -->
            <div class="card">
              <div class="card-header">
                <span class="card-title">Account</span>
              </div>
              <div style="display:flex;flex-direction:column;gap:8px;">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#1a1a1a;border-radius:8px;cursor:pointer;" onclick="alert('Change password dialog')">
                  <span style="font-size:13px;">Change Password</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#666"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#1a1a1a;border-radius:8px;cursor:pointer;" onclick="alert('Two-factor auth settings')">
                  <span style="font-size:13px;">Two-Factor Authentication</span>
                  <span style="font-size:11px;color:#00ff88;">Enabled </span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#1a1a1a;border-radius:8px;cursor:pointer;" onclick="alert('Notification preferences')">
                  <span style="font-size:13px;">Notification Preferences</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#666"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#1a1a1a;border-radius:8px;cursor:pointer;" onclick="alert('Export your data')">
                  <span style="font-size:13px;">Export Data</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#666"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:#ff6b6b10;border:1px solid #ff6b6b30;border-radius:8px;cursor:pointer;margin-top:8px;" onclick="alert('Are you sure you want to delete your account?')">
                  <span style="font-size:13px;color:#ff6b6b;">Delete Account</span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#ff6b6b"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<script>
// ==================== MOBILE SIDEBAR TOGGLE ====================
function toggleSidebar() {
  document.querySelector('.sidebar').classList.toggle('open');
  document.querySelector('.sidebar-overlay').classList.toggle('open');
}

// Close sidebar when clicking a nav item on mobile
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    if (window.innerWidth <= 768) {
      toggleSidebar();
    }
  });
});

// ==================== PAGE NAVIGATION ====================
function showPage(pageId) {
  const currentPage = document.querySelector('.page.active');
  const newPage = document.getElementById('page-' + pageId);
  
  if (currentPage && newPage && currentPage !== newPage) {
    currentPage.style.opacity = '0';
    currentPage.style.transform = 'translateY(-10px)';
    
    setTimeout(() => {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      newPage.classList.add('active');
      newPage.style.opacity = '0';
      newPage.style.transform = 'translateY(10px)';
      requestAnimationFrame(() => {
        newPage.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
        newPage.style.opacity = '1';
        newPage.style.transform = 'translateY(0)';
      });
    }, 150);
  } else if (newPage) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    newPage.classList.add('active');
  }
  
  // Update nav
  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
  event?.target?.closest('.nav-item')?.classList.add('active');
  
  // Generate calendar if needed
  if (pageId === 'calendar') {
    generateCalendar();
  }
}

// ==================== CALENDAR ====================
let currentMonth = 11; // December (0-indexed)
let currentYear = 2024;

const sessions = [
  { date: '2024-12-22', time: '9:00 AM', client: 'Sarah J.', type: 'session' },
  { date: '2024-12-22', time: '10:30 AM', client: 'Mike C.', type: 'checkin' },
  { date: '2024-12-22', time: '2:00 PM', client: 'Emma W.', type: 'session' },
  { date: '2024-12-23', time: '8:00 AM', client: 'David P.', type: 'session' },
  { date: '2024-12-23', time: '11:00 AM', client: 'Sarah J.', type: 'workout' },
  { date: '2024-12-24', time: '9:00 AM', client: 'Mike C.', type: 'session' },
  { date: '2024-12-26', time: '10:00 AM', client: 'Emma W.', type: 'checkin' },
  { date: '2024-12-27', time: '9:00 AM', client: 'Sarah J.', type: 'session' },
  { date: '2024-12-27', time: '2:00 PM', client: 'David P.', type: 'session' },
  { date: '2024-12-28', time: '8:00 AM', client: 'Mike C.', type: 'workout' },
  { date: '2024-12-30', time: '9:00 AM', client: 'Emma W.', type: 'session' },
];

function generateCalendar() {
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  document.getElementById('calendar-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
  
  const firstDay = new Date(currentYear, currentMonth, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
  const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
  
  const container = document.getElementById('calendar-days');
  container.innerHTML = '';
  
  const today = new Date();
  const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
  
  // Previous month days
  for (let i = firstDay - 1; i >= 0; i--) {
    const day = daysInPrevMonth - i;
    container.innerHTML += `<div class="calendar-day other-month"><div class="calendar-day-num">${day}</div></div>`;
  }
  
  // Current month days
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const isToday = dateStr === todayStr;
    const dayEvents = sessions.filter(s => s.date === dateStr);
    
    let eventsHtml = '';
    dayEvents.slice(0, 3).forEach(e => {
      eventsHtml += `<div class="calendar-event ${e.type}">${e.time} ${e.client}</div>`;
    });
    if (dayEvents.length > 3) {
      eventsHtml += `<div style="font-size:10px;color:#666;">+${dayEvents.length - 3} more</div>`;
    }
    
    container.innerHTML += `
      <div class="calendar-day ${isToday ? 'today' : ''}">
        <div class="calendar-day-num">${day}</div>
        ${eventsHtml}
      </div>
    `;
  }
  
  // Next month days
  const totalCells = container.children.length;
  const remaining = 42 - totalCells;
  for (let day = 1; day <= remaining; day++) {
    container.innerHTML += `<div class="calendar-day other-month"><div class="calendar-day-num">${day}</div></div>`;
  }
}

function changeMonth(delta) {
  currentMonth += delta;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  generateCalendar();
}

function setCalendarView(view) {
  document.querySelectorAll('.calendar-view-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

// ==================== AI FUNCTIONS ====================
function setAIPrompt(text) {
  document.querySelector('.ai-textarea').value = text;
}

function setDesktopPrompt(text) {
  document.getElementById('desktop-ai-input').value = text;
}

function sendDesktopAIMessage() {
  const input = document.getElementById('desktop-ai-input');
  const message = input.value.trim();
  if (!message) return;
  
  const container = document.getElementById('desktop-ai-messages');
  
  // Add user message
  container.innerHTML += `
    <div style="display: flex; gap: 12px; margin-bottom: 20px; justify-content: flex-end;">
      <div style="background: #4169E1; border-radius: 12px; padding: 16px; max-width: 80%;">
        <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 8px;">You</div>
        <div style="line-height: 1.6;">${message}</div>
      </div>
      <div style="width: 40px; height: 40px; border-radius: 10px; background: #333; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
      </div>
    </div>
  `;
  
  // Add AI response (simulated)
  setTimeout(() => {
    container.innerHTML += `
      <div style="display: flex; gap: 12px; margin-bottom: 20px;">
        <div style="width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, #4169E1, #00ff88); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          <svg width="22" height="22" viewBox="0 0 40 40" fill="none"><path d="M8 20h24M12 14v12M28 14v12M6 17h4v6H6zM30 17h4v6h-4z" stroke="#fff" stroke-width="2.5" stroke-linecap="round"/><path d="M20 8l4 6h-8l4-6z" fill="#fff"/></svg>
        </div>
        <div style="background: #1a1a1a; border-radius: 12px; padding: 16px; max-width: 80%;">
          <div style="font-size: 12px; color: #4169E1; margin-bottom: 8px;">LiftWise AI</div>
          <div style="line-height: 1.6;">I'll help you with that! Processing your request...</div>
        </div>
      </div>
    `;
    container.scrollTop = container.scrollHeight;
  }, 500);
  
  input.value = '';
  container.scrollTop = container.scrollHeight;
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  generateCalendar();
  loadExerciseLibrary();
  initPLChart();
});

// ==================== P&L CHART ====================
let plChart = null;
const plData = {
  '1m': {
    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
    revenue: [2100, 2400, 1950, 2000],
    profit: [1400, 1600, 1200, 1000],
    expenses: [700, 800, 750, 1000]
  },
  '6m': {
    labels: ['Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
    revenue: [6200, 6800, 7100, 7500, 7800, 8450],
    profit: [3800, 4200, 4400, 4600, 4800, 5200],
    expenses: [2400, 2600, 2700, 2900, 3000, 3250]
  },
  '1y': {
    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
    revenue: [4500, 4800, 5200, 5100, 5600, 5900, 6200, 6800, 7100, 7500, 7800, 8450],
    profit: [2700, 2900, 3200, 3000, 3400, 3600, 3800, 4200, 4400, 4600, 4800, 5200],
    expenses: [1800, 1900, 2000, 2100, 2200, 2300, 2400, 2600, 2700, 2900, 3000, 3250]
  },
  '5y': {
    labels: ['2020', '2021', '2022', '2023', '2024'],
    revenue: [32000, 48000, 62000, 78000, 92000],
    profit: [18000, 28000, 38000, 48000, 58000],
    expenses: [14000, 20000, 24000, 30000, 34000]
  }
};

function initPLChart() {
  const ctx = document.getElementById('plChart');
  if (!ctx) return;
  
  plChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: plData['6m'].labels,
      datasets: [
        {
          label: 'Revenue',
          data: plData['6m'].revenue,
          borderColor: '#4169E1',
          backgroundColor: 'rgba(65, 105, 225, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
          pointBackgroundColor: '#4169E1'
        },
        {
          label: 'Profit',
          data: plData['6m'].profit,
          borderColor: '#00ff88',
          backgroundColor: 'rgba(0, 255, 136, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
          pointBackgroundColor: '#00ff88'
        },
        {
          label: 'Expenses',
          data: plData['6m'].expenses,
          borderColor: '#ff6b6b',
          backgroundColor: 'rgba(255, 107, 107, 0.05)',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
          pointBackgroundColor: '#ff6b6b'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1a1a1a',
          titleColor: '#fff',
          bodyColor: '#ccc',
          borderColor: '#333',
          borderWidth: 1,
          padding: 10,
          callbacks: {
            label: function(context) {
              return context.dataset.label + ': $' + context.raw.toLocaleString();
            }
          }
        }
      },
      scales: {
        x: {
          grid: { color: '#222', drawBorder: false },
          ticks: { color: '#666', font: { size: 10 } }
        },
        y: {
          grid: { color: '#222', drawBorder: false },
          ticks: {
            color: '#666',
            font: { size: 10 },
            callback: function(value) { return '$' + (value / 1000) + 'k'; }
          }
        }
      },
      interaction: { intersect: false, mode: 'index' }
    }
  });
}

function updatePLChart(period) {
  document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  
  if (plChart && plData[period]) {
    plChart.data.labels = plData[period].labels;
    plChart.data.datasets[0].data = plData[period].revenue;
    plChart.data.datasets[1].data = plData[period].profit;
    plChart.data.datasets[2].data = plData[period].expenses;
    plChart.update();
  }
}

// ==================== EXERCISE LIBRARY ====================
let allExercises = [];
let filteredExercises = [];

async function loadExerciseLibrary() {
  const statusEl = document.getElementById('exercise-api-status');
  const loadingEl = document.getElementById('exercise-loading');
  const gridEl = document.getElementById('exercise-grid');
  
  try {
    statusEl.textContent = 'Loading exercises from ExerciseDB API...';
    loadingEl.style.display = 'block';
    gridEl.style.display = 'none';
    
    // Fetch exercises from ExerciseDB API
    const response = await fetch('https://exercisedb.p.rapidapi.com/exercises?limit=100', {
      method: 'GET',
      headers: {
        'x-rapidapi-key': '9124d57c83msh0c85c857c3a0ac7p1ce14bjsn778e0824ad6e',
        'x-rapidapi-host': 'exercisedb.p.rapidapi.com'
      }
    });
    
    if (!response.ok) {
      throw new Error('API request failed');
    }
    
    const exercises = await response.json();
    allExercises = exercises;
    filteredExercises = exercises;
    
    statusEl.textContent = `Loaded ${exercises.length} exercises from ExerciseDB`;
    statusEl.style.color = '#00ff88';
    
    renderExercises();
    
  } catch (error) {
    console.log('API failed, using demo data');
    // Fallback to demo data when API fails
    allExercises = getDemoExercises();
    filteredExercises = allExercises;
    
    statusEl.textContent = 'Using demo exercise data (API key required for full library)';
    statusEl.style.color = '#ffcc00';
    
    renderExercises();
  }
  
  loadingEl.style.display = 'none';
  gridEl.style.display = 'grid';
}

function getDemoExercises() {
  return [
    {
      id: '0001',
      name: 'Barbell Bench Press',
      bodyPart: 'chest',
      equipment: 'barbell',
      gifUrl: 'https://v2.exercisedb.io/image/0001',
      instructions: [
        'Lie on a flat bench with your feet firmly planted on the ground.',
        'Grip the barbell with hands slightly wider than shoulder-width apart.',
        'Lower the bar to your chest with control.',
        'Press the bar back up to the starting position.'
      ]
    },
    {
      id: '0002',
      name: 'Dumbbell Bicep Curls',
      bodyPart: 'upper arms',
      equipment: 'dumbbell',
      gifUrl: 'https://v2.exercisedb.io/image/0002',
      instructions: [
        'Stand with feet shoulder-width apart, holding dumbbells at your sides.',
        'Keep your elbows close to your torso.',
        'Curl the weights up towards your shoulders.',
        'Lower the weights back down with control.'
      ]
    },
    {
      id: '0003',
      name: 'Barbell Squats',
      bodyPart: 'upper legs',
      equipment: 'barbell',
      gifUrl: 'https://v2.exercisedb.io/image/0003',
      instructions: [
        'Position the barbell on your upper back.',
        'Stand with feet shoulder-width apart.',
        'Lower your body by bending at the hips and knees.',
        'Return to the starting position by driving through your heels.'
      ]
    },
    {
      id: '0004',
      name: 'Pull-ups',
      bodyPart: 'back',
      equipment: 'body weight',
      gifUrl: 'https://v2.exercisedb.io/image/0004',
      instructions: [
        'Hang from a pull-up bar with palms facing away.',
        'Pull your body up until your chin clears the bar.',
        'Lower yourself back down with control.',
        'Repeat for desired repetitions.'
      ]
    },
    {
      id: '0005',
      name: 'Dumbbell Shoulder Press',
      bodyPart: 'shoulders',
      equipment: 'dumbbell',
      gifUrl: 'https://v2.exercisedb.io/image/0005',
      instructions: [
        'Sit on a bench with back support, holding dumbbells at shoulder height.',
        'Press the weights overhead until arms are fully extended.',
        'Lower the weights back to shoulder height.',
        'Repeat for desired repetitions.'
      ]
    },
    {
      id: '0006',
      name: 'Deadlifts',
      bodyPart: 'back',
      equipment: 'barbell',
      gifUrl: 'https://v2.exercisedb.io/image/0006',
      instructions: [
        'Stand with feet hip-width apart, barbell over mid-foot.',
        'Bend at hips and knees to grip the bar.',
        'Keep your back straight and chest up.',
        'Drive through heels to lift the bar, extending hips and knees.'
      ]
    },
    {
      id: '0007',
      name: 'Plank',
      bodyPart: 'waist',
      equipment: 'body weight',
      gifUrl: 'https://v2.exercisedb.io/image/0007',
      instructions: [
        'Start in a push-up position.',
        'Lower onto your forearms.',
        'Keep your body in a straight line from head to heels.',
        'Hold the position for the desired time.'
      ]
    },
    {
      id: '0008',
      name: 'Cable Lat Pulldown',
      bodyPart: 'back',
      equipment: 'cable',
      gifUrl: 'https://v2.exercisedb.io/image/0008',
      instructions: [
        'Sit at a lat pulldown machine with thighs secured.',
        'Grip the bar with hands wider than shoulder-width.',
        'Pull the bar down to your upper chest.',
        'Slowly return the bar to the starting position.'
      ]
    },
    {
      id: '0009',
      name: 'Leg Press',
      bodyPart: 'upper legs',
      equipment: 'machine',
      gifUrl: 'https://v2.exercisedb.io/image/0009',
      instructions: [
        'Sit on the leg press machine with back against the pad.',
        'Place feet on the platform shoulder-width apart.',
        'Lower the weight by bending your knees.',
        'Press the weight back up to the starting position.'
      ]
    },
    {
      id: '0010',
      name: 'Kettlebell Swings',
      bodyPart: 'waist',
      equipment: 'kettlebell',
      gifUrl: 'https://v2.exercisedb.io/image/0010',
      instructions: [
        'Stand with feet wider than shoulder-width, holding a kettlebell.',
        'Hinge at the hips and swing the kettlebell between your legs.',
        'Drive your hips forward to swing the kettlebell to chest height.',
        'Let the kettlebell swing back down and repeat.'
      ]
    }
  ];
}

function renderExercises() {
  const gridEl = document.getElementById('exercise-grid');
  
  if (filteredExercises.length === 0) {
    gridEl.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">No exercises found matching your criteria.</div>';
    return;
  }
  
  gridEl.innerHTML = filteredExercises.map(exercise => `
    <div class="exercise-card" onclick="showExerciseModal('${exercise.id}')">
      <div class="exercise-gif">
        <img src="${exercise.gifUrl}" alt="${exercise.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMTExIi8+CjxwYXRoIGQ9Ik0xMDAgNTBMMTUwIDEwMEgxMDBWMTUwSDUwVjEwMEgxMDBWNTBaIiBmaWxsPSIjNDQ0Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNjY2IiBmb250LXNpemU9IjEyIj5FeGVyY2lzZTwvdGV4dD4KPC9zdmc+'" loading="lazy">
      </div>
      <div class="exercise-name">${exercise.name}</div>
      <div class="exercise-meta">
        <span class="exercise-tag bodypart">${exercise.bodyPart}</span>
        <span class="exercise-tag equipment">${exercise.equipment}</span>
      </div>
      <div class="exercise-instructions">${exercise.instructions ? exercise.instructions[0] : 'Click to view details'}</div>
    </div>
  `).join('');
}

function searchExercises() {
  const searchTerm = document.getElementById('exercise-search-input').value.toLowerCase();
  const bodyPartFilter = document.getElementById('bodypart-filter').value;
  const equipmentFilter = document.getElementById('equipment-filter').value;
  
  filteredExercises = allExercises.filter(exercise => {
    const matchesSearch = exercise.name.toLowerCase().includes(searchTerm);
    const matchesBodyPart = !bodyPartFilter || exercise.bodyPart === bodyPartFilter;
    const matchesEquipment = !equipmentFilter || exercise.equipment === equipmentFilter;
    
    return matchesSearch && matchesBodyPart && matchesEquipment;
  });
  
  renderExercises();
}

function filterExercises() {
  searchExercises(); // Reuse the same filtering logic
}

function refreshExerciseLibrary() {
  loadExerciseLibrary();
}

function showExerciseModal(exerciseId) {
  const exercise = allExercises.find(ex => ex.id === exerciseId);
  if (!exercise) return;
  
  // Create modal if it doesn't exist
  let modal = document.getElementById('exercise-detail-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'exercise-detail-modal';
    modal.className = 'exercise-modal';
    modal.innerHTML = `
      <div class="exercise-modal-content">
        <div class="exercise-modal-close" onclick="closeExerciseModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </div>
        <div class="exercise-modal-gif">
          <img id="modal-exercise-gif" src="" alt="">
        </div>
        <div class="exercise-modal-name" id="modal-exercise-name"></div>
        <div class="exercise-modal-meta" id="modal-exercise-meta"></div>
        <div class="exercise-modal-instructions" id="modal-exercise-instructions"></div>
        <button class="btn" style="margin-top: 20px;" onclick="addExerciseToProgram('${exerciseId}')">
          <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
          Add to Program
        </button>
      </div>
    `;
    document.body.appendChild(modal);
  }
  
  // Populate modal content
  document.getElementById('modal-exercise-gif').src = exercise.gifUrl;
  document.getElementById('modal-exercise-name').textContent = exercise.name;
  document.getElementById('modal-exercise-meta').innerHTML = `
    <span class="exercise-tag bodypart">${exercise.bodyPart}</span>
    <span class="exercise-tag equipment">${exercise.equipment}</span>
  `;
  document.getElementById('modal-exercise-instructions').innerHTML = exercise.instructions 
    ? exercise.instructions.map(instruction => `<p style="margin-bottom: 8px;"> ${instruction}</p>`).join('')
    : '<p>No instructions available.</p>';
  
  modal.style.display = 'flex';
}

function closeExerciseModal() {
  const modal = document.getElementById('exercise-detail-modal');
  if (modal) {
    modal.style.display = 'none';
  }
}

function addExerciseToProgram(exerciseId) {
  const exercise = allExercises.find(ex => ex.id === exerciseId);
  alert(`Added "${exercise.name}" to program! (This would integrate with your program builder)`);
  closeExerciseModal();
}

// ==================== NUTRITION PLANNING ====================
let mealPlan = { meals: [], targetMacros: { calories: 1850, protein: 145, carbs: 185, fats: 52 } };
let foodDatabase = [];

function showNutritionTab(tabId) {
  document.querySelectorAll('.nutrition-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nutrition-content').forEach(c => c.style.display = 'none');
  
  document.getElementById('tab-' + tabId)?.classList.add('active');
  document.getElementById('nutrition-' + tabId).style.display = 'block';
  
  if (tabId === 'foods') loadFoodDatabase();
  if (tabId === 'create') initMealBuilder();
}

function calculateMacros() {
  const weight = parseFloat(document.getElementById('client-weight').value) || 145;
  const bodyfat = parseFloat(document.getElementById('client-bodyfat').value) || 22;
  const activity = parseFloat(document.getElementById('activity-level').value) || 1.55;
  const goal = document.getElementById('nutrition-goal').value;
  const proteinRatio = parseFloat(document.getElementById('protein-ratio').value) || 1.0;
  const fatRatio = parseFloat(document.getElementById('fat-ratio').value) || 25;
  
  document.getElementById('protein-ratio-display').textContent = proteinRatio + 'g';
  document.getElementById('fat-ratio-display').textContent = fatRatio + '%';
  
  const leanMass = weight * (1 - bodyfat / 100);
  const bmr = 370 + (21.6 * leanMass * 0.453592);
  let tdee = bmr * activity;
  
  const adjustments = { 'aggressive-loss': -750, 'fat-loss': -500, 'maintenance': 0, 'lean-gain': 250, 'bulk': 500 };
  const calories = Math.round(tdee + (adjustments[goal] || 0));
  const protein = Math.round(weight * proteinRatio);
  const fats = Math.round((calories * (fatRatio / 100)) / 9);
  const carbs = Math.round((calories - (protein * 4) - (fats * 9)) / 4);
  
  document.getElementById('calc-calories').textContent = calories.toLocaleString();
  document.getElementById('calc-protein').textContent = protein + 'g';
  document.getElementById('calc-carbs').textContent = carbs + 'g';
  document.getElementById('calc-fats').textContent = fats + 'g';
  
  mealPlan.targetMacros = { calories, protein, carbs, fats };
}

function loadClientStats() {
  const client = document.getElementById('nutrition-client').value;
  const stats = {
    sarah: { weight: 145, bodyfat: 22 },
    mike: { weight: 185, bodyfat: 15 },
    emma: { weight: 135, bodyfat: 28 },
    david: { weight: 175, bodyfat: 12 }
  };
  if (stats[client]) {
    document.getElementById('client-weight').value = stats[client].weight;
    document.getElementById('client-bodyfat').value = stats[client].bodyfat;
    calculateMacros();
  }
}

function applyMacrosToBuilder() {
  document.getElementById('target-calories').textContent = mealPlan.targetMacros.calories.toLocaleString();
  document.getElementById('target-protein').textContent = mealPlan.targetMacros.protein + 'g';
  document.getElementById('target-carbs').textContent = mealPlan.targetMacros.carbs + 'g';
  document.getElementById('target-fats').textContent = mealPlan.targetMacros.fats + 'g';
}

function initMealBuilder() {
  const container = document.getElementById('meals-container');
  if (container.children.length === 0) {
    ['Breakfast', 'Lunch', 'Dinner', 'Snacks'].forEach(name => addMealSlot(name));
  }
  applyMacrosToBuilder();
}

function addMealSlot(name = 'New Meal') {
  const container = document.getElementById('meals-container');
  const mealId = 'meal-' + Date.now();
  const html = `
    <div class="meal-slot" id="${mealId}">
      <div class="meal-slot-header">
        <input type="text" value="${name}" class="meal-slot-name" style="background:transparent;border:none;color:#fff;font-weight:600;font-size:14px;">
        <span class="meal-slot-macros">0 cal</span>
      </div>
      <div class="meal-foods" data-meal="${mealId}"></div>
      <button class="add-food-btn" onclick="openFoodPicker('${mealId}')">+ Add Food</button>
    </div>
  `;
  container.insertAdjacentHTML('beforeend', html);
}

function openFoodPicker(mealId) {
  const foods = [
    { name: 'Grilled Chicken Breast', serving: '6 oz', cal: 280, p: 52, c: 0, f: 6 },
    { name: 'Brown Rice', serving: '1 cup', cal: 220, p: 5, c: 45, f: 2 },
    { name: 'Scrambled Eggs', serving: '3 large', cal: 220, p: 18, c: 2, f: 15 },
    { name: 'Greek Yogurt', serving: '1 cup', cal: 140, p: 20, c: 8, f: 0 },
    { name: 'Salmon Fillet', serving: '6 oz', cal: 350, p: 40, c: 0, f: 20 },
    { name: 'Sweet Potato', serving: '1 medium', cal: 115, p: 2, c: 27, f: 0 },
    { name: 'Broccoli', serving: '1 cup', cal: 55, p: 4, c: 10, f: 0 },
    { name: 'Oatmeal', serving: '1 cup', cal: 150, p: 5, c: 27, f: 3 },
    { name: 'Protein Shake', serving: '1 scoop', cal: 120, p: 24, c: 3, f: 1 },
    { name: 'Almonds', serving: '1 oz', cal: 165, p: 6, c: 6, f: 14 }
  ];
  
  const food = foods[Math.floor(Math.random() * foods.length)];
  addFoodToMeal(mealId, food);
}

function addFoodToMeal(mealId, food) {
  const container = document.querySelector(`[data-meal="${mealId}"]`);
  const foodId = 'food-' + Date.now();
  const html = `
    <div class="meal-food-item" id="${foodId}" data-cal="${food.cal}" data-p="${food.p}" data-c="${food.c}" data-f="${food.f}">
      <div>
        <div class="meal-food-name">${food.name}</div>
        <div class="meal-food-macros">${food.serving}  ${food.cal} cal  ${food.p}P ${food.c}C ${food.f}F</div>
      </div>
      <span class="meal-food-remove" onclick="removeFoodFromMeal('${foodId}')"></span>
    </div>
  `;
  container.insertAdjacentHTML('beforeend', html);
  updateDailyTotals();
}

function removeFoodFromMeal(foodId) {
  document.getElementById(foodId)?.remove();
  updateDailyTotals();
}

function updateDailyTotals() {
  let totals = { cal: 0, p: 0, c: 0, f: 0 };
  document.querySelectorAll('.meal-food-item').forEach(item => {
    totals.cal += parseInt(item.dataset.cal) || 0;
    totals.p += parseInt(item.dataset.p) || 0;
    totals.c += parseInt(item.dataset.c) || 0;
    totals.f += parseInt(item.dataset.f) || 0;
  });
  
  document.getElementById('daily-calories').textContent = totals.cal.toLocaleString();
  document.getElementById('daily-protein').textContent = totals.p + 'g';
  document.getElementById('daily-carbs').textContent = totals.c + 'g';
  document.getElementById('daily-fats').textContent = totals.f + 'g';
}

function saveMealPlan() {
  const client = document.getElementById('nutrition-client').value || 'client';
  alert(`Meal plan saved for ${client}! Target: ${mealPlan.targetMacros.calories} cal, ${mealPlan.targetMacros.protein}g protein`);
}

// Nutrition AI
function useNutritionPrompt(type) {
  const prompts = {
    'fat-loss': 'Create a fat loss meal plan for Sarah. She weighs 145lbs, 22% body fat, trains 4x/week. Target 1,650 calories with high protein.',
    'muscle-gain': 'Create a muscle building plan for Mike. He weighs 185lbs, 15% body fat, trains 5x/week. Target 2,800 calories.',
    'maintenance': 'Create a maintenance plan with balanced macros for a moderately active client.',
    'keto': 'Create a ketogenic meal plan with under 30g net carbs, high fat, moderate protein.',
    'vegan': 'Create a high-protein vegan meal plan for muscle building. Include complete protein sources.'
  };
  document.getElementById('nutrition-ai-input').value = prompts[type] || '';
}

function sendNutritionAIMessage() {
  const input = document.getElementById('nutrition-ai-input');
  const message = input.value.trim();
  if (!message) return;
  
  const container = document.getElementById('nutrition-ai-messages');
  container.innerHTML += `
    <div style="display:flex;gap:12px;margin-bottom:16px;justify-content:flex-end;">
      <div style="background:#4169E1;border-radius:12px;padding:14px;max-width:85%;">
        <div style="font-size:11px;color:rgba(255,255,255,0.7);margin-bottom:6px;">You</div>
        <div style="line-height:1.5;font-size:14px;">${message}</div>
      </div>
    </div>
  `;
  
  setTimeout(() => {
    const plan = generateAIMealPlan(message);
    container.innerHTML += `
      <div style="display:flex;gap:12px;margin-bottom:16px;">
        <div style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#00ff88,#4169E1);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2v16.94h.06zM1 21.99h15.03V3.95l-5-2-10 2v18.04z"/></svg>
        </div>
        <div style="background:#1a1a1a;border-radius:12px;padding:14px;max-width:85%;">
          <div style="font-size:11px;margin-bottom:6px;"><span style="color:#fff;">Lift</span><span style="color:#00ff88;">Assistant</span></div>
          <div style="line-height:1.5;font-size:14px;">${plan}</div>
        </div>
      </div>
    `;
    container.scrollTop = container.scrollHeight;
    updatePlanPreview();
  }, 800);
  
  input.value = '';
  container.scrollTop = container.scrollHeight;
}

function generateAIMealPlan(prompt) {
  const isLoss = prompt.toLowerCase().includes('loss') || prompt.toLowerCase().includes('cut');
  const isGain = prompt.toLowerCase().includes('gain') || prompt.toLowerCase().includes('bulk') || prompt.toLowerCase().includes('muscle');
  const isKeto = prompt.toLowerCase().includes('keto');
  const isVegan = prompt.toLowerCase().includes('vegan');
  
  let response = `Here's a customized meal plan based on your requirements:\n\n`;
  response += `<strong>Daily Targets:</strong> ${isLoss ? '1,650' : isGain ? '2,800' : '2,200'} cal | `;
  response += `${isLoss ? '145' : isGain ? '200' : '165'}g protein | `;
  response += `${isKeto ? '25' : isLoss ? '140' : '250'}g carbs | `;
  response += `${isKeto ? '130' : '65'}g fat\n\n`;
  
  if (isKeto) {
    response += `<strong>Breakfast:</strong> 3 eggs + avocado + bacon (450 cal)\n`;
    response += `<strong>Lunch:</strong> Salmon salad with olive oil (550 cal)\n`;
    response += `<strong>Dinner:</strong> Ribeye steak + asparagus (650 cal)\n`;
  } else if (isVegan) {
    response += `<strong>Breakfast:</strong> Tofu scramble + tempeh bacon (420 cal)\n`;
    response += `<strong>Lunch:</strong> Lentil curry + quinoa (580 cal)\n`;
    response += `<strong>Dinner:</strong> Seitan stir-fry + edamame (620 cal)\n`;
    response += `<strong>Snacks:</strong> Protein shake + nuts (380 cal)\n`;
  } else {
    response += `<strong>Breakfast:</strong> Eggs + oatmeal + berries (${isLoss ? '380' : '520'} cal)\n`;
    response += `<strong>Lunch:</strong> Chicken + rice + vegetables (${isLoss ? '480' : '680'} cal)\n`;
    response += `<strong>Dinner:</strong> Salmon + sweet potato + salad (${isLoss ? '520' : '720'} cal)\n`;
    response += `<strong>Snacks:</strong> Greek yogurt + protein shake (${isLoss ? '270' : '380'} cal)\n`;
  }
  
  response += `\n Plan optimized for ${isLoss ? 'fat loss while preserving muscle' : isGain ? 'lean muscle gain' : 'maintenance'}`;
  return response;
}

function updatePlanPreview() {
  document.getElementById('generated-plan-preview').innerHTML = `
    <div style="background:#0a0a0a;border-radius:10px;padding:14px;margin-bottom:12px;">
      <div style="font-weight:600;margin-bottom:8px;">Daily Macros</div>
      <div style="display:flex;justify-content:space-between;font-size:13px;">
        <span>1,650 cal</span><span style="color:#4169E1;">145g P</span><span style="color:#ffcc00;">140g C</span><span style="color:#ff6b6b;">55g F</span>
      </div>
    </div>
    <div class="meal-slot" style="margin-bottom:8px;padding:12px;">
      <div style="font-weight:600;font-size:13px;margin-bottom:6px;"> Breakfast</div>
      <div style="font-size:12px;color:#888;">Eggs + Oatmeal + Berries  380 cal</div>
    </div>
    <div class="meal-slot" style="margin-bottom:8px;padding:12px;">
      <div style="font-weight:600;font-size:13px;margin-bottom:6px;"> Lunch</div>
      <div style="font-size:12px;color:#888;">Chicken + Rice + Vegetables  480 cal</div>
    </div>
    <div class="meal-slot" style="margin-bottom:8px;padding:12px;">
      <div style="font-weight:600;font-size:13px;margin-bottom:6px;"> Dinner</div>
      <div style="font-size:12px;color:#888;">Salmon + Sweet Potato + Salad  520 cal</div>
    </div>
    <div class="meal-slot" style="padding:12px;">
      <div style="font-weight:600;font-size:13px;margin-bottom:6px;"> Snacks</div>
      <div style="font-size:12px;color:#888;">Greek Yogurt + Protein Shake  270 cal</div>
    </div>
    <button class="btn" style="width:100%;margin-top:12px;" onclick="alert('Plan assigned to client!')">Assign to Client</button>
  `;
}

// Food Database
function loadFoodDatabase() {
  foodDatabase = [
    { name: 'Chicken Breast', serving: '6 oz', cal: 280, p: 52, c: 0, f: 6, category: 'protein' },
    { name: 'Salmon', serving: '6 oz', cal: 350, p: 40, c: 0, f: 20, category: 'protein' },
    { name: 'Ground Beef 90%', serving: '6 oz', cal: 310, p: 46, c: 0, f: 14, category: 'protein' },
    { name: 'Eggs', serving: '2 large', cal: 140, p: 12, c: 1, f: 10, category: 'protein' },
    { name: 'Greek Yogurt', serving: '1 cup', cal: 140, p: 20, c: 8, f: 0, category: 'dairy' },
    { name: 'Brown Rice', serving: '1 cup', cal: 220, p: 5, c: 45, f: 2, category: 'carbs' },
    { name: 'Sweet Potato', serving: '1 medium', cal: 115, p: 2, c: 27, f: 0, category: 'carbs' },
    { name: 'Oatmeal', serving: '1 cup', cal: 150, p: 5, c: 27, f: 3, category: 'carbs' },
    { name: 'Quinoa', serving: '1 cup', cal: 220, p: 8, c: 39, f: 4, category: 'carbs' },
    { name: 'Avocado', serving: '1 medium', cal: 240, p: 3, c: 12, f: 22, category: 'fats' },
    { name: 'Almonds', serving: '1 oz', cal: 165, p: 6, c: 6, f: 14, category: 'fats' },
    { name: 'Olive Oil', serving: '1 tbsp', cal: 120, p: 0, c: 0, f: 14, category: 'fats' },
    { name: 'Broccoli', serving: '1 cup', cal: 55, p: 4, c: 10, f: 0, category: 'vegetables' },
    { name: 'Spinach', serving: '2 cups', cal: 14, p: 2, c: 2, f: 0, category: 'vegetables' },
    { name: 'Banana', serving: '1 medium', cal: 105, p: 1, c: 27, f: 0, category: 'fruits' },
    { name: 'Blueberries', serving: '1 cup', cal: 85, p: 1, c: 21, f: 0, category: 'fruits' }
  ];
  renderFoodDatabase();
}

function renderFoodDatabase(foods = foodDatabase) {
  const grid = document.getElementById('food-database-grid');
  grid.innerHTML = foods.map(f => `
    <div class="food-card" onclick="selectFood('${f.name}')">
      <div class="food-card-name">${f.name}</div>
      <div class="food-card-serving">${f.serving}</div>
      <div class="food-card-macros">
        <span class="food-card-macro">${f.cal} cal</span>
        <span class="food-card-macro" style="color:#4169E1;">${f.p}P</span>
        <span class="food-card-macro" style="color:#ffcc00;">${f.c}C</span>
        <span class="food-card-macro" style="color:#ff6b6b;">${f.f}F</span>
      </div>
    </div>
  `).join('');
  document.getElementById('food-database-status').textContent = `${foods.length} foods in database`;
}

function searchFoods() {
  const term = document.getElementById('food-search-input').value.toLowerCase();
  const filtered = foodDatabase.filter(f => f.name.toLowerCase().includes(term));
  renderFoodDatabase(filtered);
}

function filterFoods() {
  const category = document.getElementById('food-category-filter').value;
  const filtered = category ? foodDatabase.filter(f => f.category === category) : foodDatabase;
  renderFoodDatabase(filtered);
}

function selectFood(name) {
  const food = foodDatabase.find(f => f.name === name);
  if (food) alert(`Selected: ${food.name}\n${food.cal} cal | ${food.p}g P | ${food.c}g C | ${food.f}g F`);
}

function addCustomFood() {
  const name = document.getElementById('custom-food-name').value;
  const cal = parseInt(document.getElementById('custom-calories').value) || 0;
  const p = parseInt(document.getElementById('custom-protein').value) || 0;
  const c = parseInt(document.getElementById('custom-carbs').value) || 0;
  const f = parseInt(document.getElementById('custom-fat').value) || 0;
  const category = document.getElementById('custom-category').value;
  const amount = document.getElementById('custom-serving-amount').value || '100';
  const unit = document.getElementById('custom-serving-unit').value;
  
  if (!name) { alert('Please enter a food name'); return; }
  
  foodDatabase.push({ name, serving: `${amount} ${unit}`, cal, p, c, f, category });
  renderFoodDatabase();
  alert(`Added "${name}" to database!`);
}

function addPresetFood(type) {
  const presets = {
    chicken: { name: 'Grilled Chicken', serving: '6 oz', cal: 280, p: 52, c: 0, f: 6, category: 'protein' },
    rice: { name: 'White Rice', serving: '1 cup', cal: 205, p: 4, c: 45, f: 0, category: 'carbs' },
    eggs: { name: 'Whole Eggs', serving: '2 large', cal: 140, p: 12, c: 1, f: 10, category: 'protein' },
    salmon: { name: 'Atlantic Salmon', serving: '6 oz', cal: 350, p: 40, c: 0, f: 20, category: 'protein' },
    oats: { name: 'Rolled Oats', serving: '1 cup', cal: 150, p: 5, c: 27, f: 3, category: 'carbs' },
    broccoli: { name: 'Steamed Broccoli', serving: '1 cup', cal: 55, p: 4, c: 10, f: 0, category: 'vegetables' }
  };
  if (presets[type]) {
    foodDatabase.push(presets[type]);
    renderFoodDatabase();
    alert(`Added ${presets[type].name} to database!`);
  }
}

function viewPlan(clientId) {
  showNutritionTab('create');
  document.getElementById('nutrition-client').value = clientId;
  loadClientStats();
}

// ==================== PROGRAM STUDIO ====================

// Studio State
let studioExercises = [];
let programData = {
  title: 'New Program',
  client: '',
  weeks: 4,
  currentWeek: 1,
  days: {
    1: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
    2: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
    3: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
    4: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] }
  }
};
let programHistory = [];
let historyIndex = -1;

// Load exercises for studio
function loadStudioExercises() {
  // Demo exercises for the studio
  studioExercises = [
    { id: 1, name: 'Barbell Bench Press', bodyPart: 'chest', equipment: 'barbell' },
    { id: 2, name: 'Incline Dumbbell Press', bodyPart: 'chest', equipment: 'dumbbell' },
    { id: 3, name: 'Cable Flyes', bodyPart: 'chest', equipment: 'cable' },
    { id: 4, name: 'Barbell Row', bodyPart: 'back', equipment: 'barbell' },
    { id: 5, name: 'Lat Pulldown', bodyPart: 'back', equipment: 'cable' },
    { id: 6, name: 'Seated Cable Row', bodyPart: 'back', equipment: 'cable' },
    { id: 7, name: 'Overhead Press', bodyPart: 'shoulders', equipment: 'barbell' },
    { id: 8, name: 'Lateral Raises', bodyPart: 'shoulders', equipment: 'dumbbell' },
    { id: 9, name: 'Face Pulls', bodyPart: 'shoulders', equipment: 'cable' },
    { id: 10, name: 'Barbell Curl', bodyPart: 'upper arms', equipment: 'barbell' },
    { id: 11, name: 'Tricep Pushdown', bodyPart: 'upper arms', equipment: 'cable' },
    { id: 12, name: 'Hammer Curls', bodyPart: 'upper arms', equipment: 'dumbbell' },
    { id: 13, name: 'Barbell Squat', bodyPart: 'upper legs', equipment: 'barbell' },
    { id: 14, name: 'Romanian Deadlift', bodyPart: 'upper legs', equipment: 'barbell' },
    { id: 15, name: 'Leg Press', bodyPart: 'upper legs', equipment: 'machine' },
    { id: 16, name: 'Leg Curl', bodyPart: 'upper legs', equipment: 'machine' },
    { id: 17, name: 'Leg Extension', bodyPart: 'upper legs', equipment: 'machine' },
    { id: 18, name: 'Calf Raises', bodyPart: 'lower legs', equipment: 'machine' },
    { id: 19, name: 'Plank', bodyPart: 'waist', equipment: 'body weight' },
    { id: 20, name: 'Cable Crunch', bodyPart: 'waist', equipment: 'cable' },
    { id: 21, name: 'Pull-ups', bodyPart: 'back', equipment: 'body weight' },
    { id: 22, name: 'Dips', bodyPart: 'chest', equipment: 'body weight' },
    { id: 23, name: 'Push-ups', bodyPart: 'chest', equipment: 'body weight' },
    { id: 24, name: 'Deadlift', bodyPart: 'back', equipment: 'barbell' }
  ];
  renderStudioExercises();
}

function renderStudioExercises(exercises = studioExercises) {
  const list = document.getElementById('studio-exercise-list');
  list.innerHTML = exercises.map(ex => `
    <div class="studio-exercise-item" draggable="true" ondragstart="dragStart(event, ${ex.id})" data-id="${ex.id}">
      <div class="studio-exercise-name">${ex.name}</div>
      <div class="studio-exercise-meta">
        <span class="studio-exercise-tag bodypart">${ex.bodyPart}</span>
        <span class="studio-exercise-tag equipment">${ex.equipment}</span>
      </div>
    </div>
  `).join('');
  document.getElementById('exercise-count').textContent = `${exercises.length} exercises`;
}

function filterStudioExercises() {
  const search = document.getElementById('studio-exercise-search').value.toLowerCase();
  const bodyPart = document.getElementById('studio-bodypart').value.toLowerCase();
  const equipment = document.getElementById('studio-equipment').value.toLowerCase();
  
  let filtered = studioExercises;
  if (search) filtered = filtered.filter(ex => ex.name.toLowerCase().includes(search));
  if (bodyPart) filtered = filtered.filter(ex => ex.bodyPart.toLowerCase().includes(bodyPart));
  if (equipment) filtered = filtered.filter(ex => ex.equipment.toLowerCase().includes(equipment));
  
  renderStudioExercises(filtered);
}

// Drag and Drop
function dragStart(event, exerciseId) {
  event.dataTransfer.setData('exerciseId', exerciseId);
  event.target.classList.add('dragging');
}

function allowDrop(event) {
  event.preventDefault();
  event.currentTarget.classList.add('drag-over');
}

function dropExercise(event, dayNum) {
  event.preventDefault();
  event.currentTarget.classList.remove('drag-over');
  
  const exerciseId = parseInt(event.dataTransfer.getData('exerciseId'));
  const exercise = studioExercises.find(ex => ex.id === exerciseId);
  
  if (exercise) {
    saveToHistory();
    const week = programData.currentWeek;
    const newExercise = {
      ...exercise,
      uid: Date.now(),
      sets: [{ reps: 10, weight: '' }, { reps: 10, weight: '' }, { reps: 10, weight: '' }]
    };
    programData.days[week][dayNum].push(newExercise);
    renderDayExercises(dayNum);
    updateProgramStats();
  }
  
  document.querySelectorAll('.dragging').forEach(el => el.classList.remove('dragging'));
}

function renderDayExercises(dayNum) {
  const container = document.getElementById(`day-${dayNum}-exercises`);
  const week = programData.currentWeek;
  const exercises = programData.days[week][dayNum];
  
  if (exercises.length === 0) {
    container.innerHTML = '<div class="drop-zone-hint">Drag exercises here</div>';
    return;
  }
  
  container.innerHTML = exercises.map((ex, idx) => `
    <div class="program-exercise" draggable="true">
      <div class="program-exercise-remove" onclick="removeExercise(${dayNum}, ${idx})"></div>
      <div class="program-exercise-name">${ex.name}</div>
      <div class="program-exercise-sets">
        ${ex.sets.map((s, i) => `
          <div class="program-exercise-set" onclick="event.stopPropagation()">
            <input type="number" value="${s.reps || 10}" onchange="updateSet(${dayNum}, ${idx}, ${i}, 'reps', this.value)" onclick="this.select()">
            <span class="program-exercise-set-label"></span>
            <input type="text" value="${s.weight || ''}" placeholder="wt" onchange="updateSet(${dayNum}, ${idx}, ${i}, 'weight', this.value)" onclick="this.select()" style="width:32px;">
          </div>
        `).join('')}
        <button class="program-exercise-add-set" onclick="addSet(${dayNum}, ${idx})">+</button>
      </div>
    </div>
  `).join('');
}

function updateSet(dayNum, exIdx, setIdx, field, value) {
  const week = programData.currentWeek;
  if (field === 'reps') {
    programData.days[week][dayNum][exIdx].sets[setIdx].reps = parseInt(value) || 10;
  } else if (field === 'weight') {
    programData.days[week][dayNum][exIdx].sets[setIdx].weight = value;
  }
  updateProgramStats();
}

function addSet(dayNum, exIdx) {
  saveToHistory();
  const week = programData.currentWeek;
  const lastSet = programData.days[week][dayNum][exIdx].sets.slice(-1)[0] || { reps: 10, weight: '' };
  programData.days[week][dayNum][exIdx].sets.push({ reps: lastSet.reps, weight: lastSet.weight });
  renderDayExercises(dayNum);
  updateProgramStats();
}

function removeExercise(dayNum, index) {
  saveToHistory();
  const week = programData.currentWeek;
  programData.days[week][dayNum].splice(index, 1);
  renderDayExercises(dayNum);
  updateProgramStats();
}

// Panel Toggle
function togglePanel(panel) {
  if (panel === 'exercises') {
    const mainPanel = document.getElementById('panel-exercises');
    const collapsed = document.getElementById('panel-exercises-collapsed');
    const isCollapsed = mainPanel.style.display === 'none';
    
    mainPanel.style.display = isCollapsed ? 'flex' : 'none';
    collapsed.style.display = isCollapsed ? 'none' : 'flex';
  } else if (panel === 'ai') {
    const mainPanel = document.getElementById('panel-ai');
    const collapsed = document.getElementById('panel-ai-collapsed');
    const isCollapsed = mainPanel.style.display === 'none';
    
    mainPanel.style.display = isCollapsed ? 'flex' : 'none';
    collapsed.style.display = isCollapsed ? 'none' : 'flex';
  }
}

// Week Management
function selectWeek(weekNum) {
  programData.currentWeek = weekNum;
  document.querySelectorAll('.week-tab').forEach((tab, i) => {
    tab.classList.toggle('active', i + 1 === weekNum);
  });
  renderAllDays();
}

function changeWeek(direction) {
  const newWeek = programData.currentWeek + direction;
  if (newWeek >= 1 && newWeek <= programData.weeks) {
    selectWeek(newWeek);
  }
}

function addWeek() {
  programData.weeks++;
  programData.days[programData.weeks] = { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] };
  renderWeekTabs();
  selectWeek(programData.weeks);
}

function renderWeekTabs() {
  const container = document.getElementById('week-tabs');
  container.innerHTML = '';
  for (let i = 1; i <= programData.weeks; i++) {
    const btn = document.createElement('button');
    btn.className = 'week-tab' + (i === programData.currentWeek ? ' active' : '');
    btn.textContent = `Week ${i}`;
    btn.onclick = () => selectWeek(i);
    container.appendChild(btn);
  }
}

function renderAllDays() {
  for (let i = 1; i <= 7; i++) {
    renderDayExercises(i);
  }
}

// History (Undo/Redo)
function saveToHistory() {
  programHistory = programHistory.slice(0, historyIndex + 1);
  programHistory.push(JSON.parse(JSON.stringify(programData.days)));
  historyIndex++;
  if (programHistory.length > 50) {
    programHistory.shift();
    historyIndex--;
  }
}

function undoProgramChange() {
  if (historyIndex > 0) {
    historyIndex--;
    programData.days = JSON.parse(JSON.stringify(programHistory[historyIndex]));
    renderAllDays();
    updateProgramStats();
  }
}

function redoProgramChange() {
  if (historyIndex < programHistory.length - 1) {
    historyIndex++;
    programData.days = JSON.parse(JSON.stringify(programHistory[historyIndex]));
    renderAllDays();
    updateProgramStats();
  }
}

// Program Stats
function updateProgramStats() {
  let totalExercises = 0;
  let totalSets = 0;
  
  const week = programData.currentWeek;
  for (let day = 1; day <= 7; day++) {
    const exercises = programData.days[week][day];
    totalExercises += exercises.length;
    exercises.forEach(ex => totalSets += ex.sets.length);
  }
  
  document.getElementById('stat-exercises').textContent = totalExercises;
  document.getElementById('stat-sets').textContent = totalSets;
  document.getElementById('stat-volume').textContent = totalSets * 10; // Simplified volume calc
}

// AI Studio Assistant
function sendAIStudioMessage() {
  const input = document.getElementById('ai-studio-input');
  const message = input.value.trim();
  if (!message) return;
  
  const chat = document.getElementById('ai-studio-chat');
  chat.innerHTML += `<div class="ai-studio-msg user"><div class="ai-studio-msg-content">${message}</div></div>`;
  input.value = '';
  
  // Simulate AI response
  setTimeout(() => {
    let response = processAIStudioCommand(message);
    chat.innerHTML += `<div class="ai-studio-msg assistant"><div class="ai-studio-msg-content">${response}</div></div>`;
    chat.scrollTop = chat.scrollHeight;
  }, 500);
}

function aiStudioCommand(command) {
  const chat = document.getElementById('ai-studio-chat');
  let response = '';
  
  switch(command) {
    case 'generate':
      showProgramDraftUI();
      response = "Let's build a program! Tell me about your client - their goals, experience level, how many days they can train, any strengths/weaknesses, and how long the program should be.";
      break;
    case 'deload':
      response = addDeloadWeek();
      break;
    case 'progress':
      response = addProgression();
      break;
    case 'balance':
      response = balanceVolume();
      break;
  }
  
  chat.innerHTML += `<div class="ai-studio-msg assistant"><div class="ai-studio-msg-content">${response}</div></div>`;
  chat.scrollTop = chat.scrollHeight;
}

// Program Draft State
let programDraft = null;

function processAIStudioCommand(message) {
  const lower = message.toLowerCase();
  
  // Check for detailed program request
  if (isDetailedProgramRequest(lower)) {
    return generateProgramDraft(message);
  }
  
  // Check if user is responding to a draft
  if (programDraft && (lower.includes('looks good') || lower.includes('love it') || lower.includes('perfect') || lower.includes('apply') || lower.includes('populate') || lower.includes('let\'s do it') || lower.includes('yes'))) {
    return applyProgramDraft();
  }
  
  // Check for draft modifications
  if (programDraft) {
    if (lower.includes('more') && lower.includes('sled')) {
      return modifyDraft('more_sleds');
    }
    if (lower.includes('less') || lower.includes('reduce')) {
      return modifyDraft('reduce_volume');
    }
    if (lower.includes('add') && lower.includes('running')) {
      return modifyDraft('more_running');
    }
    if (lower.includes('change') || lower.includes('swap') || lower.includes('different')) {
      return "What would you like me to change? I can adjust the focus areas, swap exercises, change the weekly structure, or modify the progression.";
    }
  }
  
  // Simple commands
  if (lower.includes('generate') || lower.includes('create program')) {
    return "Tell me about the program you want to create! Include details like:\n Client name and goals\n Training days per week\n Program length\n Any strengths or weaknesses\n Equipment available";
  } else if (lower.includes('deload')) {
    return addDeloadWeek();
  } else if (lower.includes('chest') && lower.includes('monday')) {
    addExercisesToDay(1, ['chest']);
    return "Added chest exercises to Monday. I've included Bench Press, Incline Press, and Cable Flyes.";
  } else if (lower.includes('back') && lower.includes('tuesday')) {
    addExercisesToDay(2, ['back']);
    return "Added back exercises to Tuesday. I've included Barbell Row, Lat Pulldown, and Seated Cable Row.";
  } else if (lower.includes('legs') && lower.includes('thursday')) {
    addExercisesToDay(4, ['upper legs']);
    return "Added leg exercises to Thursday. I've included Squats, Romanian Deadlifts, and Leg Press.";
  } else if (lower.includes('progression') || lower.includes('progressive')) {
    return addProgression();
  } else if (lower.includes('balance')) {
    return balanceVolume();
  }
  
  return "I can help build your program! Tell me about your client - their goals, how many days they can train, program length, and any specific needs. For example:\n\n<em>'I need a 12-week Hyrox program for Jamie who can train 3 days/week, has a 21 min 5k but struggles with sleds and wall balls'</em>";
}

function isDetailedProgramRequest(text) {
  const hasGoal = text.includes('program') || text.includes('plan') || text.includes('build') || text.includes('create') || text.includes('need');
  const hasDetails = text.includes('week') || text.includes('day') || text.includes('client') || text.match(/\d+\s*(week|day|min|kg|lb)/);
  const hasContext = text.length > 50;
  return hasGoal && (hasDetails || hasContext);
}

function generateProgramDraft(message) {
  const lower = message.toLowerCase();
  
  // Parse program details
  const weeks = extractNumber(lower, 'week') || 8;
  const days = extractNumber(lower, 'day') || 3;
  const clientName = extractClientName(message) || 'Client';
  
  // Detect program type
  let programType = 'general';
  if (lower.includes('hyrox')) programType = 'hyrox';
  else if (lower.includes('strength')) programType = 'strength';
  else if (lower.includes('hypertrophy') || lower.includes('muscle')) programType = 'hypertrophy';
  else if (lower.includes('fat loss') || lower.includes('cut') || lower.includes('weight loss')) programType = 'fatloss';
  else if (lower.includes('endurance') || lower.includes('cardio')) programType = 'endurance';
  else if (lower.includes('athletic') || lower.includes('sport')) programType = 'athletic';
  
  // Extract strengths and weaknesses
  const strengths = [];
  const weaknesses = [];
  
  if (lower.includes('good at') || lower.includes('great at') || lower.includes('strong')) {
    if (lower.includes('running') || lower.includes('run') || lower.includes('cardio')) strengths.push('running');
    if (lower.includes('upper')) strengths.push('upper body');
    if (lower.includes('lower') || lower.includes('legs')) strengths.push('lower body');
  }
  
  if (lower.includes('bad at') || lower.includes('weak') || lower.includes('struggles') || lower.includes('needs work')) {
    if (lower.includes('sled')) weaknesses.push('sled push/pull');
    if (lower.includes('lunge')) weaknesses.push('lunges');
    if (lower.includes('wall') && lower.includes('ball')) weaknesses.push('wall balls');
    if (lower.includes('row')) weaknesses.push('rowing');
    if (lower.includes('burpee')) weaknesses.push('burpees');
    if (lower.includes('farmer') || lower.includes('carry')) weaknesses.push('farmers carry');
    if (lower.includes('upper')) weaknesses.push('upper body');
    if (lower.includes('lower') || lower.includes('legs')) weaknesses.push('lower body');
  }
  
  // Extract any benchmark times
  let benchmarks = {};
  const fiveKMatch = lower.match(/(\d+)\s*min.*5k/);
  if (fiveKMatch) benchmarks['5k'] = fiveKMatch[1] + ' min';
  
  // Generate the draft
  programDraft = {
    clientName,
    weeks,
    daysPerWeek: days,
    type: programType,
    strengths,
    weaknesses,
    benchmarks,
    phases: generatePhases(weeks, programType, weaknesses)
  };
  
  return formatProgramDraft(programDraft);
}

function extractNumber(text, unit) {
  const regex = new RegExp(`(\\d+)\\s*${unit}`);
  const match = text.match(regex);
  return match ? parseInt(match[1]) : null;
}

function extractClientName(text) {
  const patterns = [
    /for\s+([A-Z][a-z]+)/,
    /client\s+([A-Z][a-z]+)/,
    /([A-Z][a-z]+)(?:'s|,?\s+who)/
  ];
  for (const pattern of patterns) {
    const match = text.match(pattern);
    if (match) return match[1];
  }
  return null;
}

function generatePhases(weeks, type, weaknesses) {
  const phases = [];
  const weeksPerPhase = Math.ceil(weeks / 3);
  
  if (type === 'hyrox') {
    phases.push({
      name: 'Foundation & Weakness Focus',
      weeks: `1-${weeksPerPhase}`,
      focus: 'Build base fitness while targeting weak areas',
      weeklyStructure: [
        { day: 'Day 1', name: 'Strength + Weakness Work', exercises: ['Sled Push/Pull technique', 'Goblet Squats', 'Wall Ball practice', 'Lunges', 'Core work'] },
        { day: 'Day 2', name: 'Running + Conditioning', exercises: ['Zone 2 run (30-40 min)', 'Rowing intervals', 'Burpee practice', 'Farmers carry'] },
        { day: 'Day 3', name: 'Hyrox Simulation (Light)', exercises: ['Mini Hyrox circuit', 'Focus on transitions', 'Weakness stations 2x volume'] }
      ],
      notes: weaknesses.length > 0 ? `Extra focus on: ${weaknesses.join(', ')}` : 'Building overall work capacity'
    });
    
    phases.push({
      name: 'Capacity Building',
      weeks: `${weeksPerPhase + 1}-${weeksPerPhase * 2}`,
      focus: 'Increase volume and intensity',
      weeklyStructure: [
        { day: 'Day 1', name: 'Heavy Strength', exercises: ['Deadlifts', 'Heavy sled work', 'Weighted lunges', 'Wall balls (heavier)', 'Sandbag carries'] },
        { day: 'Day 2', name: 'Speed + Intervals', exercises: ['Tempo runs', '1km repeats', 'Ski erg intervals', 'Burpee broad jumps'] },
        { day: 'Day 3', name: 'Hyrox Simulation (Race Pace)', exercises: ['Full Hyrox simulation', 'Race pace practice', 'Transition drills'] }
      ],
      notes: 'Progressive overload on all stations'
    });
    
    phases.push({
      name: 'Race Prep & Peak',
      weeks: `${weeksPerPhase * 2 + 1}-${weeks}`,
      focus: 'Sharpen race fitness, reduce volume',
      weeklyStructure: [
        { day: 'Day 1', name: 'Maintenance Strength', exercises: ['Moderate sled work', 'Lunges', 'Wall balls at race weight', 'Core stability'] },
        { day: 'Day 2', name: 'Race Pace Running', exercises: ['Race pace 5k', 'Negative splits practice', 'Short recovery runs'] },
        { day: 'Day 3', name: 'Full Simulation or Rest', exercises: ['Week 1: Full sim', 'Week 2: Active recovery', 'Week 3: Light sim', 'Week 4: Taper'] }
      ],
      notes: 'Deload in final week before race'
    });
  } else {
    // Generic program phases
    phases.push({
      name: 'Foundation Phase',
      weeks: `1-${weeksPerPhase}`,
      focus: 'Build base strength and movement quality',
      weeklyStructure: generateGenericWeek(type, 'foundation'),
      notes: 'Focus on form and building habits'
    });
    
    phases.push({
      name: 'Development Phase',
      weeks: `${weeksPerPhase + 1}-${weeksPerPhase * 2}`,
      focus: 'Progressive overload and volume increase',
      weeklyStructure: generateGenericWeek(type, 'development'),
      notes: 'Increase intensity each week'
    });
    
    phases.push({
      name: 'Peak Phase',
      weeks: `${weeksPerPhase * 2 + 1}-${weeks}`,
      focus: 'Maximize performance, then deload',
      weeklyStructure: generateGenericWeek(type, 'peak'),
      notes: 'Final week is deload'
    });
  }
  
  return phases;
}

function generateGenericWeek(type, phase) {
  if (type === 'strength') {
    return [
      { day: 'Day 1', name: 'Upper Body', exercises: ['Bench Press', 'Rows', 'Overhead Press', 'Pull-ups', 'Tricep work'] },
      { day: 'Day 2', name: 'Lower Body', exercises: ['Squats', 'Romanian Deadlifts', 'Leg Press', 'Lunges', 'Calf raises'] },
      { day: 'Day 3', name: 'Full Body', exercises: ['Deadlifts', 'Incline Press', 'Lat Pulldown', 'Leg Curl', 'Core'] }
    ];
  }
  return [
    { day: 'Day 1', name: 'Push', exercises: ['Bench Press', 'Shoulder Press', 'Incline DB Press', 'Lateral Raises', 'Triceps'] },
    { day: 'Day 2', name: 'Pull', exercises: ['Barbell Row', 'Pull-ups', 'Face Pulls', 'Bicep Curls', 'Rear Delts'] },
    { day: 'Day 3', name: 'Legs', exercises: ['Squats', 'RDL', 'Leg Press', 'Leg Curls', 'Calf Raises'] }
  ];
}

function formatProgramDraft(draft) {
  let html = `<div class="program-draft">
    <div class="draft-header">
      <strong> Program Draft: ${draft.clientName}</strong><br>
      <span style="color:#888;">${draft.weeks} weeks  ${draft.daysPerWeek} days/week  ${draft.type.charAt(0).toUpperCase() + draft.type.slice(1)}</span>
    </div>`;
  
  if (draft.weaknesses.length > 0) {
    html += `<div class="draft-section"><strong> Priority Areas:</strong> ${draft.weaknesses.join(', ')}</div>`;
  }
  
  if (Object.keys(draft.benchmarks).length > 0) {
    html += `<div class="draft-section"><strong> Current Benchmarks:</strong> ${Object.entries(draft.benchmarks).map(([k,v]) => `${k}: ${v}`).join(', ')}</div>`;
  }
  
  html += `<div class="draft-phases">`;
  
  draft.phases.forEach((phase, i) => {
    html += `
      <div class="draft-phase">
        <div class="phase-header">
          <strong>Phase ${i + 1}: ${phase.name}</strong>
          <span class="phase-weeks">Weeks ${phase.weeks}</span>
        </div>
        <div class="phase-focus">${phase.focus}</div>
        <div class="phase-structure">`;
    
    phase.weeklyStructure.forEach(day => {
      html += `
        <div class="phase-day">
          <strong>${day.day}:</strong> ${day.name}
          <div class="phase-exercises">${day.exercises.join('  ')}</div>
        </div>`;
    });
    
    html += `</div>`;
    if (phase.notes) {
      html += `<div class="phase-notes"> ${phase.notes}</div>`;
    }
    html += `</div>`;
  });
  
  html += `</div>
    <div class="draft-actions">
      <strong>What do you think?</strong><br>
      <span style="color:#888;">Say "looks good" to populate the studio, or tell me what to change.</span>
    </div>
  </div>`;
  
  return html;
}

function modifyDraft(modification) {
  if (!programDraft) return "No draft to modify. Tell me about the program you want to create!";
  
  switch(modification) {
    case 'more_sleds':
      programDraft.phases.forEach(phase => {
        phase.weeklyStructure.forEach(day => {
          if (!day.exercises.some(e => e.toLowerCase().includes('sled'))) {
            day.exercises.push('Sled work');
          }
        });
      });
      return formatProgramDraft(programDraft) + "\n\n Added more sled work throughout the program.";
    case 'reduce_volume':
      programDraft.phases.forEach(phase => {
        phase.weeklyStructure.forEach(day => {
          day.exercises = day.exercises.slice(0, 4);
        });
      });
      return formatProgramDraft(programDraft) + "\n\n Reduced volume across all phases.";
    case 'more_running':
      programDraft.phases.forEach(phase => {
        phase.weeklyStructure.forEach(day => {
          if (day.name.toLowerCase().includes('running') || day.name.toLowerCase().includes('cardio')) {
            day.exercises.unshift('Additional running block');
          }
        });
      });
      return formatProgramDraft(programDraft) + "\n\n Added more running volume.";
  }
  return formatProgramDraft(programDraft);
}

function applyProgramDraft() {
  if (!programDraft) return "No draft to apply. Tell me about the program you want to create!";
  
  // Set program title and weeks
  document.getElementById('program-title').value = `${programDraft.clientName} - ${programDraft.type.charAt(0).toUpperCase() + programDraft.type.slice(1)} ${programDraft.weeks}wk`;
  
  // Expand weeks if needed
  while (programData.weeks < programDraft.weeks) {
    addWeek();
  }
  
  // Populate exercises based on draft
  saveToHistory();
  
  const dayMapping = { 1: 1, 2: 3, 3: 5 }; // Map 3-day to Mon/Wed/Fri
  
  for (let week = 1; week <= programDraft.weeks; week++) {
    // Determine which phase this week is in
    const phaseIndex = Math.min(Math.floor((week - 1) / Math.ceil(programDraft.weeks / 3)), programDraft.phases.length - 1);
    const phase = programDraft.phases[phaseIndex];
    
    // Clear the week first
    for (let d = 1; d <= 7; d++) {
      programData.days[week][d] = [];
    }
    
    // Populate based on phase structure
    phase.weeklyStructure.forEach((dayPlan, idx) => {
      const actualDay = dayMapping[idx + 1] || (idx * 2 + 1);
      const exercises = mapExercisesToStudio(dayPlan.exercises, dayPlan.name);
      
      programData.days[week][actualDay] = exercises.map(ex => ({
        ...ex,
        uid: Date.now() + Math.random(),
        sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
      }));
      
      // Update day focus label
      const focusEl = document.querySelector(`.day-column[data-day="${actualDay}"] .day-focus`);
      if (focusEl) focusEl.textContent = dayPlan.name;
    });
  }
  
  renderWeekTabs();
  selectWeek(1);
  renderAllDays();
  updateProgramStats();
  
  const draft = programDraft;
  programDraft = null; // Clear draft
  
  return ` <strong>Program populated!</strong><br><br>
    I've loaded the ${draft.weeks}-week ${draft.type} program for ${draft.clientName} into the studio.<br><br>
    <strong>What's loaded:</strong><br>
     ${draft.phases.length} phases across ${draft.weeks} weeks<br>
     ${draft.daysPerWeek} training days per week<br>
     Exercises mapped to your library<br><br>
    You can now drag exercises to customize, adjust sets/reps, or ask me to make changes!`;
}

function mapExercisesToStudio(exerciseNames, dayType) {
  const mapped = [];
  const dayLower = dayType.toLowerCase();
  
  exerciseNames.forEach(name => {
    const nameLower = name.toLowerCase();
    
    // Try to find matching exercise in studio library
    let match = studioExercises.find(ex => 
      ex.name.toLowerCase().includes(nameLower.split(' ')[0]) ||
      nameLower.includes(ex.name.toLowerCase().split(' ')[0])
    );
    
    // If no match, create a placeholder based on the exercise type
    if (!match) {
      // Map common Hyrox/functional exercises
      if (nameLower.includes('sled')) {
        match = { id: 100, name: 'Sled Push/Pull', bodyPart: 'full body', equipment: 'sled' };
      } else if (nameLower.includes('wall ball')) {
        match = { id: 101, name: 'Wall Balls', bodyPart: 'full body', equipment: 'medicine ball' };
      } else if (nameLower.includes('burpee')) {
        match = { id: 102, name: 'Burpee Broad Jumps', bodyPart: 'full body', equipment: 'body weight' };
      } else if (nameLower.includes('row') && nameLower.includes('ski')) {
        match = { id: 103, name: 'Ski Erg', bodyPart: 'full body', equipment: 'machine' };
      } else if (nameLower.includes('farmer') || nameLower.includes('carry')) {
        match = { id: 104, name: 'Farmers Carry', bodyPart: 'full body', equipment: 'dumbbell' };
      } else if (nameLower.includes('sandbag')) {
        match = { id: 105, name: 'Sandbag Carry', bodyPart: 'full body', equipment: 'sandbag' };
      } else if (nameLower.includes('run') || nameLower.includes('5k')) {
        match = { id: 106, name: 'Running', bodyPart: 'cardio', equipment: 'none' };
      } else if (nameLower.includes('zone 2')) {
        match = { id: 107, name: 'Zone 2 Cardio', bodyPart: 'cardio', equipment: 'none' };
      } else if (nameLower.includes('interval')) {
        match = { id: 108, name: 'Intervals', bodyPart: 'cardio', equipment: 'none' };
      } else if (nameLower.includes('simulation') || nameLower.includes('circuit')) {
        match = { id: 109, name: 'Hyrox Simulation', bodyPart: 'full body', equipment: 'mixed' };
      } else {
        // Generic fallback
        match = studioExercises[Math.floor(Math.random() * studioExercises.length)];
      }
    }
    
    if (match) mapped.push(match);
  });
  
  return mapped.slice(0, 6); // Limit to 6 exercises per day
}

function showProgramDraftUI() {
  // Could show a modal or expand the AI panel - for now just prompts in chat
}

function generateAIProgram() {
  saveToHistory();
  
  // Generate a PPL split
  const pushExercises = studioExercises.filter(ex => ['chest', 'shoulders'].includes(ex.bodyPart) || ex.name.includes('Tricep'));
  const pullExercises = studioExercises.filter(ex => ['back'].includes(ex.bodyPart) || ex.name.includes('Curl'));
  const legExercises = studioExercises.filter(ex => ['upper legs', 'lower legs'].includes(ex.bodyPart));
  
  for (let week = 1; week <= programData.weeks; week++) {
    // Monday - Push
    programData.days[week][1] = pushExercises.slice(0, 4).map(ex => ({
      ...ex, uid: Date.now() + Math.random(),
      sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
    }));
    
    // Tuesday - Pull
    programData.days[week][2] = pullExercises.slice(0, 4).map(ex => ({
      ...ex, uid: Date.now() + Math.random(),
      sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
    }));
    
    // Wednesday - Rest
    programData.days[week][3] = [];
    
    // Thursday - Legs
    programData.days[week][4] = legExercises.slice(0, 4).map(ex => ({
      ...ex, uid: Date.now() + Math.random(),
      sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
    }));
    
    // Friday - Upper
    programData.days[week][5] = [...pushExercises.slice(0, 2), ...pullExercises.slice(0, 2)].map(ex => ({
      ...ex, uid: Date.now() + Math.random(),
      sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
    }));
    
    // Saturday - Cardio/Active Recovery
    programData.days[week][6] = [];
    
    // Sunday - Rest
    programData.days[week][7] = [];
  }
  
  renderAllDays();
  updateProgramStats();
  
  return "Generated a 4-week Push/Pull/Legs program! Monday is Push, Tuesday is Pull, Thursday is Legs, Friday is Upper body. Feel free to drag exercises to customize.";
}

function addExercisesToDay(dayNum, bodyParts) {
  saveToHistory();
  const week = programData.currentWeek;
  const exercises = studioExercises.filter(ex => bodyParts.includes(ex.bodyPart)).slice(0, 3);
  
  exercises.forEach(ex => {
    programData.days[week][dayNum].push({
      ...ex, uid: Date.now() + Math.random(),
      sets: [{ reps: 10 }, { reps: 10 }, { reps: 10 }]
    });
  });
  
  renderDayExercises(dayNum);
  updateProgramStats();
}

function addDeloadWeek() {
  saveToHistory();
  const lastWeek = programData.weeks;
  
  // Copy last week but reduce sets
  for (let day = 1; day <= 7; day++) {
    programData.days[lastWeek][day] = programData.days[lastWeek][day].map(ex => ({
      ...ex,
      sets: ex.sets.slice(0, 2).map(s => ({ ...s, reps: Math.max(6, s.reps - 2) }))
    }));
  }
  
  renderAllDays();
  updateProgramStats();
  
  return `Week ${lastWeek} is now a deload week with reduced volume (2 sets per exercise, lower reps).`;
}

function addProgression() {
  saveToHistory();
  
  // Add progressive overload across weeks
  for (let week = 2; week <= programData.weeks; week++) {
    for (let day = 1; day <= 7; day++) {
      programData.days[week][day] = programData.days[week][day].map(ex => ({
        ...ex,
        sets: ex.sets.map(s => ({ ...s, reps: Math.min(12, s.reps + 1) }))
      }));
    }
  }
  
  renderAllDays();
  return "Added progressive overload: reps increase by 1 each week (up to 12). This creates a natural progression curve.";
}

function balanceVolume() {
  const week = programData.currentWeek;
  let bodyPartVolume = {};
  
  for (let day = 1; day <= 7; day++) {
    programData.days[week][day].forEach(ex => {
      if (!bodyPartVolume[ex.bodyPart]) bodyPartVolume[ex.bodyPart] = 0;
      bodyPartVolume[ex.bodyPart] += ex.sets.length;
    });
  }
  
  let report = "Weekly volume by body part:\n";
  Object.entries(bodyPartVolume).forEach(([part, sets]) => {
    report += ` ${part}: ${sets} sets\n`;
  });
  
  return report + "\nFor balanced development, aim for 10-20 sets per muscle group per week.";
}

// Save Program
function saveProgramStudio() {
  const title = document.getElementById('program-title').value;
  const client = document.getElementById('program-client').value;
  
  const program = {
    title,
    client,
    weeks: programData.weeks,
    days: programData.days,
    createdAt: new Date().toISOString()
  };
  
  // In a real app, this would save to a database
  console.log('Saving program:', program);
  alert(`Program "${title}" saved successfully!`);
}

function showProgramsList() {
  showPage('programs');
}

// Programs page tab switching
function showProgramsTab(tab) {
  document.querySelectorAll('#page-programs .nutrition-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  
  document.getElementById('programs-active').style.display = tab === 'active' ? 'grid' : 'none';
  document.getElementById('programs-templates').style.display = tab === 'templates' ? 'grid' : 'none';
  document.getElementById('programs-archived').style.display = tab === 'archived' ? 'block' : 'none';
}

function editProgram(programId) {
  // Load program data and show detail view
  currentProgramId = programId;
  const programs = {
    'ppl': { title: 'Push/Pull/Legs', client: 'Sarah Johnson', type: 'Hypertrophy', duration: '8 weeks', frequency: '4 days/week', week: 'Week 3 of 8', completion: '37%', compliance: '85%', workouts: '12', remaining: '20' },
    'strength': { title: 'Strength Builder', client: 'Mike Chen', type: 'Strength', duration: '12 weeks', frequency: '5 days/week', week: 'Week 6 of 12', completion: '50%', compliance: '92%', workouts: '30', remaining: '30' },
    'cut': { title: 'Summer Cut', client: 'Emma Wilson', type: 'Fat Loss', duration: '6 weeks', frequency: '6 days/week', week: 'Week 2 of 6', completion: '33%', compliance: '78%', workouts: '12', remaining: '24' },
    'beginner': { title: 'Beginner Foundations', client: 'David Park', type: 'General', duration: '4 weeks', frequency: '3 days/week', week: 'Week 1 of 4', completion: '25%', compliance: '100%', workouts: '3', remaining: '9' }
  };
  
  const p = programs[programId] || programs['ppl'];
  document.getElementById('program-detail-title').textContent = p.title;
  document.getElementById('program-detail-client').textContent = p.client;
  document.getElementById('program-detail-type').textContent = p.type;
  document.getElementById('program-detail-duration').textContent = p.duration;
  document.getElementById('program-detail-frequency').textContent = p.frequency;
  document.getElementById('program-detail-week').textContent = p.week;
  document.getElementById('program-detail-completion').textContent = p.completion;
  document.getElementById('program-detail-compliance').textContent = p.compliance;
  document.getElementById('program-detail-workouts').textContent = p.workouts;
  document.getElementById('program-detail-remaining').textContent = p.remaining;
  document.getElementById('program-detail-progress-bar').style.width = p.completion;
  
  showPage('program-detail');
}

let currentProgramId = null;

function editInStudio() {
  // Load the current program into the studio for editing
  showPage('studio');
}

function duplicateProgram() {
  alert('Program duplicated! You can now edit the copy.');
  showPage('studio');
}

function viewProgramWeek(weekNum) {
  document.querySelectorAll('#page-program-detail .period-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  // In a real app, this would load the week's data
}

function useTemplate(templateId) {
  // In a real app, this would create a new program from the template
  showPage('studio');
}

// ==================== CLIENT DETAIL ====================
let currentClientId = null;

const clientData = {
  sarah: {
    name: 'Sarah Johnson', initials: 'SJ', meta: 'Hypertrophy  3x/week  Since Oct 2024',
    avatar: 'linear-gradient(135deg, #4169E1, #00ff88)',
    compliance: '94%', complianceTrend: ' 8% vs last month',
    workouts: '12', weight: '142 lbs', weightTrend: ' 3 lbs this month', streak: '8'
  },
  mike: {
    name: 'Mike Chen', initials: 'MC', meta: 'Strength  4x/week  Since Aug 2024',
    avatar: 'linear-gradient(135deg, #00ff88, #4169E1)',
    compliance: '88%', complianceTrend: ' 3% vs last month',
    workouts: '18', weight: '185 lbs', weightTrend: ' 4 lbs (muscle)', streak: '12'
  },
  emma: {
    name: 'Emma Wilson', initials: 'EW', meta: 'Fat Loss  3x/week  Since Nov 2024',
    avatar: 'linear-gradient(135deg, #ff6b6b, #ffcc00)',
    compliance: '76%', complianceTrend: ' 5% vs last month',
    workouts: '8', weight: '158 lbs', weightTrend: ' 6 lbs this month', streak: '3'
  },
  david: {
    name: 'David Park', initials: 'DP', meta: 'Athletic Performance  5x/week  Since Jun 2024',
    avatar: 'linear-gradient(135deg, #ffcc00, #ff6b6b)',
    compliance: '98%', complianceTrend: ' 2% vs last month',
    workouts: '24', weight: '175 lbs', weightTrend: 'Stable', streak: '21'
  }
};

function viewClient(clientId) {
  currentClientId = clientId;
  const client = clientData[clientId];
  if (!client) return;
  
  document.getElementById('client-detail-name').textContent = client.name;
  document.getElementById('client-detail-meta').textContent = client.meta;
  document.getElementById('client-detail-avatar').textContent = client.initials;
  document.getElementById('client-detail-avatar').style.background = client.avatar;
  document.getElementById('client-stat-compliance').textContent = client.compliance;
  document.getElementById('client-stat-compliance-trend').textContent = client.complianceTrend;
  document.getElementById('client-stat-workouts').textContent = client.workouts;
  document.getElementById('client-stat-weight').textContent = client.weight;
  document.getElementById('client-stat-weight-trend').textContent = client.weightTrend;
  document.getElementById('client-stat-streak').textContent = client.streak;
  
  showPage('client-detail');
  initClientCharts();
}

function initClientCharts() {
  // Strength Progress Chart
  const strengthCtx = document.getElementById('clientStrengthChart');
  if (strengthCtx && !strengthCtx.chart) {
    strengthCtx.chart = new Chart(strengthCtx, {
      type: 'line',
      data: {
        labels: ['Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Bench Press',
          data: [95, 100, 107],
          borderColor: '#4169E1',
          backgroundColor: '#4169E120',
          tension: 0.3,
          fill: true
        }, {
          label: 'Squat',
          data: [135, 165, 185],
          borderColor: '#00ff88',
          backgroundColor: '#00ff8820',
          tension: 0.3,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom', labels: { color: '#888', boxWidth: 12, padding: 10 } } },
        scales: {
          x: { grid: { color: '#222' }, ticks: { color: '#666' } },
          y: { grid: { color: '#222' }, ticks: { color: '#666' } }
        }
      }
    });
  }
  
  // Body Composition Chart
  const bodyCtx = document.getElementById('clientBodyChart');
  if (bodyCtx && !bodyCtx.chart) {
    bodyCtx.chart = new Chart(bodyCtx, {
      type: 'line',
      data: {
        labels: ['Wk 1', 'Wk 4', 'Wk 8', 'Wk 12'],
        datasets: [{
          label: 'Weight (lbs)',
          data: [148, 146, 144, 142],
          borderColor: '#fff',
          tension: 0.3,
          yAxisID: 'y'
        }, {
          label: 'Body Fat %',
          data: [28, 26.5, 25, 24],
          borderColor: '#ff6b6b',
          tension: 0.3,
          yAxisID: 'y1'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true, position: 'bottom', labels: { color: '#888', boxWidth: 12, padding: 10 } } },
        scales: {
          x: { grid: { color: '#222' }, ticks: { color: '#666' } },
          y: { type: 'linear', position: 'left', grid: { color: '#222' }, ticks: { color: '#666' } },
          y1: { type: 'linear', position: 'right', grid: { display: false }, ticks: { color: '#ff6b6b' } }
        }
      }
    });
  }
}

function messageClient() {
  showPage('messages');
}

function editClientProgram() {
  showPage('studio');
}

function applyInsight(action) {
  if (action === 'deload') {
    alert('Deload week applied to ' + clientData[currentClientId]?.name + "'s program. Volume reduced by 20% for the next week.");
  }
}

function dismissInsight(btn) {
  btn.closest('.insight-card').style.display = 'none';
}

function sendNutritionTip() {
  alert('Nutrition tip sent to ' + clientData[currentClientId]?.name + ' via in-app message.');
}

function askClientAI(question) {
  const input = document.getElementById('client-ai-input');
  const q = question || input.value.trim();
  if (!q) return;
  
  const client = clientData[currentClientId];
  const feed = document.getElementById('client-insights-feed');
  
  // Add user question
  feed.innerHTML = `
    <div class="insight-card" style="border-left:3px solid #4169E1;background:#4169E110;">
      <div class="insight-header">
        <span class="insight-icon"></span>
        <span class="insight-type">Your Question</span>
        <span class="insight-time">Just now</span>
      </div>
      <div class="insight-body" style="color:#fff;margin:0;">${q}</div>
    </div>
  ` + feed.innerHTML;
  
  // Simulate AI response
  setTimeout(() => {
    let response = generateClientAIResponse(q, client);
    feed.innerHTML = `
      <div class="insight-card positive">
        <div class="insight-header">
          <span class="insight-icon"></span>
          <span class="insight-type"><span style="color:#fff;">Lift</span><span style="color:#00ff88;">Assistant</span></span>
          <span class="insight-time">Just now</span>
        </div>
        <div class="insight-body" style="color:#ccc;margin:0;line-height:1.6;">${response}</div>
      </div>
    ` + feed.innerHTML;
  }, 800);
  
  input.value = '';
}

function generateClientAIResponse(question, client) {
  const q = question.toLowerCase();
  
  if (q.includes('next session') || q.includes('focus')) {
    return `Based on ${client.name}'s recent data:<br><br>
    <strong>Priority for next session:</strong><br>
     Check in on sleep/stress levels (HRV trending down)<br>
     Consider lighter weights, focus on form and mind-muscle connection<br>
     If energy is low, swap the planned workout for active recovery<br><br>
    Her compliance is strong at ${client.compliance}, so this is about recovery optimization, not motivation.`;
  }
  
  if (q.includes('program change') || q.includes('ready')) {
    return `Looking at ${client.name}'s 12-week progression:<br><br>
    <strong>Signs she's ready for change:</strong><br>
     Strength gains plateauing (bench +2 lbs last 3 weeks vs +5 lbs prior)<br>
     RPE consistently 7-8 (adapted to current stimulus)<br>
     Compliance stable above 90%<br><br>
    <strong>Recommendation:</strong> Yes, consider transitioning to a new mesocycle. Options:<br>
    1. Increase volume (add 1 set per exercise)<br>
    2. Change rep ranges (switch to 6-8 from 8-12)<br>
    3. New exercise variations to challenge different movement patterns`;
  }
  
  if (q.includes('summary') || q.includes('month')) {
    return `<strong>${client.name} - December Summary:</strong><br><br>
     <strong>Compliance:</strong> ${client.compliance} (excellent)<br>
     <strong>Workouts:</strong> ${client.workouts} completed<br>
     <strong>PRs:</strong> Squat 185 lbs, Bench 107 lbs<br>
     <strong>Weight:</strong> ${client.weight} (${client.weightTrend})<br>
     <strong>Streak:</strong> ${client.streak} days<br><br>
    <strong>Key wins:</strong> Consistent logging, strength PRs, body composition improving<br>
    <strong>Watch:</strong> Weekend compliance, recovery metrics trending down`;
  }
  
  return `I analyzed ${client.name}'s data for your question. Based on her ${client.compliance} compliance rate and current ${client.streak}-day streak, she's showing strong commitment. Her weight trend (${client.weightTrend}) aligns with her goals. Would you like me to dive deeper into any specific area - nutrition, programming, or recovery?`;
}

function openNewProgramModal() {
  // Reset program data
  programData = {
    title: 'New Program',
    client: '',
    weeks: 4,
    currentWeek: 1,
    days: {
      1: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
      2: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
      3: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] },
      4: { 1: [], 2: [], 3: [], 4: [], 5: [], 6: [], 7: [] }
    }
  };
  document.getElementById('program-title').value = 'New Program';
  document.getElementById('program-client').value = '';
  renderWeekTabs();
  renderAllDays();
  updateProgramStats();
}

// Initialize studio when Programs page is shown
const originalShowPage = showPage;
showPage = function(pageId) {
  originalShowPage(pageId);
  if (pageId === 'studio') {
    loadStudioExercises();
    renderWeekTabs();
    renderAllDays();
    updateProgramStats();
  }
};

// Add drag leave handler
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.day-exercises').forEach(el => {
    el.addEventListener('dragleave', function(e) {
      this.classList.remove('drag-over');
    });
  });
});

// ==================== COMMUNITIES FUNCTIONS ====================

let currentCommunityId = null;

const communityIcons = {
  'accountability': '<svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M12.5 7.5c0-.28-.22-.5-.5-.5s-.5.22-.5.5v4.29l-2.15 2.15c-.2.2-.2.51 0 .71.1.1.23.15.35.15s.26-.05.35-.15l2.29-2.29c.09-.09.16-.21.16-.35V7.5zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>',
  'program': '<svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M13.49 5.48c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-3.6 13.9l1-4.4 2.1 2v6h2v-7.5l-2.1-2 .6-3c1.3 1.5 3.3 2.5 5.5 2.5v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1l-5.2 2.2v4.7h2v-3.4l1.8-.7-1.6 8.1-4.9-1-.4 2 7 1.4z"/></svg>',
  'challenge': '<svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l7.59-7.59L21 8l-9 9z"/></svg>',
  'general': '<svg width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>'
};

const communitiesData = {
  '6am-crew': {
    name: '6AM Crew',
    type: 'accountability',
    gradient: 'linear-gradient(135deg,#ff6b6b,#ffcc00)',
    desc: 'Early morning warriors! Share your wins and keep each other accountable.',
    members: 8,
    messages: [
      { sender: 'Alex Trainer', initials: 'AT', content: 'Welcome to the 6AM Crew! Let\'s crush it together. Post your morning workout wins here!', time: 'Yesterday', type: 'announcement' },
      { sender: 'Sarah Johnson', initials: 'SJ', content: 'Crushed my 5am workout today! New PR on deadlifts - 185 lbs!', time: '2h ago' },
      { sender: 'Mike Chen', initials: 'MC', content: 'Nice Sarah! I hit a new PR on deadlifts this morning too. Something in the water today', time: '1h ago' },
      { sender: 'Alex Trainer', initials: 'AT', content: 'Love seeing this energy! Keep it up team. Remember, Saturday we have the group workout at the park!', time: '30m ago' }
    ]
  },
  'hyrox-prep': {
    name: 'HYROX Prep 2025',
    type: 'program',
    gradient: 'linear-gradient(135deg,#4169E1,#00ff88)',
    desc: 'Training together for the January HYROX race. Tips, workouts, and motivation.',
    members: 12,
    messages: [
      { sender: 'Alex Trainer', initials: 'AT', content: 'Welcome to HYROX Prep! Race day is Jan 18. Let\'s get after it.', time: '3 days ago', type: 'announcement' },
      { sender: 'David Kim', initials: 'DK', content: 'Just finished the sled push practice. My legs are toast', time: '1h ago' },
      { sender: 'Lisa Park', initials: 'LP', content: 'Same! But we\'re getting stronger every day!', time: '45m ago' }
    ]
  },
  'nutrition-challenge': {
    name: 'Nutrition Challenge',
    type: 'challenge',
    gradient: 'linear-gradient(135deg,#00ff88,#4169E1)',
    desc: '30-day nutrition challenge group. Daily check-ins and meal sharing.',
    members: 15,
    messages: [
      { sender: 'Alex Trainer', initials: 'AT', content: 'Day 1 of the challenge starts Monday! Post your meal prep pics', time: '2 days ago', type: 'announcement' },
      { sender: 'Emma Wilson', initials: 'EW', content: 'Here\'s my meal prep for the week! Chicken, rice, and veggies', time: '5h ago' },
      { sender: 'Sarah Johnson', initials: 'SJ', content: 'Looks amazing Emma! I need to up my prep game', time: '4h ago' }
    ]
  }
};

function viewCommunity(communityId) {
  currentCommunityId = communityId;
  const community = communitiesData[communityId];
  if (!community) return;
  
  // Update modal header
  document.getElementById('modal-community-icon').innerHTML = communityIcons[community.type] || communityIcons['general'];
  document.getElementById('modal-community-icon').style.background = community.gradient;
  document.getElementById('modal-community-name').textContent = community.name;
  document.getElementById('modal-community-type').textContent = 
    community.type.charAt(0).toUpperCase() + community.type.slice(1) + ' Group  ' + community.members + ' members';
  
  // Render messages
  renderCommunityMessages(community.messages);
  
  // Show chat tab by default
  showCommunityTab('chat');
  
  // Open modal
  document.getElementById('community-modal').classList.add('open');
}

function renderCommunityMessages(messages) {
  const container = document.getElementById('community-messages');
  container.innerHTML = messages.map(msg => {
    if (msg.type === 'announcement') {
      return `
        <div class="community-message announcement">
          <div class="community-message-header">
            <span class="community-message-sender"> ${msg.sender}</span>
            <span class="community-message-time">${msg.time}</span>
          </div>
          <div class="community-message-content">${msg.content}</div>
        </div>
      `;
    }
    return `
      <div class="community-message">
        <div class="community-message-avatar">${msg.initials}</div>
        <div class="community-message-body">
          <div class="community-message-header">
            <span class="community-message-sender">${msg.sender}</span>
            <span class="community-message-time">${msg.time}</span>
          </div>
          <div class="community-message-content">${msg.content}</div>
        </div>
      </div>
    `;
  }).join('');
}

function closeCommunityModal() {
  document.getElementById('community-modal').classList.remove('open');
  currentCommunityId = null;
}

function showCommunityTab(tabName) {
  // Update tab buttons
  document.querySelectorAll('.community-tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
  
  // Update tab content
  document.querySelectorAll('.community-tab-content').forEach(content => content.classList.remove('active'));
  document.getElementById('community-' + tabName).classList.add('active');
}

function sendCommunityMessage() {
  const input = document.getElementById('community-message-input');
  const message = input.value.trim();
  if (!message || !currentCommunityId) return;
  
  const community = communitiesData[currentCommunityId];
  
  // Add message to data
  community.messages.push({
    sender: 'Alex Trainer',
    initials: 'AT',
    content: message,
    time: 'Just now'
  });
  
  // Re-render messages
  renderCommunityMessages(community.messages);
  
  // Clear input
  input.value = '';
  
  // Scroll to bottom
  const container = document.getElementById('community-messages');
  container.scrollTop = container.scrollHeight;
}

function openCreateCommunityModal() {
  document.getElementById('create-community-modal').classList.add('open');
}

function closeCreateCommunityModal() {
  document.getElementById('create-community-modal').classList.remove('open');
}

function createCommunity() {
  const name = document.getElementById('new-community-name').value.trim();
  const desc = document.getElementById('new-community-desc').value.trim();
  const type = document.getElementById('new-community-type').value;
  
  if (!name) {
    alert('Please enter a community name');
    return;
  }
  
  // Generate ID
  const id = name.toLowerCase().replace(/\s+/g, '-');
  
  // Get selected members
  const selectedMembers = [];
  document.querySelectorAll('#create-community-modal .member-checkbox input:checked').forEach(cb => {
    selectedMembers.push(cb.value);
  });
  
  // Add to data
  communitiesData[id] = {
    name: name,
    type: type,
    icon: type === 'challenge' ? '' : type === 'program' ? '' : type === 'accountability' ? '' : '',
    gradient: 'linear-gradient(135deg,#764ba2,#667eea)',
    desc: desc || 'A new community',
    members: selectedMembers.length + 1,
    messages: [
      { sender: 'Alex Trainer', initials: 'AT', content: 'Welcome to ' + name + '! Let\'s get started.', time: 'Just now', type: 'announcement' }
    ]
  };
  
  // Add card to grid
  const grid = document.getElementById('communities-grid');
  const card = document.createElement('div');
  card.className = 'community-card';
  card.onclick = () => viewCommunity(id);
  card.innerHTML = `
    <div class="community-header">
      <div class="community-icon" style="background:linear-gradient(135deg,#764ba2,#667eea);">${communitiesData[id].icon}</div>
      <div class="community-badge ${type}">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
    </div>
    <div class="community-name">${name}</div>
    <div class="community-desc">${desc || 'A new community'}</div>
    <div class="community-stats-row">
      <div class="community-stat">
        <span class="community-stat-value">${selectedMembers.length + 1}</span>
        <span class="community-stat-label">Members</span>
      </div>
      <div class="community-stat">
        <span class="community-stat-value">1</span>
        <span class="community-stat-label">Messages</span>
      </div>
      <div class="community-stat">
        <span class="community-stat-value">0</span>
        <span class="community-stat-label">Events</span>
      </div>
    </div>
    <div class="community-activity">
      <div class="community-activity-dot"></div>
      <span>Just created</span>
    </div>
  `;
  grid.appendChild(card);
  
  // Close modal and reset form
  closeCreateCommunityModal();
  document.getElementById('new-community-name').value = '';
  document.getElementById('new-community-desc').value = '';
  document.getElementById('new-community-type').value = 'general';
  document.querySelectorAll('#create-community-modal .member-checkbox input').forEach(cb => cb.checked = false);
  
  alert('Community "' + name + '" created successfully!');
}

function openCreateEventModal() {
  alert('Create Event modal - Coming soon! For now, events are managed in the demo data.');
}

function openAddMembersModal() {
  alert('Add Members modal - Coming soon! For now, members are managed in the demo data.');
}

function saveCommunitySettings() {
  alert('Community settings saved!');
  closeCommunityModal();
}

function deleteCommunity() {
  if (confirm('Are you sure you want to delete this community? This cannot be undone.')) {
    if (currentCommunityId && communitiesData[currentCommunityId]) {
      delete communitiesData[currentCommunityId];
      // Remove card from grid
      const cards = document.querySelectorAll('.community-card');
      cards.forEach(card => {
        if (card.querySelector('.community-name').textContent === communitiesData[currentCommunityId]?.name) {
          card.remove();
        }
      });
      closeCommunityModal();
      alert('Community deleted.');
      // Refresh page to update grid
      showPage('communities');
    }
  }
}

// Close modals on escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeCommunityModal();
    closeCreateCommunityModal();
  }
});

// Close modals on backdrop click
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('community-modal')) {
    e.target.classList.remove('open');
  }
});
</script>
<!-- Supabase config temporarily disabled until Amplify routing is fixed -->
<!-- <script src="supabase-config.js"></script> -->
</body>
</html>
